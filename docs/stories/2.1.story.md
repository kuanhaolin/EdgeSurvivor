# Story 2.1: 編輯個人基本資料

## Status

Draft

## Story

**As a** 使用者,
**I want** 編輯我的基本資料（姓名、Bio、性別、年齡、興趣）,
**so that** 其他使用者能更了解我，提升媒合成功率。

## Acceptance Criteria

### 個人資料編輯頁面

1. 使用者可以存取個人資料編輯頁面 (`/profile/edit`)
2. 頁面應顯示個人資料編輯表單，包含以下欄位：
   - 姓名（必填，文字輸入，最多 50 字）
   - 性別（必填，下拉選單：男性/女性/其他/不願透露）
   - 生日（必填，日期選擇器）
   - 自我介紹 Bio（選填，多行文字輸入，最多 500 字）
   - 興趣標籤（選填，多選標籤，最多 10 個）
3. 頁面載入時自動填入當前資料
4. 表單應使用響應式設計，適配手機與平板

### 表單驗證

5. 姓名欄位驗證：
   - 非空
   - 長度 2-50 字元
6. 性別欄位驗證：
   - 必須選擇其中一個選項
7. 生日欄位驗證：
   - 必填
   - 年齡需在 18-100 歲之間
8. Bio 欄位驗證：
   - 長度不超過 500 字元
9. 興趣標籤驗證：
   - 最多選擇 10 個標籤
   - 提供預設標籤選項（登山、潛水、攝影、美食、文化、冒險等）

### 提交與儲存

10. 點擊「儲存」按鈕應提交表單
11. 提交前應再次驗證所有欄位
12. 驗證失敗時顯示具體的錯誤訊息
13. 提交成功後：
    - 顯示成功訊息「資料已更新」
    - 自動跳轉至個人資料頁（`/profile`）
14. 資料更新後，`updated_at` 欄位自動記錄更新時間

### 錯誤處理

15. 網路錯誤時顯示友善的錯誤訊息
16. 後端驗證失敗時顯示具體的錯誤提示
17. 提供「取消」按鈕，返回個人資料頁
18. 認證失效時自動跳轉至登入頁

### 效能與體驗

19. API 回應時間需低於 1000ms
20. 提交時顯示載入狀態（防止重複提交）
21. 表單欄位變更時顯示「未儲存變更」提示
22. 離開頁面前若有未儲存變更，顯示確認對話框

## Tasks / Subtasks

### Phase 1: 後端 API 驗證

- [ ] **Task 1: 驗證個人資料更新 API** (AC: 10, 13, 14)
  - [ ] ✅ 確認 `backend/blueprints/users.py` 中的 `update_profile()` 端點存在
  - [ ] ✅ 驗證端點路徑為 `PUT /api/users/profile`
  - [ ] ✅ 檢查需要 JWT 認證 (`@jwt_required()`)
  - [ ] ✅ 驗證請求 body 格式
  - [ ] ✅ 確認回應格式包含更新後的使用者資料
  - [ ] ✅ 測試 API 回應時間 < 1000ms
  - [ ] 📝 記錄任何與規格不符的地方

### Phase 2: 前端頁面建立

- [ ] **Task 2: 建立 EditProfile.vue 頁面** (AC: 1, 2, 3, 4)
  - [ ] ➕ 在 `frontend/src/views/` 建立 `EditProfile.vue`
  - [ ] ➕ 使用 Composition API 架構
  - [ ] ➕ 設計頁面佈局
  - [ ] ➕ 添加導航守衛（需登入才能存取）
  - [ ] ➕ 設計響應式佈局

- [ ] **Task 3: 實作個人資料表單組件** (AC: 2, 3, 5, 6, 7, 8, 9)
  - [ ] ➕ 建立表單數據結構
  - [ ] ➕ 使用 Element Plus 組件
  - [ ] ➕ 添加必填欄位標記
  - [ ] ➕ 設計興趣標籤選擇器
  - [ ] ➕ 載入當前使用者資料

- [ ] **Task 4: 實作表單驗證規則** (AC: 5, 6, 7, 8, 9, 11, 12)
  - [ ] ➕ 使用 Element Plus Form Validation
  - [ ] ➕ 建立驗證規則對象
  - [ ] ➕ 實作自定義驗證器
  - [ ] ➕ 實作即時驗證反饋

### Phase 3: API 服務整合

- [ ] **Task 5: 擴展 Users API 服務** (AC: 10, 13)
  - [ ] ➕ 在 `frontend/src/api/users.js` 添加 `updateProfile()` 函數
  - [ ] ➕ 處理請求數據格式轉換
  - [ ] ➕ 返回 Promise with response data

- [ ] **Task 6: 實作表單提交邏輯** (AC: 10, 11, 12, 13, 15, 16, 20)
  - [ ] ➕ 建立 `handleSubmit` 函數
  - [ ] ➕ 使用 `formRef.validate()` 進行表單驗證
  - [ ] ➕ 實作載入狀態管理
  - [ ] ➕ 實作錯誤處理
  - [ ] ➕ 處理認證失效

- [ ] **Task 7: 實作取消與未儲存變更提示** (AC: 17, 21, 22)
  - [ ] ➕ 添加「取消」按鈕
  - [ ] ➕ 追蹤表單變更狀態
  - [ ] ➕ 實作離開頁面確認對話框

### Phase 4: 測試與驗證

- [ ] **Task 8: 前端測試建立**
  - [ ] ➕ 建立 `EditProfile.spec.js`
  - [ ] ➕ 實作測試案例
  - [ ] 🧪 執行測試
  - [ ] 📊 確認覆蓋率 > 80%

- [ ] **Task 9: 後端測試補充**
  - [ ] ✅ 確認更新個人資料測試
  - [ ] 🧪 執行測試
  - [ ] 📊 確認所有測試通過

### Phase 5: 整合測試

- [ ] **Task 10: 端到端功能驗證** (所有 AC)
  - [ ] 🧪 手動測試清單
  - [ ] 📊 驗證所有 AC 滿足
  - [ ] 📝 記錄所有測試結果

## Dev Notes

### Data Models

**User Model** [Source: backend/models/user.py]
- `name` (String(100), NOT NULL) - 姓名
- `gender` (String(20)) - 性別
- `birth_date` (Date) - 生日
- `bio` (Text) - 自我介紹
- `interests` (Text) - 興趣標籤（JSON 格式）
- `updated_at` (DateTime, AUTO UPDATE) - 更新時間

### API Specifications

**Endpoint**: `PUT /api/users/profile`

**Authentication**: Required (JWT Token)

**Request Body**:
```json
{
  "name": "張三",
  "gender": "male",
  "birth_date": "1990-01-01",
  "bio": "熱愛旅行和攝影",
  "interests": ["登山", "攝影", "美食"]
}
```

**Response (Success - 200)**:
```json
{
  "message": "資料已更新",
  "user": {
    "user_id": 1,
    "name": "張三",
    "gender": "male",
    "birth_date": "1990-01-01",
    "bio": "熱愛旅行和攝影",
    "interests": ["登山", "攝影", "美食"],
    "updated_at": "2025-11-25T10:30:00"
  }
}
```

## Testing

### Frontend Testing
```bash
npm run test:unit
```

### Backend Testing
```bash
pytest backend/tests/test_users.py -v
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-25 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

*此區塊由開發代理在實作時填寫*

## QA Results

*此區塊由 QA 代理審查後更新審查結果*
