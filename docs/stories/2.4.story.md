# Story 2.4: ç®¡ç†æ´»å‹•ç‹€æ…‹

## Status

Draft

## Story

**As a** æ´»å‹•å‰µå»ºè€…,
**I want** èƒ½å¤ å°‡æˆ‘çš„æ´»å‹•ç‹€æ…‹è¨­å®šç‚ºã€Œé–‹æ”¾å ±åã€ã€ã€Œé€²è¡Œä¸­ã€ã€ã€Œå·²å®Œæˆã€æˆ–ã€Œå·²å–æ¶ˆã€,
**so that** åƒèˆ‡è€…å’Œå…¶ä»–ä½¿ç”¨è€…èƒ½äº†è§£æ´»å‹•çš„æœ€æ–°é€²åº¦ã€‚

## Acceptance Criteria

### ç‹€æ…‹ç®¡ç†æ¬Šé™

1. åªæœ‰æ´»å‹•å‰µå»ºè€…å¯ä»¥è®Šæ›´æ´»å‹•ç‹€æ…‹
2. éå‰µå»ºè€…è¨ªå•æ´»å‹•è©³æƒ…é æ™‚ï¼Œä¸æ‡‰çœ‹åˆ°ã€Œæ›´æ”¹ç‹€æ…‹ã€æ§åˆ¶é …
3. ç‹€æ…‹è®Šæ›´éœ€è¦ JWT èªè­‰

### ç‹€æ…‹é¸é …é¡¯ç¤º

4. åœ¨æ´»å‹•è©³æƒ…é é¢ï¼Œå‰µå»ºè€…å¯ä»¥çœ‹åˆ°ã€Œæ›´æ”¹ç‹€æ…‹ã€ä¸‹æ‹‰é¸å–®ï¼ˆDropdownï¼‰
5. ä¸‹æ‹‰é¸å–®æ‡‰é¡¯ç¤ºä»¥ä¸‹ç‹€æ…‹é¸é …ï¼š
   - **é–‹æ”¾å ±å** (open)
   - **é€²è¡Œä¸­** (ongoing)
   - **å·²å®Œæˆ** (completed)
   - **å·²å–æ¶ˆ** (cancelled)
6. ç•¶å‰æ´»å‹•ç‹€æ…‹åœ¨ä¸‹æ‹‰é¸å–®ä¸­æ‡‰ç‚ºç¦ç”¨ç‹€æ…‹ï¼ˆdisabledï¼‰
7. ã€Œå·²å–æ¶ˆã€é¸é …æ‡‰èˆ‡å…¶ä»–é¸é …åˆ†éš”ï¼ˆä½¿ç”¨åˆ†éš”ç·š dividedï¼‰

### ç‹€æ…‹è®Šæ›´é‚è¼¯

8. é»æ“Šç‹€æ…‹é¸é …æ‡‰è§¸ç™¼ç‹€æ…‹è®Šæ›´è«‹æ±‚
9. ç‹€æ…‹è®Šæ›´æ™‚æ‡‰é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
10. ç‹€æ…‹è®Šæ›´æˆåŠŸå¾Œï¼š
    - é¡¯ç¤ºæˆåŠŸè¨Šæ¯ã€Œæ´»å‹•ç‹€æ…‹å·²æ›´æ–°ã€
    - è‡ªå‹•é‡æ–°è¼‰å…¥æ´»å‹•è©³æƒ…
    - æ›´æ–°é é¢ä¸Šçš„ç‹€æ…‹æ¨™ç±¤ï¼ˆTagï¼‰
11. ç‹€æ…‹è®Šæ›´å¤±æ•—æ™‚ï¼š
    - é¡¯ç¤ºå…·é«”çš„éŒ¯èª¤è¨Šæ¯
    - ä¿ç•™åŸæœ‰ç‹€æ…‹
    - å…è¨±é‡æ–°å˜—è©¦

### ç‹€æ…‹æ¨™ç±¤é¡¯ç¤º

12. æ´»å‹•è©³æƒ…é æ‡‰é¡¯ç¤ºç•¶å‰æ´»å‹•ç‹€æ…‹æ¨™ç±¤ï¼ˆTagï¼‰
13. ç‹€æ…‹æ¨™ç±¤æ‡‰ä½¿ç”¨ä¸åŒçš„é¡è‰²å€åˆ†ï¼š
    - **é–‹æ”¾å ±å** (open): æˆåŠŸè‰² (success/green)
    - **é€²è¡Œä¸­** (ongoing): è­¦å‘Šè‰² (warning/orange)
    - **å·²å®Œæˆ** (completed): ç°è‰² (info/gray)
    - **å·²å–æ¶ˆ** (cancelled): å±éšªè‰² (danger/red)
14. æ´»å‹•åˆ—è¡¨é çš„æ´»å‹•å¡ç‰‡ä¹Ÿæ‡‰é¡¯ç¤ºç‹€æ…‹æ¨™ç±¤

### ç‹€æ…‹è½‰æ›è¦å‰‡

15. æ”¯æ´ä»¥ä¸‹ç‹€æ…‹è½‰æ›ï¼š
    - **é–‹æ”¾å ±å â†’ é€²è¡Œä¸­**ï¼šæ´»å‹•é–‹å§‹åŸ·è¡Œ
    - **é–‹æ”¾å ±å â†’ å·²å–æ¶ˆ**ï¼šå–æ¶ˆæ´»å‹•
    - **é€²è¡Œä¸­ â†’ å·²å®Œæˆ**ï¼šæ´»å‹•é †åˆ©å®Œæˆ
    - **é€²è¡Œä¸­ â†’ å·²å–æ¶ˆ**ï¼šæ´»å‹•ä¸­é€”å–æ¶ˆ
    - **ä»»ä½•ç‹€æ…‹ â†’ é–‹æ”¾å ±å**ï¼šé‡æ–°é–‹æ”¾ï¼ˆé™¤éå·²å®Œæˆæˆ–å·²å–æ¶ˆï¼‰
16. å·²å®Œæˆå’Œå·²å–æ¶ˆçš„æ´»å‹•ä¸æ‡‰å…è¨±è®Šæ›´ç‚ºå…¶ä»–ç‹€æ…‹ï¼ˆå»ºè­°åœ¨å‰ç«¯ç¦ç”¨æ‰€æœ‰é¸é …ï¼‰

### å¾Œç«¯é©—è­‰

17. å¾Œç«¯ API æ‡‰é©—è­‰ç‹€æ…‹å€¼çš„æœ‰æ•ˆæ€§
18. å¾Œç«¯æ‡‰é©—è­‰åªæœ‰å‰µå»ºè€…å¯ä»¥è®Šæ›´ç‹€æ…‹
19. å¾Œç«¯æ‡‰è¨˜éŒ„ç‹€æ…‹è®Šæ›´çš„æ™‚é–“ï¼ˆ`updated_at`ï¼‰

### ä½¿ç”¨è€…é«”é©—

20. ç‹€æ…‹æ¨™ç±¤æ‡‰é¡¯ç¤ºåœ¨æ´»å‹•æ¨™é¡Œæ—é‚Š
21. ä¸‹æ‹‰é¸å–®æ‡‰ä½¿ç”¨å‹å–„çš„ä¸­æ–‡æ¨™ç±¤
22. éŸ¿æ‡‰å¼è¨­è¨ˆï¼šé©é…æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢
23. ç‹€æ…‹è®Šæ›´æ‡‰æœ‰ç¢ºèªæ©Ÿåˆ¶ï¼ˆç‰¹åˆ¥æ˜¯ã€Œå·²å–æ¶ˆã€ï¼‰

### æ•ˆèƒ½èˆ‡å®‰å…¨æ€§

24. API å›æ‡‰æ™‚é–“éœ€ä½æ–¼ 1000ms
25. åªèƒ½è®Šæ›´è‡ªå·±å‰µå»ºçš„æ´»å‹•ç‹€æ…‹
26. èªè­‰å¤±æ•ˆæ™‚è‡ªå‹•è·³è½‰è‡³ç™»å…¥é 

## Tasks / Subtasks

> **ğŸ”§ Brownfield å°ˆæ¡ˆèªªæ˜**ï¼šå¾Œç«¯ Activity Model å·²åŒ…å« `status` æ¬„ä½ï¼Œä¸” `PUT /api/activities/<activity_id>` ç«¯é»å·²æ”¯æ´æ›´æ–°æ´»å‹•ç‹€æ…‹ã€‚å‰ç«¯ `ActivityDetail.vue` å·²å¯¦ä½œåŸºç¤çš„ç‹€æ…‹è®Šæ›´ UIã€‚æœ¬ Story è‘—é‡æ–¼**å®Œå–„å‰ç«¯ç‹€æ…‹ç®¡ç† UI**ã€**æ·»åŠ ç‹€æ…‹è½‰æ›è¦å‰‡**ã€**æ”¹å–„ä½¿ç”¨è€…é«”é©—**ï¼Œä»¥åŠ**è£œå……æ¸¬è©¦**ã€‚

### Phase 1: å¾Œç«¯é©—è­‰èˆ‡ç¢ºèª

- [ ] **Task 1: é©—è­‰ Activity Model ç‹€æ…‹æ¬„ä½** (AC: 5, 17)
  - [ ] âœ… ç¢ºèª `backend/models/activity.py` åŒ…å« `status` æ¬„ä½
  - [ ] âœ… é©—è­‰ `status` æ¬„ä½é¡å‹ç‚º `String(20)`ï¼Œé è¨­å€¼ç‚º `'active'` æˆ– `'open'`
  - [ ] âœ… ç¢ºèªæ”¯æ´çš„ç‹€æ…‹å€¼ï¼š`'open'`, `'ongoing'`, `'completed'`, `'cancelled'`
  - [ ] âœ… é©—è­‰ `to_dict()` æ–¹æ³•åŒ…å« `status` æ¬„ä½
  - [ ] ğŸ“ è¨˜éŒ„ç•¶å‰é è¨­ç‹€æ…‹å€¼ï¼ˆéœ€çµ±ä¸€ç‚º `'open'`ï¼‰

- [ ] **Task 2: é©—è­‰æ´»å‹•æ›´æ–° API ç«¯é»** (AC: 8, 17, 18, 24, 25)
  - [ ] âœ… ç¢ºèª `backend/blueprints/activities.py` çš„ `update_activity()` ç«¯é»
  - [ ] âœ… é©—è­‰ç«¯é»è·¯å¾‘ç‚º `PUT /api/activities/<activity_id>`
  - [ ] âœ… æª¢æŸ¥éœ€è¦ JWT èªè­‰ (`@jwt_required()`)
  - [ ] âœ… ç¢ºèªæ¬Šé™é©—è­‰ï¼š`if activity.creator_id != current_user_id`
  - [ ] âœ… é©—è­‰æ”¯æ´æ›´æ–° `status` æ¬„ä½ï¼š
    ```python
    if 'status' in data:
        activity.status = data['status']
    ```
  - [ ] â• å»ºè­°ï¼šæ·»åŠ ç‹€æ…‹å€¼é©—è­‰é‚è¼¯ï¼ˆé™å®šç‚ºæœ‰æ•ˆç‹€æ…‹å€¼ï¼‰
  - [ ] ğŸ“ è¨˜éŒ„ä»»ä½•èˆ‡è¦æ ¼ä¸ç¬¦çš„åœ°æ–¹

### Phase 2: å‰ç«¯ç‹€æ…‹ç®¡ç† UI æ”¹å–„

- [ ] **Task 3: é©—è­‰ä¸¦æ”¹å–„ ActivityDetail.vue ç‹€æ…‹ UI** (AC: 4, 5, 6, 7, 20)
  - [ ] âœ… ç¢ºèª `frontend/src/views/ActivityDetail.vue` å·²å¯¦ä½œç‹€æ…‹ä¸‹æ‹‰é¸å–®
  - [ ] âœ… é©—è­‰ç•¶å‰å¯¦ä½œåŒ…å«ç‹€æ…‹é¸é …ï¼š`open`, `ongoing`, `completed`, `cancelled`
  - [ ] âœ… ç¢ºèªä½¿ç”¨ `el-dropdown` çµ„ä»¶
  - [ ] âœ… é©—è­‰ `v-if="isCreator"` æ¬Šé™æ§åˆ¶
  - [ ] ğŸ”„ æ”¹å–„ï¼šç¢ºä¿æ¯å€‹é¸é …ä½¿ç”¨ `:disabled="activity.status === 'ç‹€æ…‹å€¼'"` ç¦ç”¨ç•¶å‰ç‹€æ…‹
  - [ ] ğŸ”„ æ”¹å–„ï¼šç‚ºã€Œå·²å–æ¶ˆã€é¸é …æ·»åŠ  `divided` å±¬æ€§
  - [ ] ğŸ”„ æ”¹å–„ï¼šç¢ºä¿ä¸­æ–‡æ¨™ç±¤æ¸…æ™°æ˜“æ‡‚
  - [ ] âœ… é©—è­‰ç‹€æ…‹æ¨™ç±¤é¡¯ç¤ºåœ¨æ¨™é¡Œæ—é‚Š

- [ ] **Task 4: æ”¹å–„ç‹€æ…‹æ¨™ç±¤æ¨£å¼** (AC: 12, 13, 14)
  - [ ] âœ… ç¢ºèª `ActivityDetail.vue` ä¸­çš„ `getStatusType()` å‡½æ•¸
  - [ ] âœ… é©—è­‰ç‹€æ…‹æ˜ å°„ï¼š
    ```javascript
    const types = {
      open: 'success',
      ongoing: 'warning',
      completed: 'info',
      cancelled: 'danger'
    }
    ```
  - [ ] âœ… ç¢ºèª `getStatusText()` å‡½æ•¸æä¾›ä¸­æ–‡æ¨™ç±¤
  - [ ] ğŸ”„ æ”¹å–„ï¼šç¢ºä¿æ´»å‹•åˆ—è¡¨é  (`Activities.vue`) ä¹Ÿä½¿ç”¨ç›¸åŒçš„ç‹€æ…‹æ¨™ç±¤é‚è¼¯
  - [ ] â• è‹¥ç¼ºå¤±ï¼Œåœ¨ `ActivityCard.vue` çµ„ä»¶æ·»åŠ ç‹€æ…‹æ¨™ç±¤é¡¯ç¤º

- [ ] **Task 5: å¯¦ä½œç‹€æ…‹è®Šæ›´é‚è¼¯** (AC: 8, 9, 10, 11)
  - [ ] âœ… ç¢ºèª `ActivityDetail.vue` ä¸­çš„ `handleStatusChange()` å‡½æ•¸
  - [ ] âœ… é©—è­‰å‡½æ•¸èª¿ç”¨ `PUT /api/activities/${activityId}` ä¸¦å‚³é `{ status: newStatus }`
  - [ ] âœ… é©—è­‰é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹ï¼ˆLoading Stateï¼‰
  - [ ] âœ… é©—è­‰æˆåŠŸå¾Œé¡¯ç¤º `ElMessage.success('æ´»å‹•ç‹€æ…‹å·²æ›´æ–°')`
  - [ ] âœ… é©—è­‰æˆåŠŸå¾Œèª¿ç”¨ `await loadActivity()` é‡æ–°è¼‰å…¥æ´»å‹•è©³æƒ…
  - [ ] âœ… é©—è­‰å¤±æ•—æ™‚é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼š`ElMessage.error(error.response?.data?.error || 'æ›´æ–°ç‹€æ…‹å¤±æ•—')`
  - [ ] ğŸ“ ç¢ºèªç•¶å‰å¯¦ä½œç¬¦åˆ AC

### Phase 3: ç‹€æ…‹è½‰æ›è¦å‰‡èˆ‡ç¢ºèªæ©Ÿåˆ¶

- [ ] **Task 6: å¯¦ä½œç‹€æ…‹è½‰æ›è¦å‰‡** (AC: 15, 16)
  - [ ] â• åœ¨ `ActivityDetail.vue` æ·»åŠ ç‹€æ…‹è½‰æ›é©—è­‰é‚è¼¯
  - [ ] â• å»ºç«‹ `canChangeToStatus(currentStatus, newStatus)` å‡½æ•¸ï¼š
    ```javascript
    const canChangeToStatus = (currentStatus, newStatus) => {
      // å·²å®Œæˆæˆ–å·²å–æ¶ˆçš„æ´»å‹•ä¸èƒ½è®Šæ›´ç‹€æ…‹
      if (currentStatus === 'completed' || currentStatus === 'cancelled') {
        return false
      }
      // å…è¨±çš„ç‹€æ…‹è½‰æ›
      const allowedTransitions = {
        'open': ['ongoing', 'cancelled'],
        'ongoing': ['completed', 'cancelled']
      }
      return allowedTransitions[currentStatus]?.includes(newStatus) || false
    }
    ```
  - [ ] â• åœ¨ä¸‹æ‹‰é¸å–®ä¸­æ‡‰ç”¨æ­¤é‚è¼¯ï¼Œç¦ç”¨ä¸å…è¨±çš„ç‹€æ…‹è½‰æ›
  - [ ] â• æ›´æ–° `:disabled` é‚è¼¯ï¼š
    ```vue
    :disabled="activity.status === 'open' || !canChangeToStatus(activity.status, 'open')"
    ```

- [ ] **Task 7: æ·»åŠ ç‹€æ…‹è®Šæ›´ç¢ºèªæ©Ÿåˆ¶** (AC: 23)
  - [ ] â• ç‚ºã€Œå·²å–æ¶ˆã€ç‹€æ…‹æ·»åŠ ç¢ºèªå°è©±æ¡†
  - [ ] â• ä½¿ç”¨ `ElMessageBox.confirm()` å¯¦ä½œç¢ºèªæ©Ÿåˆ¶ï¼š
    ```javascript
    const handleStatusChange = async (newStatus) => {
      // å–æ¶ˆæ´»å‹•éœ€è¦ç¢ºèª
      if (newStatus === 'cancelled') {
        try {
          await ElMessageBox.confirm(
            'ç¢ºå®šè¦å–æ¶ˆæ­¤æ´»å‹•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¾©ã€‚',
            'ç¢ºèªå–æ¶ˆæ´»å‹•',
            {
              confirmButtonText: 'ç¢ºå®šå–æ¶ˆ',
              cancelButtonText: 'è¿”å›',
              type: 'warning'
            }
          )
        } catch {
          return // ç”¨æˆ¶å–æ¶ˆæ“ä½œ
        }
      }
      
      // åŸ·è¡Œç‹€æ…‹è®Šæ›´
      try {
        await axios.put(`/activities/${activityId.value}`, {
          status: newStatus
        })
        
        ElMessage.success('æ´»å‹•ç‹€æ…‹å·²æ›´æ–°')
        await loadActivity()
      } catch (error) {
        console.error('æ›´æ–°ç‹€æ…‹å¤±æ•—:', error)
        ElMessage.error(error.response?.data?.error || 'æ›´æ–°ç‹€æ…‹å¤±æ•—')
      }
    }
    ```

### Phase 4: API æ•´åˆç¢ºèª

- [ ] **Task 8: ç¢ºèª Activities API æœå‹™** (AC: 8)
  - [ ] âœ… ç¢ºèª `frontend/src/api/activities.js` åŒ…å« `updateActivity()` å‡½æ•¸
  - [ ] âœ… é©—è­‰å‡½æ•¸ç°½åï¼š
    ```javascript
    export const updateActivity = (activityId, data) => {
      return axios.put(`/activities/${activityId}`, data)
    }
    ```
  - [ ] ğŸ“ è¨˜éŒ„ API å‡½æ•¸æ˜¯å¦å·²è¢«æ­£ç¢ºä½¿ç”¨

### Phase 5: æ´»å‹•åˆ—è¡¨é ç‹€æ…‹æ¨™ç±¤æ•´åˆ

- [ ] **Task 9: åœ¨æ´»å‹•åˆ—è¡¨é é¡¯ç¤ºç‹€æ…‹æ¨™ç±¤** (AC: 14)
  - [ ] âœ… æª¢æŸ¥ `frontend/src/views/Activities.vue` æ˜¯å¦é¡¯ç¤ºç‹€æ…‹æ¨™ç±¤
  - [ ] â• è‹¥ç¼ºå¤±ï¼Œåœ¨æ´»å‹•å¡ç‰‡ä¸­æ·»åŠ ç‹€æ…‹æ¨™ç±¤ï¼š
    ```vue
    <el-tag :type="getStatusType(activity.status)" size="small">
      {{ getStatusText(activity.status) }}
    </el-tag>
    ```
  - [ ] â• è¤‡ç”¨ `ActivityDetail.vue` çš„ `getStatusType()` å’Œ `getStatusText()` å‡½æ•¸
  - [ ] ğŸ”„ å»ºè­°ï¼šå°‡ç‹€æ…‹ç›¸é—œå‡½æ•¸æå–åˆ°å…±ç”¨å·¥å…·æª”æ¡ˆ `utils/activityHelpers.js`

- [ ] **Task 10: å»ºç«‹å…±ç”¨ç‹€æ…‹å·¥å…·å‡½æ•¸** (AC: 13, 21)
  - [ ] â• åœ¨ `frontend/src/utils/` å»ºç«‹ `activityHelpers.js`
  - [ ] â• å¯¦ä½œå…±ç”¨å‡½æ•¸ï¼š
    ```javascript
    /**
     * å–å¾—æ´»å‹•ç‹€æ…‹å°æ‡‰çš„ Element Plus Tag é¡å‹
     * @param {string} status - æ´»å‹•ç‹€æ…‹
     * @returns {string} Element Plus Tag type
     */
    export const getActivityStatusType = (status) => {
      const types = {
        open: 'success',
        ongoing: 'warning',
        completed: 'info',
        cancelled: 'danger'
      }
      return types[status] || 'info'
    }
    
    /**
     * å–å¾—æ´»å‹•ç‹€æ…‹çš„ä¸­æ–‡æ–‡å­—
     * @param {string} status - æ´»å‹•ç‹€æ…‹
     * @returns {string} ä¸­æ–‡ç‹€æ…‹æ–‡å­—
     */
    export const getActivityStatusText = (status) => {
      const texts = {
        open: 'é–‹æ”¾å ±å',
        ongoing: 'é€²è¡Œä¸­',
        completed: 'å·²å®Œæˆ',
        cancelled: 'å·²å–æ¶ˆ'
      }
      return texts[status] || status
    }
    
    /**
     * æª¢æŸ¥æ˜¯å¦å¯ä»¥å°‡æ´»å‹•ç‹€æ…‹è®Šæ›´ç‚ºæŒ‡å®šç‹€æ…‹
     * @param {string} currentStatus - ç•¶å‰ç‹€æ…‹
     * @param {string} newStatus - ç›®æ¨™ç‹€æ…‹
     * @returns {boolean} æ˜¯å¦å…è¨±è½‰æ›
     */
    export const canChangeActivityStatus = (currentStatus, newStatus) => {
      // ç•¶å‰ç‹€æ…‹èˆ‡ç›®æ¨™ç‹€æ…‹ç›¸åŒ
      if (currentStatus === newStatus) {
        return false
      }
      
      // å·²å®Œæˆæˆ–å·²å–æ¶ˆçš„æ´»å‹•ä¸èƒ½è®Šæ›´ç‹€æ…‹
      if (currentStatus === 'completed' || currentStatus === 'cancelled') {
        return false
      }
      
      // å…è¨±çš„ç‹€æ…‹è½‰æ›
      const allowedTransitions = {
        'open': ['ongoing', 'cancelled'],
        'ongoing': ['completed', 'cancelled']
      }
      
      return allowedTransitions[currentStatus]?.includes(newStatus) || false
    }
    ```
  - [ ] ğŸ”„ åœ¨ `ActivityDetail.vue` å’Œ `Activities.vue` ä¸­å¼•å…¥ä¸¦ä½¿ç”¨é€™äº›å‡½æ•¸

### Phase 6: éŸ¿æ‡‰å¼è¨­è¨ˆèˆ‡ UX å„ªåŒ–

- [ ] **Task 11: å„ªåŒ–éŸ¿æ‡‰å¼ä½ˆå±€** (AC: 22)
  - [ ] âœ… ç¢ºèªæ´»å‹•è©³æƒ…é åœ¨æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢çš„é¡¯ç¤ºæ•ˆæœ
  - [ ] ğŸ”„ èª¿æ•´ç‹€æ…‹ä¸‹æ‹‰é¸å–®åœ¨æ‰‹æ©Ÿä¸Šçš„é¡¯ç¤ºï¼ˆç¢ºä¿è§¸æ§å‹å–„ï¼‰
  - [ ] ğŸ”„ èª¿æ•´ç‹€æ…‹æ¨™ç±¤åœ¨å°è¢å¹•ä¸Šçš„å°ºå¯¸å’Œä½ç½®

### Phase 7: å¾Œç«¯ç‹€æ…‹é©—è­‰å¢å¼·ï¼ˆé¸æ“‡æ€§ï¼‰

- [ ] **Task 12: å¢å¼·å¾Œç«¯ç‹€æ…‹é©—è­‰** (AC: 17, 19)
  - [ ] â• åœ¨ `backend/blueprints/activities.py` çš„ `update_activity()` ä¸­æ·»åŠ ç‹€æ…‹é©—è­‰ï¼š
    ```python
    if 'status' in data:
        # é©—è­‰ç‹€æ…‹å€¼
        valid_statuses = ['open', 'ongoing', 'completed', 'cancelled']
        if data['status'] not in valid_statuses:
            return jsonify({'error': 'ç„¡æ•ˆçš„æ´»å‹•ç‹€æ…‹'}), 400
        activity.status = data['status']
    ```
  - [ ] âœ… ç¢ºèª `updated_at` æ¬„ä½æœƒè‡ªå‹•æ›´æ–°ï¼ˆSQLAlchemy `onupdate=datetime.utcnow`ï¼‰

### Phase 8: æ¸¬è©¦

- [ ] **Task 13: å‰ç«¯å–®å…ƒæ¸¬è©¦** (AC: 8, 10, 11, 13, 21)
  - [ ] â• åœ¨ `frontend/tests/unit/views/` å»ºç«‹ `ActivityDetail.spec.js`
  - [ ] â• å¯¦ä½œæ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦å‰µå»ºè€…å¯ä»¥çœ‹åˆ°ã€Œæ›´æ”¹ç‹€æ…‹ã€ä¸‹æ‹‰é¸å–®
    - [ ] æ¸¬è©¦éå‰µå»ºè€…ä¸é¡¯ç¤ºã€Œæ›´æ”¹ç‹€æ…‹ã€é¸å–®
    - [ ] æ¸¬è©¦ç‹€æ…‹æ¨™ç±¤æ­£ç¢ºé¡¯ç¤ºï¼ˆé¡å‹å’Œæ–‡å­—ï¼‰
    - [ ] æ¸¬è©¦ç•¶å‰ç‹€æ…‹åœ¨ä¸‹æ‹‰é¸å–®ä¸­ç‚ºç¦ç”¨
    - [ ] æ¸¬è©¦é»æ“Šç‹€æ…‹é¸é …è§¸ç™¼ API è«‹æ±‚ï¼ˆMockï¼‰
    - [ ] æ¸¬è©¦ç‹€æ…‹è®Šæ›´æˆåŠŸé¡¯ç¤ºæˆåŠŸè¨Šæ¯
    - [ ] æ¸¬è©¦ç‹€æ…‹è®Šæ›´å¤±æ•—é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
    - [ ] æ¸¬è©¦å–æ¶ˆæ´»å‹•é¡¯ç¤ºç¢ºèªå°è©±æ¡†
  - [ ] â• åœ¨ `frontend/tests/unit/utils/` å»ºç«‹ `activityHelpers.spec.js`
  - [ ] â• å¯¦ä½œæ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦ `getActivityStatusType()` è¿”å›æ­£ç¢ºçš„é¡å‹
    - [ ] æ¸¬è©¦ `getActivityStatusText()` è¿”å›æ­£ç¢ºçš„ä¸­æ–‡æ–‡å­—
    - [ ] æ¸¬è©¦ `canChangeActivityStatus()` ç‹€æ…‹è½‰æ›é‚è¼¯
  - [ ] ğŸ§ª åŸ·è¡Œæ¸¬è©¦ï¼š`npm run test:unit`
  - [ ] ğŸ“Š ç¢ºèªè¦†è“‹ç‡ > 80%

- [ ] **Task 14: å¾Œç«¯æ¸¬è©¦è£œå……** (AC: 17, 18, 25)
  - [ ] âœ… ç¢ºèª `backend/tests/test_activities.py` å­˜åœ¨
  - [ ] â• æ·»åŠ æ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦å‰µå»ºè€…æˆåŠŸæ›´æ–°æ´»å‹•ç‹€æ…‹
    - [ ] æ¸¬è©¦éå‰µå»ºè€…ç„¡æ³•æ›´æ–°æ´»å‹•ç‹€æ…‹ï¼ˆè¿”å› 403ï¼‰
    - [ ] æ¸¬è©¦æœªèªè­‰è«‹æ±‚è¿”å› 401
    - [ ] æ¸¬è©¦ç„¡æ•ˆçš„ç‹€æ…‹å€¼è¿”å› 400ï¼ˆè‹¥å¯¦ä½œå¾Œç«¯é©—è­‰ï¼‰
    - [ ] æ¸¬è©¦ `updated_at` æ¬„ä½æ­£ç¢ºæ›´æ–°
  - [ ] ğŸ§ª åŸ·è¡Œæ¸¬è©¦ï¼š`pytest backend/tests/test_activities.py -v`
  - [ ] ğŸ“Š ç¢ºèªæ‰€æœ‰æ¸¬è©¦é€šé

### Phase 9: æ•´åˆæ¸¬è©¦

- [ ] **Task 15: ç«¯åˆ°ç«¯åŠŸèƒ½é©—è­‰** (æ‰€æœ‰ AC)
  - [ ] ğŸ§ª æ‰‹å‹•æ¸¬è©¦æ¸…å–®ï¼š
    - [ ] **æ¸¬è©¦ 1**: å‰µå»ºè€…æŸ¥çœ‹æ´»å‹•è©³æƒ…
      - ä»¥å‰µå»ºè€…èº«ä»½ç™»å…¥
      - è¨ªå•è‡ªå·±å‰µå»ºçš„æ´»å‹•è©³æƒ…é 
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œæ›´æ”¹ç‹€æ…‹ã€ä¸‹æ‹‰é¸å–®
      - é©—è­‰ï¼šé¡¯ç¤ºç•¶å‰ç‹€æ…‹æ¨™ç±¤
    - [ ] **æ¸¬è©¦ 2**: éå‰µå»ºè€…æŸ¥çœ‹æ´»å‹•è©³æƒ…
      - ä»¥å…¶ä»–ç”¨æˆ¶èº«ä»½ç™»å…¥
      - è¨ªå•ä»–äººå‰µå»ºçš„æ´»å‹•è©³æƒ…é 
      - é©—è­‰ï¼šä¸é¡¯ç¤ºã€Œæ›´æ”¹ç‹€æ…‹ã€ä¸‹æ‹‰é¸å–®
      - é©—è­‰ï¼šé¡¯ç¤ºç•¶å‰ç‹€æ…‹æ¨™ç±¤
    - [ ] **æ¸¬è©¦ 3**: è®Šæ›´ç‹€æ…‹ç‚ºã€Œé€²è¡Œä¸­ã€
      - æ´»å‹•ç‹€æ…‹ç‚ºã€Œé–‹æ”¾å ±åã€
      - é»æ“Šã€Œæ›´æ”¹ç‹€æ…‹ã€é¸å–®
      - é¸æ“‡ã€Œé€²è¡Œä¸­ã€
      - é©—è­‰ï¼šé¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      - é©—è­‰ï¼šé¡¯ç¤ºæˆåŠŸè¨Šæ¯
      - é©—è­‰ï¼šç‹€æ…‹æ¨™ç±¤æ›´æ–°ç‚ºã€Œé€²è¡Œä¸­ã€ï¼ˆè­¦å‘Šè‰²ï¼‰
    - [ ] **æ¸¬è©¦ 4**: è®Šæ›´ç‹€æ…‹ç‚ºã€Œå·²å®Œæˆã€
      - æ´»å‹•ç‹€æ…‹ç‚ºã€Œé€²è¡Œä¸­ã€
      - é¸æ“‡ã€Œå·²å®Œæˆã€
      - é©—è­‰ï¼šç‹€æ…‹æ¨™ç±¤æ›´æ–°ç‚ºã€Œå·²å®Œæˆã€ï¼ˆç°è‰²ï¼‰
      - é©—è­‰ï¼šæ‰€æœ‰ç‹€æ…‹é¸é …è®Šç‚ºç¦ç”¨
    - [ ] **æ¸¬è©¦ 5**: å–æ¶ˆæ´»å‹•
      - æ´»å‹•ç‹€æ…‹ç‚ºã€Œé–‹æ”¾å ±åã€æˆ–ã€Œé€²è¡Œä¸­ã€
      - é¸æ“‡ã€Œå·²å–æ¶ˆã€
      - é©—è­‰ï¼šé¡¯ç¤ºç¢ºèªå°è©±æ¡†
      - é»æ“Šã€Œç¢ºå®šå–æ¶ˆã€
      - é©—è­‰ï¼šç‹€æ…‹æ¨™ç±¤æ›´æ–°ç‚ºã€Œå·²å–æ¶ˆã€ï¼ˆç´…è‰²ï¼‰
    - [ ] **æ¸¬è©¦ 6**: å–æ¶ˆæ“ä½œç¢ºèªå°è©±æ¡†
      - é¸æ“‡ã€Œå·²å–æ¶ˆã€
      - é©—è­‰ï¼šé¡¯ç¤ºç¢ºèªå°è©±æ¡†
      - é»æ“Šã€Œè¿”å›ã€
      - é©—è­‰ï¼šç‹€æ…‹æœªè®Šæ›´
    - [ ] **æ¸¬è©¦ 7**: ç‹€æ…‹è½‰æ›è¦å‰‡
      - æ´»å‹•ç‹€æ…‹ç‚ºã€Œå·²å®Œæˆã€
      - é©—è­‰ï¼šæ‰€æœ‰ç‹€æ…‹é¸é …ç‚ºç¦ç”¨
      - æ´»å‹•ç‹€æ…‹ç‚ºã€Œå·²å–æ¶ˆã€
      - é©—è­‰ï¼šæ‰€æœ‰ç‹€æ…‹é¸é …ç‚ºç¦ç”¨
    - [ ] **æ¸¬è©¦ 8**: ç•¶å‰ç‹€æ…‹ç¦ç”¨
      - æ´»å‹•ç‹€æ…‹ç‚ºã€Œé–‹æ”¾å ±åã€
      - æ‰“é–‹ä¸‹æ‹‰é¸å–®
      - é©—è­‰ï¼šã€Œé–‹æ”¾å ±åã€é¸é …ç‚ºç¦ç”¨
    - [ ] **æ¸¬è©¦ 9**: æ´»å‹•åˆ—è¡¨é ç‹€æ…‹æ¨™ç±¤
      - è¨ªå•æ´»å‹•åˆ—è¡¨é 
      - é©—è­‰ï¼šæ¯å€‹æ´»å‹•å¡ç‰‡é¡¯ç¤ºç‹€æ…‹æ¨™ç±¤
      - é©—è­‰ï¼šæ¨™ç±¤é¡è‰²èˆ‡ç‹€æ…‹å°æ‡‰
    - [ ] **æ¸¬è©¦ 10**: éŸ¿æ‡‰å¼è¨­è¨ˆ
      - åœ¨æ¡Œé¢æ¨¡å¼æŸ¥çœ‹
      - é©—è­‰ï¼šä½ˆå±€æ­£ç¢º
      - åœ¨æ‰‹æ©Ÿæ¨¡å¼æŸ¥çœ‹
      - é©—è­‰ï¼šä½ˆå±€æ­£ç¢ºï¼Œè§¸æ§å‹å–„
    - [ ] **æ¸¬è©¦ 11**: æ¬Šé™é©—è­‰
      - å˜—è©¦ä»¥éå‰µå»ºè€…èº«ä»½é€é API æ›´æ–°ç‹€æ…‹
      - é©—è­‰ï¼šè¿”å› 403 éŒ¯èª¤
    - [ ] **æ¸¬è©¦ 12**: æ•ˆèƒ½æ¸¬è©¦
      - ä½¿ç”¨ DevTools Network é¢æ¿
      - é©—è­‰ï¼šAPI å›æ‡‰æ™‚é–“ < 1000ms
  - [ ] ğŸ“Š é©—è­‰æ‰€æœ‰ AC æ»¿è¶³
  - [ ] ğŸ“ è¨˜éŒ„æ‰€æœ‰æ¸¬è©¦çµæœ

### åœ–ä¾‹èªªæ˜
- âœ… **å·²å­˜åœ¨ä¸”æ­£ç¢º** - é©—è­‰é€šéå³å¯
- âš ï¸ **éœ€è¦æª¢æŸ¥** - å¯èƒ½éœ€è¦èª¿æ•´
- â• **éœ€è¦æ–°å¢** - ç¼ºå¤±çš„åŠŸèƒ½
- ğŸ”„ **éœ€è¦é‡æ§‹** - éœ€è¦æ”¹é€²ç¾æœ‰å¯¦ä½œ
- ğŸ“ **è¨˜éŒ„** - æ–‡ä»¶åŒ–ç™¼ç¾
- ğŸ§ª **æ¸¬è©¦** - åŸ·è¡Œæ¸¬è©¦
- ğŸ“Š **é©—è­‰** - ç¢ºèªç¬¦åˆéœ€æ±‚

## Dev Notes

### Previous Story Insights

**ä¾†è‡ª Story 1.1 - 2.3 çš„ç¶“é©—**ï¼š
- âœ… Vue 3 Composition API æ˜¯æ¨™æº–é–‹ç™¼æ¨¡å¼
- âœ… Element Plus çµ„ä»¶åº«å·²æ•´åˆä¸”é‹ä½œè‰¯å¥½ï¼ˆ`el-dropdown`, `el-tag`, `el-message`ï¼‰
- âœ… Pinia Auth Store å·²å»ºç«‹ï¼Œç”¨æ–¼ç®¡ç†èªè­‰ç‹€æ…‹
- âœ… JWT èªè­‰æ©Ÿåˆ¶å®Œå–„ï¼ˆ`@jwt_required()` è£é£¾å™¨ï¼‰
- âœ… Axios æ””æˆªå™¨å·²é…ç½®ï¼Œè™•ç†èªè­‰å’ŒéŒ¯èª¤
- âœ… è·¯ç”±å®ˆè¡›æ©Ÿåˆ¶å·²å»ºç«‹ï¼ˆ`requiresAuth` metaï¼‰
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆæ¨¡å¼å·²ç¢ºç«‹
- âœ… éŒ¯èª¤è™•ç†æ¨¡å¼ï¼šå¾Œç«¯è¿”å›å…·é«”éŒ¯èª¤ï¼Œå‰ç«¯é¡¯ç¤ºå‹å–„è¨Šæ¯
- âœ… ç¢ºèªæ©Ÿåˆ¶ï¼šé‡è¦æ“ä½œä½¿ç”¨ `ElMessageBox.confirm()`

**Brownfield å°ˆæ¡ˆèƒŒæ™¯**ï¼š
- å¾Œç«¯ Activity Model å·²åŒ…å« `status` æ¬„ä½ï¼ˆé è¨­ç‚º `'active'`ï¼Œéœ€çµ±ä¸€ç‚º `'open'`ï¼‰
- `PUT /api/activities/<activity_id>` ç«¯é»å·²æ”¯æ´æ›´æ–°æ´»å‹•ç‹€æ…‹
- å‰ç«¯ `ActivityDetail.vue` å·²å¯¦ä½œåŸºç¤çš„ç‹€æ…‹ä¸‹æ‹‰é¸å–®å’Œè®Šæ›´é‚è¼¯
- `handleStatusChange()` å‡½æ•¸å·²å­˜åœ¨ï¼Œéœ€è¦å¢å¼·ç¢ºèªæ©Ÿåˆ¶å’Œè½‰æ›è¦å‰‡
- ç‹€æ…‹æ¨™ç±¤é¡¯ç¤ºé‚è¼¯å·²å¯¦ä½œï¼ˆ`getStatusType()`, `getStatusText()`ï¼‰
- ä¸»è¦å·¥ä½œæ˜¯**å®Œå–„å‰ç«¯ UX**ã€**æ·»åŠ ç‹€æ…‹è½‰æ›è¦å‰‡**ã€**å¯¦ä½œç¢ºèªæ©Ÿåˆ¶**ã€**è£œå……æ¸¬è©¦**

### Data Models

**Activity Model** [Source: backend/models/activity.py:6-20]
- **Table**: `activities`
- **Primary Key**: `activity_id` (Integer, Auto-increment)
- **ç‹€æ…‹ç›¸é—œæ¬„ä½**:
  - `status` (String(20), DEFAULT 'active') - æ´»å‹•ç‹€æ…‹
    - æœ‰æ•ˆå€¼ï¼š`'open'` (é–‹æ”¾å ±å), `'ongoing'` (é€²è¡Œä¸­), `'completed'` (å·²å®Œæˆ), `'cancelled'` (å·²å–æ¶ˆ)
    - **æ³¨æ„**ï¼šç•¶å‰é è¨­å€¼ç‚º `'active'`ï¼Œå»ºè­°çµ±ä¸€ç‚º `'open'`
  - `created_at` (DateTime, DEFAULT datetime.utcnow) - å»ºç«‹æ™‚é–“
  - `updated_at` (DateTime, DEFAULT datetime.utcnow, ONUPDATE datetime.utcnow) - æ›´æ–°æ™‚é–“ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
- **å…¶ä»–ç›¸é—œæ¬„ä½**:
  - `title` (String(200), NOT NULL) - æ´»å‹•æ¨™é¡Œ
  - `creator_id` (Integer, FK to users, NOT NULL) - å‰µå»ºè€… ID
  - `category` (String(50)) - æ´»å‹•é¡å‹

**ActivityParticipant Model** [Source: backend/models/activity_participant.py:9-18]
- **Table**: `activity_participants`
- **ç›¸é—œæ¬„ä½**:
  - `activity_id` (Integer, FK to activities)
  - `user_id` (Integer, FK to users)
  - `status` (String(20), DEFAULT 'pending') - åƒèˆ‡ç‹€æ…‹
  - `role` (String(20), DEFAULT 'participant') - è§’è‰²ï¼ˆ'creator', 'participant'ï¼‰

### API Specifications

**Endpoint**: `PUT /api/activities/<activity_id>` [Source: backend/blueprints/activities.py:151-195]

**Authentication**: Required (JWT Token)

**Permission**: åªæœ‰æ´»å‹•å‰µå»ºè€…å¯ä»¥æ›´æ–°æ´»å‹•

**Request Headers**:
```
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

**Request Body**:
```json
{
  "status": "ongoing"
}
```

**Response (Success - 200)**:
```json
{
  "message": "æ´»å‹•æ›´æ–°æˆåŠŸ",
  "activity": {
    "activity_id": 1,
    "title": "é™½æ˜å±±ç™»å±±",
    "status": "ongoing",
    "creator_id": 123,
    "created_at": "2025-11-01T10:00:00",
    "updated_at": "2025-11-05T14:30:00",
    ...
  }
}
```

**Response (Error - 403)**:
```json
{
  "error": "ç„¡æ¬Šé™ä¿®æ”¹æ­¤æ´»å‹•"
}
```

**Response (Error - 404)**:
```json
{
  "error": "æ‰¾ä¸åˆ°æ´»å‹•"
}
```

**å¾Œç«¯é‚è¼¯** [Source: backend/blueprints/activities.py:151-195]:
```python
@activities_bp.route('/<int:activity_id>', methods=['PUT'])
@jwt_required()
def update_activity(activity_id):
    """æ›´æ–°æ´»å‹•"""
    try:
        current_user_id = int(get_jwt_identity())
        activity = Activity.query.get(activity_id)
        
        if not activity:
            return jsonify({'error': 'æ‰¾ä¸åˆ°æ´»å‹•'}), 404
        
        if activity.creator_id != current_user_id:
            return jsonify({'error': 'ç„¡æ¬Šé™ä¿®æ”¹æ­¤æ´»å‹•'}), 403
        
        data = request.get_json()
        
        # æ›´æ–°ç‹€æ…‹
        if 'status' in data:
            activity.status = data['status']
        
        db.session.commit()
        
        return jsonify({
            'message': 'æ´»å‹•æ›´æ–°æˆåŠŸ',
            'activity': activity.to_dict()
        }), 200
        
    except Exception as e:
        db.session.rollback()
        return jsonify({'error': str(e)}), 500
```

**å»ºè­°æ”¹é€²**ï¼šæ·»åŠ ç‹€æ…‹å€¼é©—è­‰
```python
if 'status' in data:
    valid_statuses = ['open', 'ongoing', 'completed', 'cancelled']
    if data['status'] not in valid_statuses:
        return jsonify({'error': 'ç„¡æ•ˆçš„æ´»å‹•ç‹€æ…‹'}), 400
    activity.status = data['status']
```

### Frontend Implementation

**ActivityDetail.vue** [Source: frontend/src/views/ActivityDetail.vue:1-61, 451-530]

**ç•¶å‰å¯¦ä½œ**ï¼š
```vue
<template>
  <div class="activity-detail">
    <!-- ç‹€æ…‹æ¨™ç±¤ -->
    <el-tag :type="getStatusType(activity.status)">
      {{ getStatusText(activity.status) }}
    </el-tag>
    
    <!-- ç‹€æ…‹ä¸‹æ‹‰é¸å–®ï¼ˆåƒ…å‰µå»ºè€…å¯è¦‹ï¼‰ -->
    <el-dropdown v-if="isCreator" @command="handleStatusChange">
      <el-button type="primary" size="small">
        æ›´æ”¹ç‹€æ…‹
        <el-icon class="el-icon--right"><arrow-down /></el-icon>
      </el-button>
      <template #dropdown>
        <el-dropdown-menu>
          <el-dropdown-item command="open" :disabled="activity.status === 'open'">
            é–‹æ”¾å ±å
          </el-dropdown-item>
          <el-dropdown-item command="ongoing" :disabled="activity.status === 'ongoing'">
            é€²è¡Œä¸­
          </el-dropdown-item>
          <el-dropdown-item command="completed" :disabled="activity.status === 'completed'">
            å·²å®Œæˆ
          </el-dropdown-item>
          <el-dropdown-item command="cancelled" :disabled="activity.status === 'cancelled'" divided>
            å–æ¶ˆæ´»å‹•
          </el-dropdown-item>
        </el-dropdown-menu>
      </template>
    </el-dropdown>
  </div>
</template>

<script setup>
// ç‹€æ…‹é¡å‹æ˜ å°„
const getStatusType = (status) => {
  const types = {
    planning: 'info',
    recruiting: 'success',
    active: 'success',
    open: 'success',
    confirmed: 'warning',
    ongoing: 'warning',
    completed: '',
    cancelled: 'danger'
  }
  return types[status] || 'info'
}

// ç‹€æ…‹æ–‡å­—æ˜ å°„
const getStatusText = (status) => {
  const statuses = {
    planning: 'è¦åŠƒä¸­',
    recruiting: 'æ‹›å‹Ÿä¸­',
    active: 'æ´»èº',
    open: 'é–‹æ”¾å ±å',
    confirmed: 'å·²ç¢ºèª',
    ongoing: 'é€²è¡Œä¸­',
    completed: 'å·²å®Œæˆ',
    cancelled: 'å·²å–æ¶ˆ'
  }
  return statuses[status] || status
}

// è®Šæ›´æ´»å‹•ç‹€æ…‹
const handleStatusChange = async (newStatus) => {
  try {
    await axios.put(`/activities/${activityId.value}`, {
      status: newStatus
    })
    
    ElMessage.success('æ´»å‹•ç‹€æ…‹å·²æ›´æ–°')
    await loadActivity()
  } catch (error) {
    console.error('æ›´æ–°ç‹€æ…‹å¤±æ•—:', error)
    ElMessage.error(error.response?.data?.error || 'æ›´æ–°ç‹€æ…‹å¤±æ•—')
  }
}
</script>
```

**éœ€è¦æ”¹é€²çš„åœ°æ–¹**ï¼š
1. âœ… å·²å¯¦ä½œç‹€æ…‹ä¸‹æ‹‰é¸å–®å’Œè®Šæ›´é‚è¼¯
2. âœ… å·²å¯¦ä½œæ¬Šé™æ§åˆ¶ï¼ˆ`v-if="isCreator"`ï¼‰
3. âœ… å·²å¯¦ä½œç‹€æ…‹æ¨™ç±¤é¡¯ç¤º
4. â• éœ€è¦æ·»åŠ å–æ¶ˆæ´»å‹•çš„ç¢ºèªå°è©±æ¡†
5. â• éœ€è¦å¯¦ä½œç‹€æ…‹è½‰æ›è¦å‰‡é©—è­‰
6. â• éœ€è¦çµ±ä¸€ç‹€æ…‹æ˜ å°„ï¼ˆç§»é™¤ `planning`, `recruiting`, `active` ç­‰èˆŠç‹€æ…‹ï¼‰
7. â• éœ€è¦å°‡ç‹€æ…‹ç›¸é—œå‡½æ•¸æå–åˆ°å…±ç”¨å·¥å…·æª”æ¡ˆ

### File Locations

Based on [Source: architecture/3-å°ˆæ¡ˆçµæ§‹-project-structure.md]:

**Frontend**:
- æ´»å‹•è©³æƒ…é é¢: `frontend/src/views/ActivityDetail.vue` (å·²å­˜åœ¨ - éœ€æ”¹å–„)
- æ´»å‹•åˆ—è¡¨é é¢: `frontend/src/views/Activities.vue` (å·²å­˜åœ¨ - éœ€æ·»åŠ ç‹€æ…‹æ¨™ç±¤)
- æ´»å‹•å¡ç‰‡çµ„ä»¶: `frontend/src/components/activity/ActivityCard.vue` (å¯èƒ½éœ€è¦æ·»åŠ ç‹€æ…‹æ¨™ç±¤)
- å…±ç”¨å·¥å…·å‡½æ•¸: `frontend/src/utils/activityHelpers.js` (æ–°å»º)
- Activities API æœå‹™: `frontend/src/api/activities.js` (å·²å­˜åœ¨ - ç¢ºèª updateActivity)
- å‰ç«¯æ¸¬è©¦: `frontend/tests/unit/views/ActivityDetail.spec.js` (æ–°å»º)
- å‰ç«¯æ¸¬è©¦: `frontend/tests/unit/utils/activityHelpers.spec.js` (æ–°å»º)

**Backend**:
- Activity Model: `backend/models/activity.py` (å·²å­˜åœ¨ - ç¢ºèª status æ¬„ä½)
- Activities Blueprint: `backend/blueprints/activities.py` (å·²å­˜åœ¨ - éœ€æ·»åŠ ç‹€æ…‹é©—è­‰)
- å¾Œç«¯æ¸¬è©¦: `backend/tests/test_activities.py` (å·²å­˜åœ¨ - éœ€è£œå……æ¸¬è©¦æ¡ˆä¾‹)

### Testing Requirements

Based on [Source: architecture/11-æ¸¬è©¦ç­–ç•¥-testing-requirements.md]:

**Unit Testing (Vitest)**:
- **Location**: `frontend/tests/unit/views/ActivityDetail.spec.js`, `frontend/tests/unit/utils/activityHelpers.spec.js`
- **Framework**: Vitest + @vue/test-utils + Element Plus
- **Coverage Target**: 80%+
- **Test Cases**:
  1. **ActivityDetail.vue**:
     - æ¸¬è©¦å‰µå»ºè€…å¯ä»¥çœ‹åˆ°ã€Œæ›´æ”¹ç‹€æ…‹ã€ä¸‹æ‹‰é¸å–®
     - æ¸¬è©¦éå‰µå»ºè€…ä¸é¡¯ç¤ºã€Œæ›´æ”¹ç‹€æ…‹ã€é¸å–®
     - æ¸¬è©¦ç‹€æ…‹æ¨™ç±¤æ­£ç¢ºé¡¯ç¤ºï¼ˆé¡å‹å’Œæ–‡å­—ï¼‰
     - æ¸¬è©¦ç•¶å‰ç‹€æ…‹åœ¨ä¸‹æ‹‰é¸å–®ä¸­ç‚ºç¦ç”¨
     - æ¸¬è©¦é»æ“Šç‹€æ…‹é¸é …è§¸ç™¼ API è«‹æ±‚ï¼ˆMockï¼‰
     - æ¸¬è©¦ç‹€æ…‹è®Šæ›´æˆåŠŸé¡¯ç¤ºæˆåŠŸè¨Šæ¯
     - æ¸¬è©¦ç‹€æ…‹è®Šæ›´å¤±æ•—é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
     - æ¸¬è©¦å–æ¶ˆæ´»å‹•é¡¯ç¤ºç¢ºèªå°è©±æ¡†
  2. **activityHelpers.js**:
     - æ¸¬è©¦ `getActivityStatusType()` è¿”å›æ­£ç¢ºçš„é¡å‹
     - æ¸¬è©¦ `getActivityStatusText()` è¿”å›æ­£ç¢ºçš„ä¸­æ–‡æ–‡å­—
     - æ¸¬è©¦ `canChangeActivityStatus()` ç‹€æ…‹è½‰æ›é‚è¼¯

**Backend Testing (pytest)**:
- **Location**: `backend/tests/test_activities.py`
- **Framework**: pytest + pytest-flask
- **Test Cases**:
  1. æ¸¬è©¦å‰µå»ºè€…æˆåŠŸæ›´æ–°æ´»å‹•ç‹€æ…‹
  2. æ¸¬è©¦éå‰µå»ºè€…ç„¡æ³•æ›´æ–°æ´»å‹•ç‹€æ…‹ï¼ˆè¿”å› 403ï¼‰
  3. æ¸¬è©¦æœªèªè­‰è«‹æ±‚è¿”å› 401
  4. æ¸¬è©¦ç„¡æ•ˆçš„ç‹€æ…‹å€¼è¿”å› 400ï¼ˆè‹¥å¯¦ä½œå¾Œç«¯é©—è­‰ï¼‰
  5. æ¸¬è©¦ `updated_at` æ¬„ä½æ­£ç¢ºæ›´æ–°

**Running Tests**:
```bash
# Frontend
npm run test:unit

# Backend
pytest backend/tests/test_activities.py -v
```

### Technical Constraints

[Source: architecture/2-å‰ç«¯æŠ€è¡“æ£§-frontend-tech-stack.md]

1. **Framework Versions**:
   - Vue.js 3.3.8+
   - Element Plus 2.4.2+
   - Axios 1.6.0+ (HTTP è«‹æ±‚)

2. **Performance Requirements**:
   - API å›æ‡‰æ™‚é–“ < 1000ms

3. **UI/UX Requirements**:
   - éŸ¿æ‡‰å¼è¨­è¨ˆï¼šæ¡Œé¢ã€å¹³æ¿ã€æ‰‹æ©Ÿ
   - ä½¿ç”¨ Element Plus Dropdown å’Œ Tag çµ„ä»¶
   - éŒ¯èª¤è¨Šæ¯æ‡‰æ¸…æ™°ä¸”å…·é«”
   - é‡è¦æ“ä½œéœ€è¦ç¢ºèªæ©Ÿåˆ¶ï¼ˆ`ElMessageBox.confirm()`ï¼‰

4. **Browser Support**:
   - Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

5. **Authentication**:
   - æ‰€æœ‰ API éœ€ JWT èªè­‰
   - åªèƒ½æ›´æ–°è‡ªå·±å‰µå»ºçš„æ´»å‹•ç‹€æ…‹

6. **Status Values**:
   - æœ‰æ•ˆç‹€æ…‹ï¼š`'open'`, `'ongoing'`, `'completed'`, `'cancelled'`
   - é è¨­ç‹€æ…‹ï¼š`'open'`ï¼ˆç•¶å‰ç‚º `'active'`ï¼Œéœ€çµ±ä¸€ï¼‰

### Project Structure Notes

**æ–°å¢æª”æ¡ˆ**:
- âœ… `frontend/src/utils/activityHelpers.js` - æ´»å‹•ç›¸é—œå…±ç”¨å·¥å…·å‡½æ•¸ï¼ˆæ–°å»ºï¼‰
- âœ… `frontend/tests/unit/views/ActivityDetail.spec.js` - ActivityDetail å–®å…ƒæ¸¬è©¦ï¼ˆæ–°å»ºï¼‰
- âœ… `frontend/tests/unit/utils/activityHelpers.spec.js` - activityHelpers å–®å…ƒæ¸¬è©¦ï¼ˆæ–°å»ºï¼‰

**ä¿®æ”¹æª”æ¡ˆ**:
- âœ… `frontend/src/views/ActivityDetail.vue` - æ·»åŠ ç¢ºèªæ©Ÿåˆ¶å’Œç‹€æ…‹è½‰æ›è¦å‰‡
- âœ… `frontend/src/views/Activities.vue` - æ·»åŠ æ´»å‹•åˆ—è¡¨ç‹€æ…‹æ¨™ç±¤ï¼ˆè‹¥ç¼ºå¤±ï¼‰
- âœ… `frontend/src/components/activity/ActivityCard.vue` - æ·»åŠ ç‹€æ…‹æ¨™ç±¤ï¼ˆè‹¥ç¼ºå¤±ï¼‰
- âœ… `backend/blueprints/activities.py` - æ·»åŠ ç‹€æ…‹å€¼é©—è­‰ï¼ˆé¸æ“‡æ€§ï¼‰
- âœ… `backend/tests/test_activities.py` - è£œå……ç‹€æ…‹æ›´æ–°æ¸¬è©¦æ¡ˆä¾‹

**ç„¡çµæ§‹è¡çª**ï¼šæ‰€æœ‰æ–°å¢æª”æ¡ˆç¬¦åˆç¾æœ‰å°ˆæ¡ˆçµæ§‹ã€‚

### Additional Notes

**ç‹€æ…‹è½‰æ›è¦å‰‡**ï¼š
1. **é–‹æ”¾å ±å (open)**:
   - å¯è½‰æ›ç‚ºï¼šé€²è¡Œä¸­ (ongoing)ã€å·²å–æ¶ˆ (cancelled)
   - ä¸å¯è½‰æ›ç‚ºï¼šå·²å®Œæˆ (completed)
2. **é€²è¡Œä¸­ (ongoing)**:
   - å¯è½‰æ›ç‚ºï¼šå·²å®Œæˆ (completed)ã€å·²å–æ¶ˆ (cancelled)
   - ä¸å¯è½‰æ›ç‚ºï¼šé–‹æ”¾å ±å (open)
3. **å·²å®Œæˆ (completed)**:
   - ä¸å¯è½‰æ›ç‚ºä»»ä½•ç‹€æ…‹ï¼ˆçµ‚æ­¢ç‹€æ…‹ï¼‰
4. **å·²å–æ¶ˆ (cancelled)**:
   - ä¸å¯è½‰æ›ç‚ºä»»ä½•ç‹€æ…‹ï¼ˆçµ‚æ­¢ç‹€æ…‹ï¼‰

**ç‹€æ…‹æ¨™ç±¤é¡è‰²è¦ç¯„**ï¼š
- **é–‹æ”¾å ±å**: `success` (ç¶ è‰²) - è¡¨ç¤ºæ´»å‹•æ­£åœ¨æ‹›å‹Ÿï¼Œç©æ¥µç‹€æ…‹
- **é€²è¡Œä¸­**: `warning` (æ©˜è‰²) - è¡¨ç¤ºæ´»å‹•æ­£åœ¨é€²è¡Œï¼Œéœ€è¦æ³¨æ„
- **å·²å®Œæˆ**: `info` (ç°è‰²) - è¡¨ç¤ºæ´»å‹•å·²çµæŸï¼Œä¸­æ€§ç‹€æ…‹
- **å·²å–æ¶ˆ**: `danger` (ç´…è‰²) - è¡¨ç¤ºæ´»å‹•å–æ¶ˆï¼Œè­¦ç¤ºç‹€æ…‹

**ç¢ºèªå°è©±æ¡†æœ€ä½³å¯¦è¸**ï¼š
- ä½¿ç”¨ `ElMessageBox.confirm()` å¯¦ä½œç¢ºèªæ©Ÿåˆ¶
- ç¢ºèªæŒ‰éˆ•æ–‡å­—æ‡‰æ¸…æ¥šè¡¨é”æ“ä½œï¼ˆä¾‹å¦‚ï¼šã€Œç¢ºå®šå–æ¶ˆã€ï¼‰
- æä¾›å–æ¶ˆæŒ‰éˆ•ï¼ˆä¾‹å¦‚ï¼šã€Œè¿”å›ã€ï¼‰
- å°è©±æ¡†æ¨™é¡Œæ‡‰æ¸…æ¥šæè¿°æ“ä½œï¼ˆä¾‹å¦‚ï¼šã€Œç¢ºèªå–æ¶ˆæ´»å‹•ã€ï¼‰
- ä½¿ç”¨ `type: 'warning'` é¡¯ç¤ºè­¦å‘Šåœ–ç¤º

**å…±ç”¨å·¥å…·å‡½æ•¸æœ€ä½³å¯¦è¸**ï¼š
- å°‡é‡è¤‡ä½¿ç”¨çš„é‚è¼¯æå–åˆ° `utils/` ç›®éŒ„
- ä½¿ç”¨ JSDoc è¨»è§£æè¿°å‡½æ•¸ç”¨é€”å’Œåƒæ•¸
- ç¢ºä¿å‡½æ•¸å‘½åæ¸…æ™°ä¸”ç¬¦åˆå°ˆæ¡ˆæ…£ä¾‹
- ç‚ºå·¥å…·å‡½æ•¸æ’°å¯«å–®å…ƒæ¸¬è©¦

**å¾ŒçºŒ Story é—œè¯**ï¼š
- Story 2.1 å·²å¯¦ä½œå»ºç«‹æ´»å‹•åŠŸèƒ½ï¼ˆæ´»å‹•é è¨­ç‹€æ…‹ç‚º `'open'`ï¼‰
- Story 2.2 å·²å¯¦ä½œæ´»å‹•åˆ—è¡¨å’Œç¯©é¸åŠŸèƒ½
- Story 2.3 å°‡å¯¦ä½œæ´»å‹•è©³æƒ…é é¢ï¼ˆæŸ¥çœ‹æ´»å‹•è©³ç´°è³‡è¨Šï¼‰
- Story 2.5 å°‡å¯¦ä½œæ´»å‹•åƒèˆ‡ç”³è«‹èˆ‡å¯©æ ¸

## Testing

### Frontend Testing
```bash
# åŸ·è¡Œå–®å…ƒæ¸¬è©¦
npm run test:unit

# åŸ·è¡Œå¸¶è¦†è“‹ç‡çš„æ¸¬è©¦
npm run test:coverage

# UI æ¸¬è©¦æ¨¡å¼
npm run test:ui
```

### Backend Testing
```bash
# åŸ·è¡Œæ´»å‹•ç›¸é—œæ¸¬è©¦
pytest backend/tests/test_activities.py -v

# å¸¶è¦†è“‹ç‡å ±å‘Š
pytest backend/tests/ --cov=backend/blueprints --cov-report=html
```

### Manual Testing Checklist

- [ ] å‰µå»ºè€…ç™»å…¥ä¸¦è¨ªå•æ´»å‹•è©³æƒ…é 
- [ ] é¡¯ç¤ºã€Œæ›´æ”¹ç‹€æ…‹ã€ä¸‹æ‹‰é¸å–®
- [ ] éå‰µå»ºè€…è¨ªå•æ´»å‹•è©³æƒ…é 
- [ ] ä¸é¡¯ç¤ºã€Œæ›´æ”¹ç‹€æ…‹ã€é¸å–®
- [ ] è®Šæ›´ç‹€æ…‹ç‚ºã€Œé€²è¡Œä¸­ã€
- [ ] é¡¯ç¤ºæˆåŠŸè¨Šæ¯ä¸”ç‹€æ…‹æ¨™ç±¤æ›´æ–°
- [ ] è®Šæ›´ç‹€æ…‹ç‚ºã€Œå·²å®Œæˆã€
- [ ] ç‹€æ…‹æ¨™ç±¤é¡¯ç¤ºç‚ºç°è‰²
- [ ] å˜—è©¦å–æ¶ˆæ´»å‹•
- [ ] é¡¯ç¤ºç¢ºèªå°è©±æ¡†
- [ ] ç¢ºèªå–æ¶ˆå¾Œç‹€æ…‹æ›´æ–°ç‚ºã€Œå·²å–æ¶ˆã€ï¼ˆç´…è‰²ï¼‰
- [ ] å–æ¶ˆç¢ºèªå°è©±æ¡†å¾Œç‹€æ…‹ä¸è®Š
- [ ] æ´»å‹•ç‹€æ…‹ç‚ºã€Œå·²å®Œæˆã€æ™‚æ‰€æœ‰é¸é …ç¦ç”¨
- [ ] æ´»å‹•ç‹€æ…‹ç‚ºã€Œå·²å–æ¶ˆã€æ™‚æ‰€æœ‰é¸é …ç¦ç”¨
- [ ] ç•¶å‰ç‹€æ…‹åœ¨ä¸‹æ‹‰é¸å–®ä¸­ç‚ºç¦ç”¨
- [ ] æ´»å‹•åˆ—è¡¨é é¡¯ç¤ºç‹€æ…‹æ¨™ç±¤
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆï¼ˆæ¡Œé¢/æ‰‹æ©Ÿæ¨¡å¼ï¼‰
- [ ] éå‰µå»ºè€…å˜—è©¦é€é API æ›´æ–°ç‹€æ…‹è¿”å› 403
- [ ] API å›æ‡‰æ™‚é–“ < 1000ms

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-05 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

*æ­¤å€å¡Šç”±é–‹ç™¼ä»£ç†åœ¨å¯¦ä½œæ™‚å¡«å¯«*

### Agent Model Used

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### Debug Log References

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### Completion Notes List

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### File List

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

## QA Results

*æ­¤å€å¡Šç”± QA ä»£ç†å¯©æŸ¥å¾Œæ›´æ–°å¯©æŸ¥çµæœ*
