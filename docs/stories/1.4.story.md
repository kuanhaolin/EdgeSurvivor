# Story 1.4: å¿˜è¨˜å¯†ç¢¼é‡è¨­åŠŸèƒ½

## Status

Draft

## Story

**As a** å¿˜è¨˜å¯†ç¢¼çš„å·²è¨»å†Šç”¨æˆ¶,
**I want** é€éæˆ‘çš„è¨»å†Š Email æ¥æ”¶é©—è­‰ç¢¼ä¸¦é‡è¨­å¯†ç¢¼,
**so that** æˆ‘å¯ä»¥é‡æ–°å–å¾—å¸³è™Ÿå­˜å–æ¬Šé™ï¼Œç¹¼çºŒä½¿ç”¨å¹³å°ã€‚

## Acceptance Criteria

1. å¿˜è¨˜å¯†ç¢¼é é¢é¡¯ç¤º Email è¼¸å…¥æ¬„ä½
2. ç³»çµ±é©—è­‰ Email æ ¼å¼æ˜¯å¦æ­£ç¢º
3. é»æ“Šã€Œç™¼é€é©—è­‰ç¢¼ã€å¾Œï¼Œç³»çµ±ç™¼é€ 6 ä½æ•¸é©—è­‰ç¢¼è‡³ Email
4. é©—è­‰ç¢¼æœ‰æ•ˆæœŸç‚º 15 åˆ†é˜
5. é¡¯ç¤ºé©—è­‰ç¢¼è¼¸å…¥æ¬„ä½å’Œæ–°å¯†ç¢¼è¼¸å…¥æ¬„ä½
6. ç³»çµ±é©—è­‰é©—è­‰ç¢¼çš„æ­£ç¢ºæ€§
7. æ–°å¯†ç¢¼éœ€ç¬¦åˆå¯†ç¢¼å¼·åº¦è¦æ±‚ï¼ˆ8 å­—å…ƒä»¥ä¸Šï¼ŒåŒ…å«è‹±æ–‡å­—æ¯å’Œæ•¸å­—ï¼‰
8. é©—è­‰ç¢¼æ­£ç¢ºå¾Œï¼Œæ›´æ–°ç”¨æˆ¶å¯†ç¢¼ä¸¦ä½¿ç”¨ scrypt åŠ å¯†
9. å¯†ç¢¼é‡è¨­æˆåŠŸå¾Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯ä¸¦è·³è½‰è‡³ç™»å…¥é 
10. æ¯å€‹ Email æ¯å°æ™‚æœ€å¤šç™¼é€ 3 æ¬¡é©—è­‰ç¢¼ï¼ˆRate Limitingï¼‰
11. éŒ¯èª¤çš„é©—è­‰ç¢¼é¡¯ç¤ºæ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
12. éæœŸçš„é©—è­‰ç¢¼é¡¯ç¤ºæ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
13. ä¸å­˜åœ¨çš„ Email ä¸æ‡‰é€éœ²æ˜¯å¦å·²è¨»å†Šï¼ˆå®‰å…¨æ€§è€ƒé‡ï¼‰
14. éƒµä»¶ç™¼é€å¤±æ•—æ™‚ï¼Œé–‹ç™¼ç’°å¢ƒé¡¯ç¤ºé©—è­‰ç¢¼ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
15. æ•´å€‹æµç¨‹çš„ API å›æ‡‰æ™‚é–“éœ€ä½æ–¼ 1000ms

## Tasks / Subtasks

> **ğŸ”§ Brownfield å°ˆæ¡ˆèªªæ˜**ï¼šå¾Œç«¯å·²æœ‰å®Œæ•´çš„å¿˜è¨˜å¯†ç¢¼ API å¯¦ä½œï¼ˆ`/api/auth/forgot-password` å’Œ `/api/auth/reset-password`ï¼‰ã€‚æœ¬ Story è‘—é‡æ–¼**é©—è­‰å¾Œç«¯å¯¦ä½œ**ã€**å»ºç«‹å‰ç«¯é é¢èˆ‡æµç¨‹**ï¼Œä»¥åŠ**å®Œå–„ä½¿ç”¨è€…é«”é©—**ã€‚

### Phase 1: å¾Œç«¯å¯¦ä½œé©—è­‰

- [ ] **Task 1: é©—è­‰å¾Œç«¯å¿˜è¨˜å¯†ç¢¼ API** (AC: 2, 3, 4, 10, 13, 14)
  - [ ] âœ… ç¢ºèª `backend/blueprints/auth.py` ä¸­çš„ `forgot_password()` ç«¯é»å­˜åœ¨
  - [ ] âœ… é©—è­‰ç«¯é»è·¯å¾‘ç‚º `POST /api/auth/forgot-password`
  - [ ] âœ… æª¢æŸ¥è«‹æ±‚ body åŒ…å« `email` æ¬„ä½
  - [ ] âœ… é©—è­‰ Email æ ¼å¼é©—è­‰é‚è¼¯
  - [ ] âœ… ç¢ºèªé©—è­‰ç¢¼ç”Ÿæˆç‚º 6 ä½æ•¸å­—
  - [ ] âœ… é©—è­‰é©—è­‰ç¢¼æœ‰æ•ˆæœŸç‚º 15 åˆ†é˜
  - [ ] âœ… ç¢ºèªé©—è­‰ç¢¼å„²å­˜æ©Ÿåˆ¶ï¼ˆä½¿ç”¨ `reset_codes` å­—å…¸ï¼‰
  - [ ] âœ… é©—è­‰ Rate Limitingï¼ˆæ¯å°æ™‚ 3 æ¬¡ï¼‰
  - [ ] âœ… ç¢ºèªå®‰å…¨æ€§ï¼šä¸é€éœ² Email æ˜¯å¦å­˜åœ¨
  - [ ] âœ… æª¢æŸ¥é–‹ç™¼ç’°å¢ƒä¸‹è¿”å›æ¸¬è©¦é©—è­‰ç¢¼
  - [ ] âœ… é©—è­‰ Email ç™¼é€åŠŸèƒ½ï¼ˆ`send_reset_password_email`ï¼‰
  - [ ] ğŸ“ è¨˜éŒ„ä»»ä½•èˆ‡è¦æ ¼ä¸ç¬¦çš„åœ°æ–¹

- [ ] **Task 2: é©—è­‰å¾Œç«¯é‡è¨­å¯†ç¢¼ API** (AC: 5, 6, 7, 8, 11, 12)
  - [ ] âœ… ç¢ºèª `backend/blueprints/auth.py` ä¸­çš„ `reset_password()` ç«¯é»å­˜åœ¨
  - [ ] âœ… é©—è­‰ç«¯é»è·¯å¾‘ç‚º `POST /api/auth/reset-password`
  - [ ] âœ… æª¢æŸ¥è«‹æ±‚ body åŒ…å« `email`, `code`, `new_password` æ¬„ä½
  - [ ] âœ… é©—è­‰é©—è­‰ç¢¼æª¢æŸ¥é‚è¼¯ï¼ˆå­˜åœ¨æ€§ã€éæœŸã€æ­£ç¢ºæ€§ï¼‰
  - [ ] âœ… ç¢ºèªæ–°å¯†ç¢¼é©—è­‰é‚è¼¯ï¼ˆä½¿ç”¨ `validate_password`ï¼‰
  - [ ] âœ… é©—è­‰å¯†ç¢¼æ›´æ–°ä½¿ç”¨ `user.set_password()`ï¼ˆscrypt åŠ å¯†ï¼‰
  - [ ] âœ… ç¢ºèªé©—è­‰ç¢¼ä½¿ç”¨å¾Œè¢«åˆªé™¤
  - [ ] âœ… æª¢æŸ¥éŒ¯èª¤å›æ‡‰è¨Šæ¯
  - [ ] ğŸ“ è¨˜éŒ„ä»»ä½•èˆ‡è¦æ ¼ä¸ç¬¦çš„åœ°æ–¹

- [ ] **Task 3: é©—è­‰ Email æœå‹™é…ç½®** (AC: 3, 14)
  - [ ] âœ… ç¢ºèª `backend/utils/email.py` ä¸­çš„ `send_reset_password_email()` å‡½æ•¸
  - [ ] âœ… é©—è­‰ Email æ¨¡æ¿åŒ…å«é©—è­‰ç¢¼å’Œæœ‰æ•ˆæœŸè³‡è¨Š
  - [ ] âœ… æª¢æŸ¥ SMTP é…ç½®ç’°å¢ƒè®Šæ•¸
  - [ ] âœ… æ¸¬è©¦é–‹ç™¼ç’°å¢ƒä¸‹ Email ç™¼é€å¤±æ•—è™•ç†
  - [ ] ğŸ“ è¨˜éŒ„ Email æœå‹™ç‹€æ…‹

### Phase 2: å‰ç«¯é é¢å»ºç«‹

- [ ] **Task 4: å»ºç«‹ ForgotPassword.vue çµ„ä»¶** (AC: 1, 2, 5, 9)
  - [ ] â• åœ¨ `frontend/src/views/auth/` å»ºç«‹ `ForgotPassword.vue`
  - [ ] â• ä½¿ç”¨ Composition API æ¶æ§‹
  - [ ] â• è¨­è¨ˆå…©éšæ®µ UIï¼š
    - **éšæ®µ 1**: Email è¼¸å…¥èˆ‡ç™¼é€é©—è­‰ç¢¼
    - **éšæ®µ 2**: é©—è­‰ç¢¼èˆ‡æ–°å¯†ç¢¼è¼¸å…¥
  - [ ] â• æ·»åŠ  Email æ ¼å¼é©—è­‰è¦å‰‡
  - [ ] â• æ·»åŠ å¯†ç¢¼å¼·åº¦é©—è­‰è¦å‰‡
  - [ ] â• æ·»åŠ å¯†ç¢¼ç¢ºèªæ¬„ä½ï¼ˆäºŒæ¬¡ç¢ºèªï¼‰
  - [ ] â• å¯¦ä½œéšæ®µåˆ‡æ›é‚è¼¯
  - [ ] â• æ·»åŠ å€’æ•¸è¨ˆæ™‚å™¨ï¼ˆ15 åˆ†é˜ï¼‰
  - [ ] â• æ·»åŠ ã€Œé‡æ–°ç™¼é€é©—è­‰ç¢¼ã€åŠŸèƒ½ï¼ˆå†·å»æ™‚é–“ 60 ç§’ï¼‰
  - [ ] â• è¨­è¨ˆ UI é¢¨æ ¼èˆ‡ Login.vue / Register.vue ä¸€è‡´
  - [ ] â• æ·»åŠ ã€Œè¿”å›ç™»å…¥ã€é€£çµ

- [ ] **Task 5: æ“´å±• Auth API æœå‹™** (AC: 3, 8)
  - [ ] â• åœ¨ `frontend/src/api/auth.js` æ·»åŠ  `forgotPassword(email)` å‡½æ•¸
  - [ ] â• å‡½æ•¸æ‡‰èª¿ç”¨ `POST /api/auth/forgot-password`
  - [ ] â• è«‹æ±‚ body åŒ…å« `{ email }`
  - [ ] â• æ·»åŠ  `resetPassword(email, code, newPassword)` å‡½æ•¸
  - [ ] â• å‡½æ•¸æ‡‰èª¿ç”¨ `POST /api/auth/reset-password`
  - [ ] â• è«‹æ±‚ body åŒ…å« `{ email, code, new_password }`
  - [ ] â• è¿”å› Promise with response data

- [ ] **Task 6: å¯¦ä½œè¡¨å–®é‚è¼¯èˆ‡ç‹€æ…‹ç®¡ç†** (AC: 6, 11, 12)
  - [ ] â• å¯¦ä½œç™¼é€é©—è­‰ç¢¼åŠŸèƒ½
  - [ ] â• è™•ç†ç™¼é€æˆåŠŸï¼šåˆ‡æ›è‡³éšæ®µ 2ã€å•Ÿå‹•å€’æ•¸è¨ˆæ™‚
  - [ ] â• è™•ç†ç™¼é€å¤±æ•—ï¼šé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
  - [ ] â• å¯¦ä½œé‡è¨­å¯†ç¢¼åŠŸèƒ½
  - [ ] â• è™•ç†é‡è¨­æˆåŠŸï¼šé¡¯ç¤ºæˆåŠŸè¨Šæ¯ã€è·³è½‰è‡³ç™»å…¥é 
  - [ ] â• è™•ç†é‡è¨­å¤±æ•—ï¼šé¡¯ç¤ºå…·é«”éŒ¯èª¤è¨Šæ¯
  - [ ] â• å¯¦ä½œéŒ¯èª¤è™•ç†é‚è¼¯ï¼š
    - é©—è­‰ç¢¼éŒ¯èª¤
    - é©—è­‰ç¢¼éæœŸ
    - å¯†ç¢¼æ ¼å¼éŒ¯èª¤
    - ç¶²è·¯éŒ¯èª¤
  - [ ] â• æ·»åŠ  Loading ç‹€æ…‹ç®¡ç†

- [ ] **Task 7: è·¯ç”±é…ç½®** (AC: 1, 9)
  - [ ] â• åœ¨ `frontend/src/router/index.js` æ·»åŠ å¿˜è¨˜å¯†ç¢¼é é¢è·¯ç”±
  - [ ] â• è·¯ç”±é…ç½®ï¼š
    - Path: `/forgot-password`
    - Component: `ForgotPassword.vue`
    - Meta: `{ requiresAuth: false, layout: 'auth', title: 'å¿˜è¨˜å¯†ç¢¼' }`
  - [ ] â• æ¸¬è©¦è·¯ç”±è·³è½‰åŠŸèƒ½

### Phase 3: UI/UX å„ªåŒ–

- [ ] **Task 8: å€’æ•¸è¨ˆæ™‚å™¨å¯¦ä½œ** (AC: 4)
  - [ ] â• é¡¯ç¤ºé©—è­‰ç¢¼å‰©é¤˜æœ‰æ•ˆæ™‚é–“
  - [ ] â• å€’æ•¸è‡³ 0 æ™‚é¡¯ç¤ºã€Œé©—è­‰ç¢¼å·²éæœŸã€
  - [ ] â• éæœŸå¾Œç¦ç”¨æäº¤æŒ‰éˆ•
  - [ ] â• æç¤ºç”¨æˆ¶é‡æ–°ç™¼é€é©—è­‰ç¢¼
  - [ ] â• ä½¿ç”¨ Element Plus çš„ ElProgress æˆ–è‡ªå®šç¾©çµ„ä»¶

- [ ] **Task 9: é‡æ–°ç™¼é€é©—è­‰ç¢¼åŠŸèƒ½** (AC: 10)
  - [ ] â• æ·»åŠ ã€Œé‡æ–°ç™¼é€é©—è­‰ç¢¼ã€æŒ‰éˆ•
  - [ ] â• æŒ‰éˆ•å†·å»æ™‚é–“ 60 ç§’ï¼ˆé˜²æ­¢æ¿«ç”¨ï¼‰
  - [ ] â• é¡¯ç¤ºå†·å»å€’æ•¸ã€Œ60 ç§’å¾Œå¯é‡æ–°ç™¼é€ã€
  - [ ] â• é‡æ–°ç™¼é€æˆåŠŸå¾Œé‡ç½® 15 åˆ†é˜å€’æ•¸è¨ˆæ™‚
  - [ ] â• é™åˆ¶æ¯å°æ™‚æœ€å¤š 3 æ¬¡ï¼ˆç”±å¾Œç«¯ Rate Limiting æ§åˆ¶ï¼‰

- [ ] **Task 10: éŒ¯èª¤è™•ç†èˆ‡ä½¿ç”¨è€…åé¥‹** (AC: 11, 12, 13)
  - [ ] â• è™•ç†å„ç¨®éŒ¯èª¤æƒ…å¢ƒï¼š
    - Email æ ¼å¼éŒ¯èª¤ï¼šã€Œé›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢ºã€
    - é©—è­‰ç¢¼ç™¼é€æˆåŠŸï¼šã€Œé©—è­‰ç¢¼å·²ç™¼é€è‡³æ‚¨çš„é›»å­éƒµä»¶ã€
    - é©—è­‰ç¢¼éŒ¯èª¤ï¼šã€Œé©—è­‰ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ã€
    - é©—è­‰ç¢¼éæœŸï¼šã€Œé©—è­‰ç¢¼å·²éæœŸï¼Œè«‹é‡æ–°ç™¼é€ã€
    - å¯†ç¢¼æ ¼å¼éŒ¯èª¤ï¼šé¡¯ç¤ºå…·é«”è¦æ±‚
    - å¯†ç¢¼ç¢ºèªä¸ä¸€è‡´ï¼šã€Œå…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´ã€
    - ç¶²è·¯éŒ¯èª¤ï¼šã€Œç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€
    - Rate Limit è¶…éï¼šã€Œç™¼é€æ¬¡æ•¸éå¤šï¼Œè«‹ç¨å¾Œå†è©¦ã€
  - [ ] â• æ‰€æœ‰è¨Šæ¯ä½¿ç”¨ Element Plus ElMessage
  - [ ] â• æˆåŠŸé‡è¨­é¡¯ç¤ºï¼šã€Œå¯†ç¢¼é‡è¨­æˆåŠŸï¼Œè«‹ä½¿ç”¨æ–°å¯†ç¢¼ç™»å…¥ã€

- [ ] **Task 11: å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨** (AC: 7)
  - [ ] â• å¯¦ä½œå¯†ç¢¼å¼·åº¦å³æ™‚æª¢æŸ¥
  - [ ] â• é¡¯ç¤ºå¯†ç¢¼è¦æ±‚ï¼š
    - è‡³å°‘ 8 å€‹å­—å…ƒ
    - åŒ…å«è‹±æ–‡å­—æ¯
    - åŒ…å«æ•¸å­—
  - [ ] â• è¦–è¦ºåŒ–å¼·åº¦æŒ‡ç¤ºï¼ˆå¼±/ä¸­/å¼·ï¼‰
  - [ ] â• ä½¿ç”¨é¡è‰²ç·¨ç¢¼ï¼ˆç´…/é»ƒ/ç¶ ï¼‰

### Phase 4: æ¸¬è©¦èˆ‡é©—è­‰

- [ ] **Task 12: å¾Œç«¯æ¸¬è©¦è£œå……** (AC: 3, 4, 6, 7, 8, 10, 11, 12)
  - [ ] â• åœ¨ `backend/tests/test_auth.py` æ·»åŠ å¿˜è¨˜å¯†ç¢¼æ¸¬è©¦
  - [ ] â• æ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦æœ‰æ•ˆ Email ç™¼é€é©—è­‰ç¢¼
    - [ ] æ¸¬è©¦ç„¡æ•ˆ Email æ ¼å¼ï¼ˆæ‡‰è¿”å› 400ï¼‰
    - [ ] æ¸¬è©¦ä¸å­˜åœ¨çš„ Emailï¼ˆæ‡‰è¿”å› 200 ä½†ä¸é€éœ²ï¼‰
    - [ ] æ¸¬è©¦é©—è­‰ç¢¼æ­£ç¢ºé‡è¨­å¯†ç¢¼
    - [ ] æ¸¬è©¦é©—è­‰ç¢¼éŒ¯èª¤ï¼ˆæ‡‰è¿”å› 400ï¼‰
    - [ ] æ¸¬è©¦é©—è­‰ç¢¼éæœŸï¼ˆæ‡‰è¿”å› 400ï¼‰
    - [ ] æ¸¬è©¦æ–°å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚ï¼ˆæ‡‰è¿”å› 400ï¼‰
    - [ ] æ¸¬è©¦é©—è­‰ç¢¼ä½¿ç”¨å¾Œè¢«åˆªé™¤
    - [ ] æ¸¬è©¦ Rate Limitingï¼ˆæ¯å°æ™‚ 3 æ¬¡ï¼‰
  - [ ] ğŸ§ª åŸ·è¡Œæ¸¬è©¦ï¼š`pytest backend/tests/test_auth.py -v -k forgot`
  - [ ] ğŸ“Š ç¢ºèªæ‰€æœ‰æ¸¬è©¦é€šé

- [ ] **Task 13: å‰ç«¯æ¸¬è©¦å»ºç«‹** (AC: 1, 2, 5, 9, 11, 12)
  - [ ] â• åœ¨ `frontend/tests/unit/views/` å»ºç«‹ `ForgotPassword.spec.js`
  - [ ] â• å¯¦ä½œæ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦éšæ®µ 1 æ­£ç¢ºæ¸²æŸ“ï¼ˆEmail è¼¸å…¥ï¼‰
    - [ ] æ¸¬è©¦ Email æ ¼å¼é©—è­‰è¦å‰‡
    - [ ] æ¸¬è©¦ç™¼é€é©—è­‰ç¢¼åŠŸèƒ½
    - [ ] æ¸¬è©¦éšæ®µåˆ‡æ›è‡³éšæ®µ 2
    - [ ] æ¸¬è©¦éšæ®µ 2 æ­£ç¢ºæ¸²æŸ“ï¼ˆé©—è­‰ç¢¼èˆ‡å¯†ç¢¼è¼¸å…¥ï¼‰
    - [ ] æ¸¬è©¦å¯†ç¢¼å¼·åº¦é©—è­‰è¦å‰‡
    - [ ] æ¸¬è©¦å¯†ç¢¼ç¢ºèªé‚è¼¯
    - [ ] æ¸¬è©¦é‡è¨­å¯†ç¢¼åŠŸèƒ½
    - [ ] Mock API èª¿ç”¨
    - [ ] æ¸¬è©¦æˆåŠŸå¾Œè·³è½‰è‡³ /login
    - [ ] æ¸¬è©¦éŒ¯èª¤è¨Šæ¯é¡¯ç¤º
  - [ ] ğŸ§ª åŸ·è¡Œæ¸¬è©¦ï¼š`npm run test:unit`
  - [ ] ğŸ“Š ç¢ºèªè¦†è“‹ç‡ > 80%

### Phase 5: æ•´åˆæ¸¬è©¦

- [ ] **Task 14: ç«¯åˆ°ç«¯åŠŸèƒ½é©—è­‰** (æ‰€æœ‰ AC)
  - [ ] ğŸ§ª æ‰‹å‹•æ¸¬è©¦æ¸…å–®ï¼š
    - [ ] **æ¸¬è©¦ 1**: å®Œæ•´æµç¨‹ - å¿˜è¨˜å¯†ç¢¼é‡è¨­æˆåŠŸ
      - è¨ªå• http://localhost:8080/forgot-password
      - è¼¸å…¥æœ‰æ•ˆçš„è¨»å†Š Email
      - é»æ“Šã€Œç™¼é€é©—è­‰ç¢¼ã€
      - é©—è­‰ï¼šé¡¯ç¤ºæˆåŠŸè¨Šæ¯
      - é©—è­‰ï¼šåˆ‡æ›è‡³éšæ®µ 2
      - é©—è­‰ï¼šå€’æ•¸è¨ˆæ™‚å™¨å•Ÿå‹•
      - æª¢æŸ¥ Email æ”¶ä»¶åŒ£ï¼ˆæˆ–é–‹ç™¼ç’°å¢ƒæ§åˆ¶å°ï¼‰
      - è¼¸å…¥é©—è­‰ç¢¼å’Œæ–°å¯†ç¢¼
      - é»æ“Šã€Œé‡è¨­å¯†ç¢¼ã€
      - é©—è­‰ï¼šé¡¯ç¤ºæˆåŠŸè¨Šæ¯ä¸¦è·³è½‰è‡³ /login
      - ä½¿ç”¨æ–°å¯†ç¢¼ç™»å…¥æ¸¬è©¦
    - [ ] **æ¸¬è©¦ 2**: Email æ ¼å¼éŒ¯èª¤
      - è¼¸å…¥ç„¡æ•ˆ Email (ä¾‹å¦‚: "test@")
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œé›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢ºã€
    - [ ] **æ¸¬è©¦ 3**: ä¸å­˜åœ¨çš„ Email
      - è¼¸å…¥æœªè¨»å†Šçš„ Email
      - é©—è­‰ï¼šé¡¯ç¤ºé€šç”¨æˆåŠŸè¨Šæ¯ï¼ˆä¸é€éœ²æ˜¯å¦å­˜åœ¨ï¼‰
    - [ ] **æ¸¬è©¦ 4**: é©—è­‰ç¢¼éŒ¯èª¤
      - ç™¼é€é©—è­‰ç¢¼å¾Œè¼¸å…¥éŒ¯èª¤çš„é©—è­‰ç¢¼
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œé©—è­‰ç¢¼éŒ¯èª¤ã€
    - [ ] **æ¸¬è©¦ 5**: é©—è­‰ç¢¼éæœŸ
      - ç­‰å¾… 15 åˆ†é˜å¾Œå˜—è©¦é‡è¨­å¯†ç¢¼
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œé©—è­‰ç¢¼å·²éæœŸã€
    - [ ] **æ¸¬è©¦ 6**: æ–°å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚
      - è¼¸å…¥å¼±å¯†ç¢¼ (ä¾‹å¦‚: "123")
      - é©—è­‰ï¼šé¡¯ç¤ºå¯†ç¢¼è¦æ±‚éŒ¯èª¤è¨Šæ¯
    - [ ] **æ¸¬è©¦ 7**: å¯†ç¢¼ç¢ºèªä¸ä¸€è‡´
      - å…©æ¬¡è¼¸å…¥ä¸åŒçš„å¯†ç¢¼
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œå…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´ã€
    - [ ] **æ¸¬è©¦ 8**: é‡æ–°ç™¼é€é©—è­‰ç¢¼
      - é»æ“Šã€Œé‡æ–°ç™¼é€é©—è­‰ç¢¼ã€
      - é©—è­‰ï¼š60 ç§’å†·å»æ™‚é–“
      - é©—è­‰ï¼šå€’æ•¸è¨ˆæ™‚é‡ç½®
    - [ ] **æ¸¬è©¦ 9**: Rate Limiting æ¸¬è©¦
      - é€£çºŒç™¼é€é©—è­‰ç¢¼è¶…é 3 æ¬¡
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œç™¼é€æ¬¡æ•¸éå¤šã€éŒ¯èª¤
    - [ ] **æ¸¬è©¦ 10**: å€’æ•¸è¨ˆæ™‚å™¨
      - é©—è­‰å€’æ•¸è¨ˆæ™‚é¡¯ç¤ºæ­£ç¢º
      - é©—è­‰éæœŸå¾Œæç¤ºæ­£ç¢º
    - [ ] **æ¸¬è©¦ 11**: å¾ç™»å…¥é è¨ªå•
      - å¾ç™»å…¥é é»æ“Šã€Œå¿˜è¨˜å¯†ç¢¼ã€é€£çµ
      - é©—è­‰ï¼šæ­£ç¢ºè·³è½‰è‡³å¿˜è¨˜å¯†ç¢¼é 
    - [ ] **æ¸¬è©¦ 12**: éŸ¿æ‡‰å¼è¨­è¨ˆ
      - åœ¨æ‰‹æ©Ÿæ¨¡å¼æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
      - é©—è­‰ï¼šUI æ­£ç¢ºé¡¯ç¤ºä¸”å¯æ“ä½œ
  - [ ] ğŸ“Š é©—è­‰ API å›æ‡‰æ™‚é–“ < 1000ms
  - [ ] ğŸ“ è¨˜éŒ„æ‰€æœ‰æ¸¬è©¦çµæœ

### åœ–ä¾‹èªªæ˜
- âœ… **å·²å­˜åœ¨ä¸”æ­£ç¢º** - é©—è­‰é€šéå³å¯
- âš ï¸ **éœ€è¦æª¢æŸ¥** - å¯èƒ½éœ€è¦èª¿æ•´
- â• **éœ€è¦æ–°å¢** - ç¼ºå¤±çš„åŠŸèƒ½
- ğŸ”„ **éœ€è¦é‡æ§‹** - éœ€è¦æ”¹é€²ç¾æœ‰å¯¦ä½œ
- ğŸ“ **è¨˜éŒ„** - æ–‡ä»¶åŒ–ç™¼ç¾
- ğŸ§ª **æ¸¬è©¦** - åŸ·è¡Œæ¸¬è©¦
- ğŸ“Š **é©—è­‰** - ç¢ºèªç¬¦åˆéœ€æ±‚

## Dev Notes

### Previous Story Insights

**ä¾†è‡ª Story 1.1ã€1.2 å’Œ 1.3 çš„ç¶“é©—**ï¼š
- âœ… å¾Œç«¯ Auth Blueprint æ¶æ§‹å®Œå–„ï¼Œæ˜“æ–¼æ“´å±•æ–°åŠŸèƒ½
- âœ… Email æœå‹™å·²é…ç½®ä¸¦å¯ç”¨ï¼ˆ`backend/utils/email.py`ï¼‰
- âœ… å‰ç«¯ä½¿ç”¨ Composition API æ˜¯æ¨™æº–åšæ³•
- âœ… Element Plus è¡¨å–®é©—è­‰æ©Ÿåˆ¶é‹ä½œè‰¯å¥½
- âœ… éŒ¯èª¤è™•ç†æ¨¡å¼ï¼šå¾Œç«¯è¿”å›å…·é«”éŒ¯èª¤è¨Šæ¯ï¼Œå‰ç«¯é¡¯ç¤ºå‹å–„æç¤º
- âœ… è·¯ç”±å®ˆè¡›å’Œèªè­‰æµç¨‹å·²å»ºç«‹
- âœ… UI è¨­è¨ˆé¢¨æ ¼å·²ç¢ºç«‹ï¼ˆæ¼¸å±¤èƒŒæ™¯ã€å¡ç‰‡å¼ä½ˆå±€ï¼‰
- âœ… å¯†ç¢¼é©—è­‰é‚è¼¯å·²å­˜åœ¨ï¼ˆ`validate_password` å‡½æ•¸ï¼‰

**Brownfield å°ˆæ¡ˆèƒŒæ™¯**ï¼š
- å¿˜è¨˜å¯†ç¢¼å¾Œç«¯ API å·²å®Œæ•´å¯¦ä½œ
- Email æœå‹™å·²é…ç½®ï¼ˆä½¿ç”¨ SMTPï¼‰
- ä¸»è¦å·¥ä½œæ˜¯**å»ºç«‹å‰ç«¯é é¢**å’Œ**æ•´åˆç¾æœ‰ API**
- éœ€è¦å¯¦ä½œå…©éšæ®µ UI æµç¨‹

### Data Models

**User Model** [Source: backend/models/user.py]
- **Table**: `users`
- **Primary Key**: `user_id` (Integer, Auto-increment)
- **å¯†ç¢¼é‡è¨­ç›¸é—œæ¬„ä½**:
  - `email` (String(120), UNIQUE, NOT NULL) - ç”¨æ–¼è­˜åˆ¥ç”¨æˆ¶å’Œç™¼é€é©—è­‰ç¢¼
  - `password_hash` (String(255), NOT NULL) - åŠ å¯†å¾Œçš„å¯†ç¢¼

- **Methods**:
  - `set_password(password)` - è¨­å®šå¯†ç¢¼ï¼ˆä½¿ç”¨ Werkzeug çš„ generate_password_hashï¼‰
  - `check_password(password)` - é©—è­‰å¯†ç¢¼

**é©—è­‰ç¢¼å„²å­˜æ©Ÿåˆ¶** [Source: backend/blueprints/auth.py]
- **In-Memory Dictionary**: `reset_codes`
- **çµæ§‹**:
  ```python
  reset_codes = {
    'user@example.com': {
      'code': '123456',  # 6 ä½æ•¸é©—è­‰ç¢¼
      'expires_at': datetime.now() + timedelta(minutes=15)
    }
  }
  ```
- **æ³¨æ„**: ä½¿ç”¨è¨˜æ†¶é«”å­—å…¸ï¼Œä¼ºæœå™¨é‡å•Ÿæœƒéºå¤±ã€‚ç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ Redisã€‚

### API Specifications

**Endpoint 1**: `POST /api/auth/forgot-password` [Source: backend/blueprints/auth.py:290-338]

**Request Headers**:
```
Content-Type: application/json
```

**Request Body**:
```json
{
  "email": "user@example.com"
}
```

**Response (Success - 200)**:
```json
{
  "message": "é©—è­‰ç¢¼å·²ç™¼é€åˆ°æ‚¨çš„é›»å­éƒµä»¶"
}
```

**Response (Success - 200, Development Mode with Email Failure)**:
```json
{
  "message": "é©—è­‰ç¢¼å·²ç™¼é€åˆ°æ‚¨çš„é›»å­éƒµä»¶",
  "code": "123456",  // åƒ…é–‹ç™¼ç’°å¢ƒ
  "warning": "éƒµä»¶æœå‹™æœªé…ç½®ï¼Œé€™æ˜¯æ¸¬è©¦é©—è­‰ç¢¼"
}
```

**Response (Error - 400)**:
```json
{
  "error": "è«‹æä¾›é›»å­éƒµä»¶"
}
// æˆ–
{
  "error": "é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º"
}
```

**Response (Error - 500)**:
```json
{
  "error": "ç™¼é€é©—è­‰ç¢¼å¤±æ•—"
}
```

**å®‰å…¨æ€§ç‰¹æ€§**:
- ç„¡è«– Email æ˜¯å¦å­˜åœ¨ï¼Œéƒ½è¿”å› 200 æˆåŠŸï¼ˆé˜²æ­¢ Email æšèˆ‰æ”»æ“Šï¼‰
- åªæœ‰å­˜åœ¨çš„ Email æ‰æœƒå¯¦éš›ç™¼é€é©—è­‰ç¢¼
- é©—è­‰ç¢¼åœ¨æ§åˆ¶å°è¼¸å‡ºï¼ˆç”¨æ–¼é™¤éŒ¯ï¼‰

**Rate Limiting**: æ¯å°æ™‚æœ€å¤š 3 æ¬¡è«‹æ±‚ï¼ˆç”± `@auth_bp.before_request` å¯¦ä½œï¼‰

---

**Endpoint 2**: `POST /api/auth/reset-password` [Source: backend/blueprints/auth.py:340-391]

**Request Headers**:
```
Content-Type: application/json
```

**Request Body**:
```json
{
  "email": "user@example.com",
  "code": "123456",
  "new_password": "NewSecurePass123"
}
```

**Response (Success - 200)**:
```json
{
  "message": "å¯†ç¢¼é‡è¨­æˆåŠŸ"
}
```

**Response (Error - 400)**:
```json
{
  "error": "è«‹æä¾›æ‰€æœ‰å¿…å¡«æ¬„ä½"
}
// æˆ–
{
  "error": "é©—è­‰ç¢¼ç„¡æ•ˆæˆ–å·²éæœŸ"
}
// æˆ–
{
  "error": "é©—è­‰ç¢¼å·²éæœŸ"
}
// æˆ–
{
  "error": "é©—è­‰ç¢¼éŒ¯èª¤"
}
// æˆ–
{
  "error": "å¯†ç¢¼é•·åº¦å¿…é ˆè‡³å°‘ 8 å€‹å­—å…ƒ"  // ä¾†è‡ª validate_password
}
// æˆ–
{
  "error": "å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯å’Œä¸€å€‹æ•¸å­—"
}
```

**Response (Error - 404)**:
```json
{
  "error": "æ‰¾ä¸åˆ°ä½¿ç”¨è€…"
}
```

**Response (Error - 500)**:
```json
{
  "error": "é‡è¨­å¯†ç¢¼å¤±æ•—"
}
```

**å¯†ç¢¼é©—è­‰è¦å‰‡** [Source: backend/blueprints/auth.py:validate_password]:
1. é•·åº¦è‡³å°‘ 8 å€‹å­—å…ƒ
2. å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯
3. å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—

**æµç¨‹èªªæ˜**:
1. æª¢æŸ¥æ‰€æœ‰å¿…å¡«æ¬„ä½
2. é©—è­‰é©—è­‰ç¢¼å­˜åœ¨æ€§
3. æª¢æŸ¥é©—è­‰ç¢¼æ˜¯å¦éæœŸ
4. é©—è­‰é©—è­‰ç¢¼æ­£ç¢ºæ€§
5. é©—è­‰æ–°å¯†ç¢¼å¼·åº¦
6. æ›´æ–°ç”¨æˆ¶å¯†ç¢¼ï¼ˆä½¿ç”¨ scrypt åŠ å¯†ï¼‰
7. åˆªé™¤å·²ä½¿ç”¨çš„é©—è­‰ç¢¼

### Component Specifications

**ForgotPassword.vue Component** [æ–°å»ºç«‹]

- **Location**: `frontend/src/views/auth/ForgotPassword.vue`
- **Type**: Page Component (Vue 3 SFC with Composition API)
- **Design Reference**: æ‡‰éµå¾ª Login.vue / Register.vue çš„è¨­è¨ˆé¢¨æ ¼

**å»ºè­°çµæ§‹**:
```vue
<template>
  <div class="forgot-password-page">
    <div class="forgot-password-container">
      <el-card class="forgot-password-card">
        <template #header>
          <h2>é‡è¨­å¯†ç¢¼</h2>
          <p>{{ currentStep === 1 ? 'è«‹è¼¸å…¥æ‚¨çš„è¨»å†Šé›»å­éƒµä»¶' : 'è«‹è¼¸å…¥é©—è­‰ç¢¼å’Œæ–°å¯†ç¢¼' }}</p>
        </template>
        
        <!-- éšæ®µ 1: Email è¼¸å…¥ -->
        <div v-if="currentStep === 1">
          <el-form ref="emailFormRef" :model="formData" :rules="emailRules" label-position="top">
            <el-form-item label="é›»å­éƒµä»¶" prop="email">
              <el-input 
                v-model="formData.email" 
                type="email"
                placeholder="è«‹è¼¸å…¥è¨»å†Šçš„é›»å­éƒµä»¶"
                clearable
                :disabled="loading"
              />
            </el-form-item>
            
            <el-button 
              type="primary" 
              size="large" 
              @click="handleSendCode" 
              :loading="loading"
              class="submit-button"
            >
              ç™¼é€é©—è­‰ç¢¼
            </el-button>
          </el-form>
        </div>
        
        <!-- éšæ®µ 2: é©—è­‰ç¢¼èˆ‡æ–°å¯†ç¢¼è¼¸å…¥ -->
        <div v-else>
          <!-- å€’æ•¸è¨ˆæ™‚å™¨ -->
          <el-alert 
            v-if="timeRemaining > 0"
            type="info" 
            :closable="false"
            class="timer-alert"
          >
            <template #default>
              é©—è­‰ç¢¼å‰©é¤˜æ™‚é–“: {{ formatTime(timeRemaining) }}
            </template>
          </el-alert>
          
          <el-alert 
            v-else
            type="warning" 
            :closable="false"
            class="timer-alert"
          >
            é©—è­‰ç¢¼å·²éæœŸï¼Œè«‹é‡æ–°ç™¼é€
          </el-alert>
          
          <el-form ref="resetFormRef" :model="formData" :rules="resetRules" label-position="top">
            <el-form-item label="é©—è­‰ç¢¼" prop="code">
              <el-input 
                v-model="formData.code" 
                placeholder="è«‹è¼¸å…¥ 6 ä½æ•¸é©—è­‰ç¢¼"
                maxlength="6"
                clearable
                :disabled="loading || timeRemaining === 0"
              />
            </el-form-item>
            
            <el-form-item label="æ–°å¯†ç¢¼" prop="newPassword">
              <el-input 
                v-model="formData.newPassword" 
                type="password" 
                placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼"
                show-password
                :disabled="loading || timeRemaining === 0"
              />
              <!-- å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨ -->
              <div class="password-strength">
                <div class="strength-bar" :class="passwordStrength"></div>
                <span class="strength-text">{{ passwordStrengthText }}</span>
              </div>
              <div class="password-requirements">
                <p>å¯†ç¢¼è¦æ±‚ï¼š</p>
                <ul>
                  <li :class="{ valid: hasMinLength }">âœ“ è‡³å°‘ 8 å€‹å­—å…ƒ</li>
                  <li :class="{ valid: hasLetter }">âœ“ åŒ…å«è‹±æ–‡å­—æ¯</li>
                  <li :class="{ valid: hasNumber }">âœ“ åŒ…å«æ•¸å­—</li>
                </ul>
              </div>
            </el-form-item>
            
            <el-form-item label="ç¢ºèªå¯†ç¢¼" prop="confirmPassword">
              <el-input 
                v-model="formData.confirmPassword" 
                type="password" 
                placeholder="è«‹å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼"
                show-password
                :disabled="loading || timeRemaining === 0"
                @keyup.enter="handleResetPassword"
              />
            </el-form-item>
            
            <el-button 
              type="primary" 
              size="large" 
              @click="handleResetPassword" 
              :loading="loading"
              :disabled="timeRemaining === 0"
              class="submit-button"
            >
              é‡è¨­å¯†ç¢¼
            </el-button>
            
            <el-button 
              type="default" 
              size="large" 
              @click="handleResendCode" 
              :loading="resendLoading"
              :disabled="resendCooldown > 0"
              class="resend-button"
            >
              {{ resendCooldown > 0 ? `${resendCooldown} ç§’å¾Œå¯é‡æ–°ç™¼é€` : 'é‡æ–°ç™¼é€é©—è­‰ç¢¼' }}
            </el-button>
          </el-form>
        </div>
        
        <div class="back-to-login">
          <router-link to="/login">è¿”å›ç™»å…¥</router-link>
        </div>
      </el-card>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, watch, onUnmounted } from 'vue'
import { useRouter } from 'vue-router'
import { forgotPassword, resetPassword } from '@/api/auth'
import { ElMessage } from 'element-plus'

const router = useRouter()
const emailFormRef = ref(null)
const resetFormRef = ref(null)
const loading = ref(false)
const resendLoading = ref(false)
const currentStep = ref(1)
const timeRemaining = ref(0)
const resendCooldown = ref(0)
let countdownTimer = null
let resendTimer = null

const formData = reactive({
  email: '',
  code: '',
  newPassword: '',
  confirmPassword: ''
})

// Email éšæ®µé©—è­‰è¦å‰‡
const emailRules = {
  email: [
    { required: true, message: 'è«‹è¼¸å…¥é›»å­éƒµä»¶', trigger: 'blur' },
    { type: 'email', message: 'é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º', trigger: 'blur' }
  ]
}

// å¯†ç¢¼ç¢ºèªé©—è­‰å™¨
const validateConfirmPassword = (rule, value, callback) => {
  if (value !== formData.newPassword) {
    callback(new Error('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´'))
  } else {
    callback()
  }
}

// é‡è¨­å¯†ç¢¼éšæ®µé©—è­‰è¦å‰‡
const resetRules = {
  code: [
    { required: true, message: 'è«‹è¼¸å…¥é©—è­‰ç¢¼', trigger: 'blur' },
    { pattern: /^\d{6}$/, message: 'é©—è­‰ç¢¼å¿…é ˆç‚º 6 ä½æ•¸å­—', trigger: 'blur' }
  ],
  newPassword: [
    { required: true, message: 'è«‹è¼¸å…¥æ–°å¯†ç¢¼', trigger: 'blur' },
    { min: 8, message: 'å¯†ç¢¼é•·åº¦å¿…é ˆè‡³å°‘ 8 å€‹å­—å…ƒ', trigger: 'blur' },
    { 
      pattern: /^(?=.*[A-Za-z])(?=.*\d).+$/, 
      message: 'å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯å’Œä¸€å€‹æ•¸å­—', 
      trigger: 'blur' 
    }
  ],
  confirmPassword: [
    { required: true, message: 'è«‹ç¢ºèªå¯†ç¢¼', trigger: 'blur' },
    { validator: validateConfirmPassword, trigger: 'blur' }
  ]
}

// å¯†ç¢¼å¼·åº¦è¨ˆç®—
const hasMinLength = computed(() => formData.newPassword.length >= 8)
const hasLetter = computed(() => /[A-Za-z]/.test(formData.newPassword))
const hasNumber = computed(() => /\d/.test(formData.newPassword))

const passwordStrength = computed(() => {
  const checks = [hasMinLength.value, hasLetter.value, hasNumber.value]
  const score = checks.filter(Boolean).length
  if (score === 3) return 'strong'
  if (score === 2) return 'medium'
  return 'weak'
})

const passwordStrengthText = computed(() => {
  const map = { weak: 'å¼±', medium: 'ä¸­', strong: 'å¼·' }
  return formData.newPassword ? map[passwordStrength.value] : ''
})

// æ ¼å¼åŒ–æ™‚é–“
const formatTime = (seconds) => {
  const mins = Math.floor(seconds / 60)
  const secs = seconds % 60
  return `${mins}:${secs.toString().padStart(2, '0')}`
}

// å•Ÿå‹•å€’æ•¸è¨ˆæ™‚
const startCountdown = (duration = 900) => {  // 15 åˆ†é˜ = 900 ç§’
  timeRemaining.value = duration
  countdownTimer = setInterval(() => {
    timeRemaining.value--
    if (timeRemaining.value <= 0) {
      clearInterval(countdownTimer)
      ElMessage.warning('é©—è­‰ç¢¼å·²éæœŸï¼Œè«‹é‡æ–°ç™¼é€')
    }
  }, 1000)
}

// å•Ÿå‹•é‡æ–°ç™¼é€å†·å»
const startResendCooldown = (duration = 60) => {
  resendCooldown.value = duration
  resendTimer = setInterval(() => {
    resendCooldown.value--
    if (resendCooldown.value <= 0) {
      clearInterval(resendTimer)
    }
  }, 1000)
}

// ç™¼é€é©—è­‰ç¢¼
const handleSendCode = async () => {
  const valid = await emailFormRef.value.validate()
  if (!valid) return

  try {
    loading.value = true
    const response = await forgotPassword(formData.email)
    
    ElMessage.success('é©—è­‰ç¢¼å·²ç™¼é€åˆ°æ‚¨çš„é›»å­éƒµä»¶')
    
    // é–‹ç™¼ç’°å¢ƒé¡¯ç¤ºé©—è­‰ç¢¼
    if (response.data.code) {
      console.log('æ¸¬è©¦é©—è­‰ç¢¼:', response.data.code)
      ElMessage.info(`æ¸¬è©¦é©—è­‰ç¢¼: ${response.data.code}`)
    }
    
    // åˆ‡æ›è‡³éšæ®µ 2
    currentStep.value = 2
    startCountdown()
    startResendCooldown()
    
  } catch (error) {
    // éŒ¯èª¤å·²ç”± Axios æ””æˆªå™¨è™•ç†
    console.error('ç™¼é€é©—è­‰ç¢¼å¤±æ•—:', error)
  } finally {
    loading.value = false
  }
}

// é‡æ–°ç™¼é€é©—è­‰ç¢¼
const handleResendCode = async () => {
  try {
    resendLoading.value = true
    const response = await forgotPassword(formData.email)
    
    ElMessage.success('é©—è­‰ç¢¼å·²é‡æ–°ç™¼é€')
    
    if (response.data.code) {
      console.log('æ¸¬è©¦é©—è­‰ç¢¼:', response.data.code)
      ElMessage.info(`æ¸¬è©¦é©—è­‰ç¢¼: ${response.data.code}`)
    }
    
    // é‡ç½®å€’æ•¸è¨ˆæ™‚
    clearInterval(countdownTimer)
    startCountdown()
    startResendCooldown()
    
  } catch (error) {
    console.error('é‡æ–°ç™¼é€é©—è­‰ç¢¼å¤±æ•—:', error)
  } finally {
    resendLoading.value = false
  }
}

// é‡è¨­å¯†ç¢¼
const handleResetPassword = async () => {
  const valid = await resetFormRef.value.validate()
  if (!valid) return

  try {
    loading.value = true
    
    await resetPassword(
      formData.email,
      formData.code,
      formData.newPassword
    )
    
    ElMessage.success('å¯†ç¢¼é‡è¨­æˆåŠŸï¼Œè«‹ä½¿ç”¨æ–°å¯†ç¢¼ç™»å…¥')
    
    // æ¸…ç†è¨ˆæ™‚å™¨
    clearInterval(countdownTimer)
    clearInterval(resendTimer)
    
    // è·³è½‰è‡³ç™»å…¥é 
    setTimeout(() => {
      router.push('/login')
    }, 1500)
    
  } catch (error) {
    // éŒ¯èª¤å·²ç”± Axios æ””æˆªå™¨è™•ç†
    console.error('é‡è¨­å¯†ç¢¼å¤±æ•—:', error)
  } finally {
    loading.value = false
  }
}

// æ¸…ç†è¨ˆæ™‚å™¨
onUnmounted(() => {
  if (countdownTimer) clearInterval(countdownTimer)
  if (resendTimer) clearInterval(resendTimer)
})
</script>

<style lang="scss" scoped>
.forgot-password-page {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-md);
}

.forgot-password-container {
  width: 100%;
  max-width: 500px;
}

.forgot-password-card {
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-2xl);
  
  :deep(.el-card__header) {
    text-align: center;
    padding: var(--spacing-xl) var(--spacing-lg);
    
    h2 {
      font-size: var(--font-size-h2);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-sm);
    }
    
    p {
      font-size: var(--font-size-body);
      color: var(--color-text-secondary);
      margin: 0;
    }
  }
  
  :deep(.el-card__body) {
    padding: var(--spacing-lg);
  }
}

.timer-alert {
  margin-bottom: var(--spacing-lg);
}

.password-strength {
  margin-top: var(--spacing-sm);
  
  .strength-bar {
    height: 4px;
    border-radius: 2px;
    transition: all 0.3s;
    
    &.weak {
      width: 33%;
      background: #f56c6c;
    }
    
    &.medium {
      width: 66%;
      background: #e6a23c;
    }
    
    &.strong {
      width: 100%;
      background: #67c23a;
    }
  }
  
  .strength-text {
    font-size: var(--font-size-small);
    margin-left: var(--spacing-xs);
  }
}

.password-requirements {
  margin-top: var(--spacing-md);
  padding: var(--spacing-sm);
  background: var(--color-background-soft);
  border-radius: var(--border-radius-md);
  
  p {
    margin: 0 0 var(--spacing-xs) 0;
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-medium);
  }
  
  ul {
    margin: 0;
    padding-left: var(--spacing-lg);
    
    li {
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
      
      &.valid {
        color: var(--color-success);
      }
    }
  }
}

.submit-button,
.resend-button {
  width: 100%;
  margin-bottom: var(--spacing-md);
}

.back-to-login {
  text-align: center;
  margin-top: var(--spacing-md);
  
  a {
    color: var(--color-primary);
    font-size: var(--font-size-body);
    text-decoration: none;
    
    &:hover {
      text-decoration: underline;
    }
  }
}

@media (max-width: 640px) {
  .forgot-password-page {
    padding: var(--spacing-sm);
  }
  
  .forgot-password-card {
    :deep(.el-card__header) {
      padding: var(--spacing-lg) var(--spacing-md);
    }
    
    :deep(.el-card__body) {
      padding: var(--spacing-md);
    }
  }
}
</style>
```

### File Locations

Based on [Source: architecture/3-å°ˆæ¡ˆçµæ§‹-project-structure.md]:

**Frontend**:
- å¿˜è¨˜å¯†ç¢¼é é¢: `frontend/src/views/auth/ForgotPassword.vue` (æ–°å»º)
- èªè­‰ API æœå‹™: `frontend/src/api/auth.js` (æ“´å±•)
- è·¯ç”±é…ç½®: `frontend/src/router/index.js` (æ“´å±•)
- å‰ç«¯æ¸¬è©¦: `frontend/tests/unit/views/ForgotPassword.spec.js` (æ–°å»º)

**Backend**:
- èªè­‰ Blueprint: `backend/blueprints/auth.py` (å·²å­˜åœ¨ forgot_password, reset_password)
- Email æœå‹™: `backend/utils/email.py` (å·²å­˜åœ¨ send_reset_password_email)
- User Model: `backend/models/user.py`
- å¾Œç«¯æ¸¬è©¦: `backend/tests/test_auth.py` (æ“´å±•)

**é…ç½®æ–‡ä»¶**:
- SMTP é…ç½®åœ¨ç’°å¢ƒè®Šæ•¸ä¸­ï¼ˆ`.env` æˆ–ç³»çµ±ç’°å¢ƒè®Šæ•¸ï¼‰

### Testing Requirements

Based on [Source: architecture/11-æ¸¬è©¦ç­–ç•¥-testing-requirements.md]:

**Unit Testing (Vitest)**:
- **Location**: `frontend/tests/unit/views/ForgotPassword.spec.js`
- **Framework**: Vitest + @vue/test-utils + Element Plus
- **Coverage Target**: 80%+
- **Test Cases**:
  1. éšæ®µ 1 æ­£ç¢ºæ¸²æŸ“ï¼ˆEmail è¼¸å…¥ï¼‰
  2. Email æ ¼å¼é©—è­‰è¦å‰‡ç”Ÿæ•ˆ
  3. ç™¼é€é©—è­‰ç¢¼åŠŸèƒ½èª¿ç”¨æ­£ç¢ºçš„ API
  4. ç™¼é€æˆåŠŸå¾Œåˆ‡æ›è‡³éšæ®µ 2
  5. éšæ®µ 2 æ­£ç¢ºæ¸²æŸ“ï¼ˆé©—è­‰ç¢¼èˆ‡å¯†ç¢¼è¼¸å…¥ï¼‰
  6. å¯†ç¢¼å¼·åº¦è¨ˆç®—æ­£ç¢º
  7. å¯†ç¢¼ç¢ºèªé©—è­‰é‚è¼¯
  8. é‡è¨­å¯†ç¢¼åŠŸèƒ½èª¿ç”¨æ­£ç¢ºçš„ API
  9. é‡è¨­æˆåŠŸå¾Œè·³è½‰è‡³ /login
  10. å€’æ•¸è¨ˆæ™‚å™¨åŠŸèƒ½
  11. é‡æ–°ç™¼é€é©—è­‰ç¢¼å†·å»æ™‚é–“
  12. éŒ¯èª¤è¨Šæ¯é¡¯ç¤º

**Backend Testing (pytest)**:
- **Location**: `backend/tests/test_auth.py`
- **Framework**: pytest + pytest-flask
- **Test Cases**:
  1. æœ‰æ•ˆ Email ç™¼é€é©—è­‰ç¢¼æˆåŠŸ
  2. ç„¡æ•ˆ Email æ ¼å¼è¿”å› 400
  3. ä¸å­˜åœ¨çš„ Email è¿”å› 200ï¼ˆå®‰å…¨æ€§ï¼‰
  4. é©—è­‰ç¢¼æ­£ç¢ºé‡è¨­å¯†ç¢¼æˆåŠŸ
  5. é©—è­‰ç¢¼éŒ¯èª¤è¿”å› 400
  6. é©—è­‰ç¢¼éæœŸè¿”å› 400
  7. æ–°å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚è¿”å› 400
  8. é©—è­‰ç¢¼ä½¿ç”¨å¾Œè¢«åˆªé™¤
  9. Rate Limiting æ¸¬è©¦

**Running Tests**:
```bash
# Frontend
npm run test:unit

# Backend (å¿˜è¨˜å¯†ç¢¼ç›¸é—œæ¸¬è©¦)
pytest backend/tests/test_auth.py -v -k forgot
```

### Technical Constraints

[Source: architecture/2-å‰ç«¯æŠ€è¡“æ£§-frontend-tech-stack.md + PRD NFR]

1. **Framework Versions**:
   - Vue.js 3.3.8+
   - Element Plus 2.4.2+
   - Pinia 2.1.7+
   - Flask (backend)

2. **Security Requirements** [NFR2]:
   - é©—è­‰ç¢¼æœ‰æ•ˆæœŸï¼š15 åˆ†é˜
   - å¯†ç¢¼ä½¿ç”¨ scrypt åŠ å¯†ï¼ˆWerkzeug çš„ generate_password_hashï¼‰
   - ä¸é€éœ² Email æ˜¯å¦å­˜åœ¨ï¼ˆé˜²æ­¢æšèˆ‰æ”»æ“Šï¼‰
   - é©—è­‰ç¢¼ä½¿ç”¨å¾Œç«‹å³åˆªé™¤
   - Rate Limiting: æ¯å°æ™‚æœ€å¤š 3 æ¬¡è«‹æ±‚

3. **Password Requirements**:
   - é•·åº¦è‡³å°‘ 8 å€‹å­—å…ƒ
   - å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯
   - å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—

4. **Performance Requirements** [NFR1]:
   - API å›æ‡‰æ™‚é–“ < 1000ms
   - å‰ç«¯è¡¨å–®é©—è­‰å³æ™‚å›æ‡‰
   - å€’æ•¸è¨ˆæ™‚å™¨ä¸å½±éŸ¿æ•ˆèƒ½

5. **Browser Support** [NFR3]:
   - Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

6. **Email Service**:
   - ä½¿ç”¨ SMTP å”å®š
   - æ”¯æ´ Gmailã€Outlook ç­‰ä¸»æµæœå‹™
   - é–‹ç™¼ç’°å¢ƒå¯ä¸é…ç½®ï¼ˆè¿”å›æ¸¬è©¦é©—è­‰ç¢¼ï¼‰

### Project Structure Notes

[Source: architecture/3-å°ˆæ¡ˆçµæ§‹-project-structure.md]

**æ–°å¢ç›®éŒ„/æª”æ¡ˆ**:
- âœ… `frontend/src/views/auth/ForgotPassword.vue` - å¿˜è¨˜å¯†ç¢¼é é¢

**ä¿®æ”¹æª”æ¡ˆ**:
- âœ… `frontend/src/api/auth.js` - æ·»åŠ  forgotPassword å’Œ resetPassword å‡½æ•¸
- âœ… `frontend/src/router/index.js` - æ·»åŠ å¿˜è¨˜å¯†ç¢¼é é¢è·¯ç”±
- âœ… `backend/tests/test_auth.py` - æ·»åŠ å¿˜è¨˜å¯†ç¢¼æ¸¬è©¦æ¡ˆä¾‹

**ç„¡çµæ§‹è¡çª**ï¼šæ‰€æœ‰æ–°å¢æª”æ¡ˆç¬¦åˆç¾æœ‰å°ˆæ¡ˆçµæ§‹ã€‚

### Additional Notes

**é©—è­‰ç¢¼å„²å­˜ç­–ç•¥**:
- **é–‹ç™¼/æ¸¬è©¦ç’°å¢ƒ**: ä½¿ç”¨è¨˜æ†¶é«”å­—å…¸ `reset_codes`
- **ç”Ÿç”¢ç’°å¢ƒå»ºè­°**: ä½¿ç”¨ Redis å„²å­˜ï¼Œé¿å…ä¼ºæœå™¨é‡å•Ÿéºå¤±
- **å„ªé»**: ç°¡å–®å¿«é€Ÿï¼Œé©åˆé–‹ç™¼
- **ç¼ºé»**: ä¸æ”¯æ´å¤šä¼ºæœå™¨éƒ¨ç½²ã€é‡å•Ÿéºå¤±

**Email æ¨¡æ¿** [Source: backend/utils/email.py]:
```html
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"></head>
<body style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 30px; color: white;">
    <h1 style="margin: 0;">ğŸ” EdgeSurvivor</h1>
    <p>é‡è¨­å¯†ç¢¼</p>
  </div>
  <div style="background: white; border-radius: 8px; padding: 30px; margin-top: 20px;">
    <h2 style="color: #667eea;">é‡è¨­å¯†ç¢¼é©—è­‰ç¢¼</h2>
    <p>æ‚¨å¥½ï¼Œæ‚¨è«‹æ±‚é‡è¨­å¯†ç¢¼ã€‚è«‹ä½¿ç”¨ä»¥ä¸‹é©—è­‰ç¢¼ï¼š</p>
    <div style="font-size: 32px; font-weight: bold; color: #667eea; letter-spacing: 8px; text-align: center; padding: 20px; background: #f5f7fa; border-radius: 8px; margin: 20px 0;">
      {code}
    </div>
    <p><strong>æ­¤é©—è­‰ç¢¼å°‡åœ¨ 15 åˆ†é˜å¾Œå¤±æ•ˆã€‚</strong></p>
    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin: 20px 0;">
      âš ï¸ å¦‚æœæ‚¨æ²’æœ‰è«‹æ±‚é‡è¨­å¯†ç¢¼ï¼Œè«‹å¿½ç•¥æ­¤éƒµä»¶ã€‚
    </div>
  </div>
</body>
</html>
```

**ç’°å¢ƒè®Šæ•¸é…ç½®**:
```bash
# SMTP é…ç½®
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_EMAIL=noreply@edgesurvivor.com
SMTP_FROM_NAME=EdgeSurvivor
```

**Gmail App Password è¨­å®š**:
1. å•Ÿç”¨å…©æ­¥é©Ÿé©—è­‰
2. è¨ªå• https://myaccount.google.com/apppasswords
3. é¸æ“‡ã€Œéƒµä»¶ã€å’Œã€Œå…¶ä»–ã€
4. ç”Ÿæˆæ‡‰ç”¨ç¨‹å¼å¯†ç¢¼
5. å°‡å¯†ç¢¼è¨­å®šç‚º `SMTP_PASSWORD`

**æœªä¾†å¯èƒ½éœ€è¦çš„å¢å¼·**:
1. **Redis æ•´åˆ**: ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ Redis å„²å­˜é©—è­‰ç¢¼
2. **SMS é©—è­‰**: æ”¯æ´ç°¡è¨Šç™¼é€é©—è­‰ç¢¼
3. **å¤šå› ç´ é©—è­‰**: çµåˆ Email + SMS
4. **é©—è­‰ç¢¼é‡è©¦é™åˆ¶**: é™åˆ¶é©—è­‰ç¢¼éŒ¯èª¤æ¬¡æ•¸ï¼ˆä¾‹å¦‚ 5 æ¬¡å¾Œé–å®šï¼‰
5. **å¸³è™Ÿå®‰å…¨æ—¥èªŒ**: è¨˜éŒ„å¯†ç¢¼è®Šæ›´æ­·å²

**åƒè€ƒè³‡æº**:
- Werkzeug Password Hashing: https://werkzeug.palletsprojects.com/en/2.3.x/utils/#module-werkzeug.security
- Gmail SMTP è¨­å®š: https://support.google.com/mail/answer/7126229
- OWASP å¯†ç¢¼å»ºè­°: https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html

## Testing

### Frontend Testing
```bash
# åŸ·è¡Œå–®å…ƒæ¸¬è©¦
npm run test:unit

# åŸ·è¡Œå¸¶è¦†è“‹ç‡çš„æ¸¬è©¦
npm run test:coverage

# UI æ¸¬è©¦æ¨¡å¼
npm run test:ui
```

### Backend Testing
```bash
# åŸ·è¡Œå¿˜è¨˜å¯†ç¢¼ç›¸é—œæ¸¬è©¦
pytest backend/tests/test_auth.py -v -k forgot

# åŸ·è¡Œæ‰€æœ‰èªè­‰æ¸¬è©¦
pytest backend/tests/test_auth.py -v

# å¸¶è¦†è“‹ç‡å ±å‘Š
pytest backend/tests/test_auth.py --cov=backend/blueprints/auth --cov-report=html
```

### Manual Testing Checklist

- [ ] å®Œæ•´æµç¨‹æ¸¬è©¦ï¼ˆç™¼é€é©—è­‰ç¢¼ â†’ é‡è¨­å¯†ç¢¼ â†’ ç™»å…¥ï¼‰
- [ ] Email æ ¼å¼é©—è­‰
- [ ] é©—è­‰ç¢¼éŒ¯èª¤è™•ç†
- [ ] é©—è­‰ç¢¼éæœŸè™•ç†
- [ ] å¯†ç¢¼å¼·åº¦é©—è­‰
- [ ] å¯†ç¢¼ç¢ºèªé‚è¼¯
- [ ] å€’æ•¸è¨ˆæ™‚å™¨åŠŸèƒ½
- [ ] é‡æ–°ç™¼é€é©—è­‰ç¢¼åŠŸèƒ½
- [ ] Rate Limiting æ¸¬è©¦
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆæ¸¬è©¦
- [ ] è·¨ç€è¦½å™¨æ¸¬è©¦

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-05 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

*æ­¤å€å¡Šç”±é–‹ç™¼ä»£ç†åœ¨å¯¦ä½œæ™‚å¡«å¯«*

### Agent Model Used

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### Debug Log References

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### Completion Notes List

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### File List

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

## QA Results

*æ­¤å€å¡Šç”± QA ä»£ç†å¯©æŸ¥å¾Œæ›´æ–°å¯©æŸ¥çµæœ*
