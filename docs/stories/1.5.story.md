# Story 1.5: å¸³è™Ÿç®¡ç† (è®Šæ›´å¯†ç¢¼èˆ‡åˆªé™¤å¸³è™Ÿ)

## Status

Draft

## Story

**As a** å·²ç™»å…¥ä½¿ç”¨è€…,
**I want** èƒ½å¤ è®Šæ›´æˆ‘çš„å¯†ç¢¼æˆ–åˆªé™¤æˆ‘çš„å¸³è™Ÿ,
**so that** æˆ‘å°æˆ‘çš„å¸³è™Ÿæœ‰å®Œå…¨çš„æ§åˆ¶æ¬Šï¼Œä¸¦èƒ½åœ¨éœ€è¦æ™‚ä¿è­·æˆ‘çš„éš±ç§èˆ‡å®‰å…¨ã€‚

## Acceptance Criteria

### è®Šæ›´å¯†ç¢¼åŠŸèƒ½

1. ä½¿ç”¨è€…å¯ä»¥å­˜å–ã€Œå¸³è™Ÿè¨­å®šã€é é¢
2. é é¢æä¾›ã€Œè®Šæ›´å¯†ç¢¼ã€è¡¨å–®ï¼ŒåŒ…å«èˆŠå¯†ç¢¼ã€æ–°å¯†ç¢¼å’Œç¢ºèªæ–°å¯†ç¢¼æ¬„ä½
3. ç³»çµ±é©—è­‰èˆŠå¯†ç¢¼æ˜¯å¦æ­£ç¢º
4. æ–°å¯†ç¢¼éœ€ç¬¦åˆå¯†ç¢¼å¼·åº¦è¦æ±‚ï¼ˆ6 å­—å…ƒä»¥ä¸Šï¼ŒåŒ…å«è‹±æ–‡å­—æ¯å’Œæ•¸å­—ï¼‰
5. æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼å¿…é ˆä¸€è‡´
6. å¯†ç¢¼è®Šæ›´æˆåŠŸå¾Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯
7. å¯†ç¢¼è®Šæ›´å¾Œï¼Œç”¨æˆ¶éœ€é‡æ–°ç™»å…¥ï¼ˆJWT Token å¤±æ•ˆï¼‰
8. èˆŠå¯†ç¢¼éŒ¯èª¤æ™‚é¡¯ç¤ºæ˜ç¢ºçš„éŒ¯èª¤è¨Šæ¯
9. æ–°å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚æ™‚é¡¯ç¤ºå…·é«”çš„éŒ¯èª¤è¨Šæ¯

### åˆªé™¤å¸³è™ŸåŠŸèƒ½

10. ä½¿ç”¨è€…å¯ä»¥åœ¨ã€Œå¸³è™Ÿè¨­å®šã€é é¢æ‰¾åˆ°ã€Œåˆªé™¤å¸³è™Ÿã€æŒ‰éˆ•
11. é»æ“Šã€Œåˆªé™¤å¸³è™Ÿã€å¾Œé¡¯ç¤ºç¢ºèªå°è©±æ¡†
12. ç¢ºèªå°è©±æ¡†æ˜ç¢ºè­¦å‘Šåˆªé™¤å¸³è™Ÿçš„å¾Œæœï¼ˆè³‡æ–™ç„¡æ³•æ¢å¾©ï¼‰
13. ä½¿ç”¨è€…éœ€è¼¸å…¥å¯†ç¢¼ä»¥ç¢ºèªåˆªé™¤æ“ä½œ
14. ç³»çµ±é©—è­‰å¯†ç¢¼æ­£ç¢ºæ€§
15. å¯†ç¢¼éŒ¯èª¤æ™‚é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ä¸¦é˜»æ­¢åˆªé™¤
16. åˆªé™¤æˆåŠŸå¾Œï¼Œæ¸…é™¤æ‰€æœ‰ç›¸é—œè³‡æ–™ï¼š
    - ä½¿ç”¨è€…åŸºæœ¬è³‡æ–™
    - åƒèˆ‡çš„æ´»å‹•è¨˜éŒ„
    - åª’åˆè¨˜éŒ„
    - å‰µå»ºçš„æ´»å‹•ï¼ˆæˆ–è½‰ç§»çµ¦å…¶ä»–ç®¡ç†å“¡ï¼‰
17. åˆªé™¤æˆåŠŸå¾Œï¼Œæ¸…é™¤æœ¬åœ° JWT Token ä¸¦è·³è½‰è‡³é¦–é 
18. åˆªé™¤æˆåŠŸå¾Œé¡¯ç¤ºç¢ºèªè¨Šæ¯ã€Œæ‚¨çš„å¸³è™Ÿå·²æˆåŠŸåˆªé™¤ã€

### é€šç”¨éœ€æ±‚

19. æ‰€æœ‰ API å›æ‡‰æ™‚é–“éœ€ä½æ–¼ 1000ms
20. è¡¨å–®éœ€åŒ…å«å³æ™‚é©—è­‰åé¥‹
21. æ‰€æœ‰æ“ä½œéœ€è¦ä½¿ç”¨è€…èªè­‰ï¼ˆJWT Tokenï¼‰
22. æ‰€æœ‰æ•æ„Ÿæ“ä½œéœ€äºŒæ¬¡ç¢ºèª

## Tasks / Subtasks

> **ğŸ”§ Brownfield å°ˆæ¡ˆèªªæ˜**ï¼šå¾Œç«¯å·²å¯¦ä½œè®Šæ›´å¯†ç¢¼ API (`/api/auth/change-password`) å’Œåˆªé™¤å¸³è™Ÿ API (`/api/users/account`)ã€‚æœ¬ Story è‘—é‡æ–¼**å»ºç«‹å‰ç«¯é é¢**ã€**æ•´åˆç¾æœ‰ API**ï¼Œä»¥åŠ**å®Œå–„ä½¿ç”¨è€…é«”é©—èˆ‡å®‰å…¨ç¢ºèªæµç¨‹**ã€‚

### Phase 1: å¾Œç«¯ API é©—è­‰

- [ ] **Task 1: é©—è­‰è®Šæ›´å¯†ç¢¼ API** (AC: 3, 4, 6, 8, 9)
  - [ ] âœ… ç¢ºèª `backend/blueprints/auth.py` ä¸­çš„ `change_password()` ç«¯é»å­˜åœ¨
  - [ ] âœ… é©—è­‰ç«¯é»è·¯å¾‘ç‚º `POST /api/auth/change-password`
  - [ ] âœ… æª¢æŸ¥éœ€è¦ JWT èªè­‰ (`@jwt_required()`)
  - [ ] âœ… é©—è­‰è«‹æ±‚ body åŒ…å« `old_password`, `new_password` æ¬„ä½
  - [ ] âœ… ç¢ºèªèˆŠå¯†ç¢¼é©—è­‰é‚è¼¯ (`user.check_password()`)
  - [ ] âœ… é©—è­‰æ–°å¯†ç¢¼å¼·åº¦æª¢æŸ¥ (`validate_password()`)
  - [ ] âœ… ç¢ºèªå¯†ç¢¼æ›´æ–°æ©Ÿåˆ¶ (`user.set_password()`)
  - [ ] âœ… æª¢æŸ¥æˆåŠŸ/éŒ¯èª¤å›æ‡‰è¨Šæ¯æ ¼å¼
  - [ ] ğŸ“ è¨˜éŒ„ä»»ä½•èˆ‡è¦æ ¼ä¸ç¬¦çš„åœ°æ–¹

- [ ] **Task 2: é©—è­‰åˆªé™¤å¸³è™Ÿ API** (AC: 13, 14, 15, 16, 17)
  - [ ] âœ… ç¢ºèª `backend/blueprints/users.py` ä¸­çš„ `delete_account()` ç«¯é»å­˜åœ¨
  - [ ] âœ… é©—è­‰ç«¯é»è·¯å¾‘ç‚º `DELETE /api/users/account`
  - [ ] âœ… æª¢æŸ¥éœ€è¦ JWT èªè­‰
  - [ ] âœ… é©—è­‰è«‹æ±‚ body åŒ…å« `password` æ¬„ä½ç”¨æ–¼ç¢ºèª
  - [ ] âœ… ç¢ºèªå¯†ç¢¼é©—è­‰é‚è¼¯
  - [ ] âœ… æª¢æŸ¥ç´šè¯åˆªé™¤é‚è¼¯ï¼š
    - ActivityParticipant è¨˜éŒ„
    - Match è¨˜éŒ„
    - Activity è¨˜éŒ„ï¼ˆå‰µå»ºçš„æ´»å‹•ï¼‰
    - User è¨˜éŒ„
  - [ ] âœ… ç¢ºèªéŒ¯èª¤è™•ç†èˆ‡å›æ‡‰è¨Šæ¯
  - [ ] ğŸ“ è¨˜éŒ„ä»»ä½•èˆ‡è¦æ ¼ä¸ç¬¦çš„åœ°æ–¹

### Phase 2: å‰ç«¯é é¢å»ºç«‹

- [ ] **Task 3: å»ºç«‹ AccountSettings.vue é é¢** (AC: 1, 2, 10, 20)
  - [ ] â• åœ¨ `frontend/src/views/` å»ºç«‹ `AccountSettings.vue`
  - [ ] â• ä½¿ç”¨ Composition API æ¶æ§‹
  - [ ] â• è¨­è¨ˆé é¢ä½ˆå±€ï¼š
    - é é¢æ¨™é¡Œã€Œå¸³è™Ÿè¨­å®šã€
    - è®Šæ›´å¯†ç¢¼å€å¡Š
    - å±éšªå€åŸŸï¼ˆåˆªé™¤å¸³è™Ÿï¼‰
  - [ ] â• æ·»åŠ å°èˆªå®ˆè¡›ï¼ˆéœ€ç™»å…¥æ‰èƒ½å­˜å–ï¼‰
  - [ ] â• è¨­è¨ˆéŸ¿æ‡‰å¼ä½ˆå±€
  - [ ] â• ä½¿ç”¨ Element Plus å¡ç‰‡çµ„ä»¶çµ„ç¹”å…§å®¹

- [ ] **Task 4: å¯¦ä½œè®Šæ›´å¯†ç¢¼è¡¨å–®** (AC: 2, 3, 4, 5, 8, 9, 20)
  - [ ] â• å»ºç«‹è®Šæ›´å¯†ç¢¼è¡¨å–®ï¼ŒåŒ…å«æ¬„ä½ï¼š
    - èˆŠå¯†ç¢¼ï¼ˆtype="password"ï¼‰
    - æ–°å¯†ç¢¼ï¼ˆtype="password"ï¼‰
    - ç¢ºèªæ–°å¯†ç¢¼ï¼ˆtype="password"ï¼‰
  - [ ] â• æ·»åŠ è¡¨å–®é©—è­‰è¦å‰‡ï¼š
    - æ‰€æœ‰æ¬„ä½å¿…å¡«
    - æ–°å¯†ç¢¼é•·åº¦è‡³å°‘ 6 å­—å…ƒ
    - æ–°å¯†ç¢¼å¿…é ˆåŒ…å«è‹±æ–‡å­—æ¯å’Œæ•¸å­—
    - ç¢ºèªå¯†ç¢¼èˆ‡æ–°å¯†ç¢¼å¿…é ˆä¸€è‡´
  - [ ] â• æ·»åŠ å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨
  - [ ] â• æ·»åŠ é¡¯ç¤º/éš±è—å¯†ç¢¼æŒ‰éˆ•
  - [ ] â• å¯¦ä½œå³æ™‚é©—è­‰åé¥‹
  - [ ] â• æ·»åŠ æäº¤æŒ‰éˆ•èˆ‡è¼‰å…¥ç‹€æ…‹

- [ ] **Task 5: å¯¦ä½œåˆªé™¤å¸³è™ŸåŠŸèƒ½** (AC: 10, 11, 12, 13, 22)
  - [ ] â• åœ¨ã€Œå±éšªå€åŸŸã€æ·»åŠ åˆªé™¤å¸³è™Ÿå€å¡Š
  - [ ] â• ä½¿ç”¨è­¦å‘Šæ¨£å¼ï¼ˆç´…è‰²ä¸»é¡Œï¼‰
  - [ ] â• æ·»åŠ ã€Œåˆªé™¤å¸³è™Ÿã€æŒ‰éˆ•
  - [ ] â• å¯¦ä½œç¢ºèªå°è©±æ¡† (ElMessageBox)ï¼š
    - è­¦å‘Šæ¨™é¡Œã€Œç¢ºèªåˆªé™¤å¸³è™Ÿã€
    - æ˜ç¢ºèªªæ˜åˆªé™¤å¾Œæœ
    - åˆ—å‡ºå°‡è¢«åˆªé™¤çš„è³‡æ–™
    - å¯†ç¢¼è¼¸å…¥æ¬„ä½
    - ç¢ºèªèˆ‡å–æ¶ˆæŒ‰éˆ•
  - [ ] â• æ·»åŠ äºŒæ¬¡ç¢ºèªæ©Ÿåˆ¶
  - [ ] â• å¯¦ä½œå¯†ç¢¼é©—è­‰é‚è¼¯

- [ ] **Task 6: æ“´å±• Auth API æœå‹™** (AC: 3, 6)
  - [ ] â• åœ¨ `frontend/src/api/auth.js` æ·»åŠ  `changePassword(oldPassword, newPassword)` å‡½æ•¸
  - [ ] â• å‡½æ•¸æ‡‰èª¿ç”¨ `POST /api/auth/change-password`
  - [ ] â• è«‹æ±‚ body åŒ…å« `{ old_password, new_password }`
  - [ ] â• è¿”å› Promise with response data

- [ ] **Task 7: æ“´å±• Users API æœå‹™** (AC: 16, 17)
  - [ ] â• åœ¨ `frontend/src/api/users.js` æ·»åŠ  `deleteAccount(password)` å‡½æ•¸
  - [ ] â• å‡½æ•¸æ‡‰èª¿ç”¨ `DELETE /api/users/account`
  - [ ] â• è«‹æ±‚ body åŒ…å« `{ password }`
  - [ ] â• è¿”å› Promise with response data

### Phase 3: æ¥­å‹™é‚è¼¯å¯¦ä½œ

- [ ] **Task 8: å¯¦ä½œè®Šæ›´å¯†ç¢¼åŠŸèƒ½** (AC: 6, 7, 8, 9)
  - [ ] â• å»ºç«‹ `handleChangePassword` å‡½æ•¸
  - [ ] â• é©—è­‰è¡¨å–®è³‡æ–™
  - [ ] â• èª¿ç”¨ `changePassword` API
  - [ ] â• è™•ç†æˆåŠŸæƒ…å¢ƒï¼š
    - é¡¯ç¤ºæˆåŠŸè¨Šæ¯
    - æ¸…é™¤è¡¨å–®
    - ç™»å‡ºä½¿ç”¨è€…ï¼ˆæ¸…é™¤ JWT Tokenï¼‰
    - è·³è½‰è‡³ç™»å…¥é 
  - [ ] â• è™•ç†éŒ¯èª¤æƒ…å¢ƒï¼š
    - èˆŠå¯†ç¢¼éŒ¯èª¤
    - æ–°å¯†ç¢¼æ ¼å¼éŒ¯èª¤
    - ç¶²è·¯éŒ¯èª¤
  - [ ] â• æ·»åŠ  Loading ç‹€æ…‹ç®¡ç†

- [ ] **Task 9: å¯¦ä½œåˆªé™¤å¸³è™ŸåŠŸèƒ½** (AC: 14, 15, 16, 17, 18)
  - [ ] â• å»ºç«‹ `handleDeleteAccount` å‡½æ•¸
  - [ ] â• é¡¯ç¤ºç¢ºèªå°è©±æ¡†
  - [ ] â• é©—è­‰å¯†ç¢¼æ¬„ä½
  - [ ] â• èª¿ç”¨ `deleteAccount` API
  - [ ] â• è™•ç†æˆåŠŸæƒ…å¢ƒï¼š
    - é¡¯ç¤ºæˆåŠŸè¨Šæ¯ã€Œæ‚¨çš„å¸³è™Ÿå·²æˆåŠŸåˆªé™¤ã€
    - æ¸…é™¤ Auth Store ç‹€æ…‹
    - æ¸…é™¤æœ¬åœ° JWT Token
    - è·³è½‰è‡³é¦–é æˆ–ç™»å…¥é 
  - [ ] â• è™•ç†éŒ¯èª¤æƒ…å¢ƒï¼š
    - å¯†ç¢¼éŒ¯èª¤
    - ç¶²è·¯éŒ¯èª¤
    - ä¼ºæœå™¨éŒ¯èª¤
  - [ ] â• æ·»åŠ  Loading ç‹€æ…‹ç®¡ç†

### Phase 4: è·¯ç”±èˆ‡å°èˆª

- [ ] **Task 10: è·¯ç”±é…ç½®** (AC: 1, 21)
  - [ ] â• åœ¨ `frontend/src/router/index.js` æ·»åŠ å¸³è™Ÿè¨­å®šè·¯ç”±
  - [ ] â• è·¯ç”±é…ç½®ï¼š
    - Path: `/account/settings`
    - Component: `AccountSettings.vue`
    - Meta: `{ requiresAuth: true, title: 'å¸³è™Ÿè¨­å®š' }`
  - [ ] â• æ·»åŠ è·¯ç”±å®ˆè¡›ï¼ˆéœ€ç™»å…¥ï¼‰
  - [ ] â• æ¸¬è©¦è·¯ç”±å°èˆªåŠŸèƒ½

- [ ] **Task 11: å°èˆªé€£çµæ•´åˆ** (AC: 1)
  - [ ] â• åœ¨ä½¿ç”¨è€…ä¸‹æ‹‰é¸å–®æ·»åŠ ã€Œå¸³è™Ÿè¨­å®šã€é¸é …
  - [ ] â• åœ¨å€‹äººè³‡æ–™é é¢æ·»åŠ ã€Œå¸³è™Ÿè¨­å®šã€é€£çµ
  - [ ] â• é©—è­‰å°èˆªåŠŸèƒ½æ­£å¸¸

### Phase 5: UI/UX å„ªåŒ–

- [ ] **Task 12: å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨** (AC: 4, 20)
  - [ ] â• å¯¦ä½œå¯†ç¢¼å¼·åº¦å³æ™‚æª¢æŸ¥
  - [ ] â• é¡¯ç¤ºå¯†ç¢¼è¦æ±‚ï¼š
    - è‡³å°‘ 6 å€‹å­—å…ƒ
    - åŒ…å«è‹±æ–‡å­—æ¯
    - åŒ…å«æ•¸å­—
  - [ ] â• è¦–è¦ºåŒ–å¼·åº¦æŒ‡ç¤ºï¼ˆå¼±/ä¸­/å¼·ï¼‰
  - [ ] â• ä½¿ç”¨é¡è‰²ç·¨ç¢¼ï¼ˆç´…/é»ƒ/ç¶ ï¼‰

- [ ] **Task 13: éŒ¯èª¤è™•ç†èˆ‡ä½¿ç”¨è€…åé¥‹** (AC: 8, 9, 15, 18)
  - [ ] â• å¯¦ä½œæ‰€æœ‰éŒ¯èª¤æƒ…å¢ƒçš„è™•ç†ï¼š
    - **è®Šæ›´å¯†ç¢¼**:
      - èˆŠå¯†ç¢¼éŒ¯èª¤ï¼šã€ŒèˆŠå¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ã€
      - æ–°å¯†ç¢¼æ ¼å¼éŒ¯èª¤ï¼šé¡¯ç¤ºå…·é«”è¦æ±‚
      - ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´ï¼šã€Œå…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´ã€
      - æˆåŠŸï¼šã€Œå¯†ç¢¼è®Šæ›´æˆåŠŸï¼Œè«‹é‡æ–°ç™»å…¥ã€
    - **åˆªé™¤å¸³è™Ÿ**:
      - å¯†ç¢¼éŒ¯èª¤ï¼šã€Œå¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•åˆªé™¤å¸³è™Ÿã€
      - æˆåŠŸï¼šã€Œæ‚¨çš„å¸³è™Ÿå·²æˆåŠŸåˆªé™¤ã€
    - **ç¶²è·¯éŒ¯èª¤**:
      - ã€Œç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€
  - [ ] â• ä½¿ç”¨ Element Plus ElMessage é¡¯ç¤ºè¨Šæ¯
  - [ ] â• ä½¿ç”¨ ElMessageBox é¡¯ç¤ºç¢ºèªå°è©±æ¡†

- [ ] **Task 14: å®‰å…¨ç¢ºèªæ©Ÿåˆ¶** (AC: 11, 12, 13, 22)
  - [ ] â• å¯¦ä½œåˆªé™¤å¸³è™Ÿç¢ºèªå°è©±æ¡†
  - [ ] â• å°è©±æ¡†å…§å®¹ï¼š
    - æ˜ç¢ºæ¨™é¡Œã€Œç¢ºèªåˆªé™¤å¸³è™Ÿï¼Ÿã€
    - è­¦å‘Šè¨Šæ¯ï¼šã€Œæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼ã€
    - åˆ—å‡ºå°‡è¢«åˆªé™¤çš„è³‡æ–™ï¼š
      - å€‹äººè³‡æ–™
      - æ´»å‹•è¨˜éŒ„
      - åª’åˆè¨˜éŒ„
      - èŠå¤©è¨Šæ¯
    - å¯†ç¢¼è¼¸å…¥æ¬„ä½ï¼ˆå¿…å¡«ï¼‰
    - ç¢ºèªèˆ‡å–æ¶ˆæŒ‰éˆ•
  - [ ] â• ä½¿ç”¨å±éšªæ¨£å¼ï¼ˆç´…è‰²ä¸»é¡Œï¼‰
  - [ ] â• ç¢ºèªæŒ‰éˆ•æ–‡å­—ã€Œç¢ºèªåˆªé™¤ã€

### Phase 6: æ¸¬è©¦èˆ‡é©—è­‰

- [ ] **Task 15: å¾Œç«¯æ¸¬è©¦è£œå……** (AC: 3, 4, 6, 13, 14, 16)
  - [ ] â• åœ¨ `backend/tests/test_auth.py` æ·»åŠ è®Šæ›´å¯†ç¢¼æ¸¬è©¦
  - [ ] â• æ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦æœ‰æ•ˆçš„å¯†ç¢¼è®Šæ›´
    - [ ] æ¸¬è©¦èˆŠå¯†ç¢¼éŒ¯èª¤ï¼ˆæ‡‰è¿”å› 400ï¼‰
    - [ ] æ¸¬è©¦æ–°å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚ï¼ˆæ‡‰è¿”å› 400ï¼‰
    - [ ] æ¸¬è©¦æœªèªè­‰è«‹æ±‚ï¼ˆæ‡‰è¿”å› 401ï¼‰
  - [ ] â• åœ¨ `backend/tests/test_users.py` å»ºç«‹æˆ–æ“´å±•åˆªé™¤å¸³è™Ÿæ¸¬è©¦
  - [ ] â• æ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦æœ‰æ•ˆçš„å¸³è™Ÿåˆªé™¤
    - [ ] æ¸¬è©¦å¯†ç¢¼éŒ¯èª¤ï¼ˆæ‡‰è¿”å› 400ï¼‰
    - [ ] æ¸¬è©¦ç´šè¯åˆªé™¤ï¼ˆé©—è­‰é—œè¯è³‡æ–™è¢«åˆªé™¤ï¼‰
    - [ ] æ¸¬è©¦æœªèªè­‰è«‹æ±‚ï¼ˆæ‡‰è¿”å› 401ï¼‰
  - [ ] ğŸ§ª åŸ·è¡Œæ¸¬è©¦ï¼š`pytest backend/tests/test_auth.py backend/tests/test_users.py -v`
  - [ ] ğŸ“Š ç¢ºèªæ‰€æœ‰æ¸¬è©¦é€šé

- [ ] **Task 16: å‰ç«¯æ¸¬è©¦å»ºç«‹** (AC: 2, 4, 5, 10, 11, 12)
  - [ ] â• åœ¨ `frontend/tests/unit/views/` å»ºç«‹ `AccountSettings.spec.js`
  - [ ] â• å¯¦ä½œæ¸¬è©¦æ¡ˆä¾‹ï¼š
    - [ ] æ¸¬è©¦é é¢æ­£ç¢ºæ¸²æŸ“
    - [ ] æ¸¬è©¦è®Šæ›´å¯†ç¢¼è¡¨å–®æ¸²æŸ“
    - [ ] æ¸¬è©¦å¯†ç¢¼å¼·åº¦é©—è­‰è¦å‰‡
    - [ ] æ¸¬è©¦å¯†ç¢¼ç¢ºèªé‚è¼¯
    - [ ] æ¸¬è©¦è®Šæ›´å¯†ç¢¼åŠŸèƒ½ï¼ˆæˆåŠŸæƒ…å¢ƒï¼‰
    - [ ] æ¸¬è©¦è®Šæ›´å¯†ç¢¼åŠŸèƒ½ï¼ˆèˆŠå¯†ç¢¼éŒ¯èª¤ï¼‰
    - [ ] æ¸¬è©¦åˆªé™¤å¸³è™ŸæŒ‰éˆ•å­˜åœ¨
    - [ ] æ¸¬è©¦åˆªé™¤å¸³è™Ÿç¢ºèªå°è©±æ¡†
    - [ ] æ¸¬è©¦åˆªé™¤å¸³è™ŸåŠŸèƒ½ï¼ˆæˆåŠŸæƒ…å¢ƒï¼‰
    - [ ] æ¸¬è©¦åˆªé™¤å¸³è™ŸåŠŸèƒ½ï¼ˆå¯†ç¢¼éŒ¯èª¤ï¼‰
    - [ ] Mock API èª¿ç”¨
    - [ ] æ¸¬è©¦ç™»å‡ºèˆ‡è·³è½‰é‚è¼¯
  - [ ] ğŸ§ª åŸ·è¡Œæ¸¬è©¦ï¼š`npm run test:unit`
  - [ ] ğŸ“Š ç¢ºèªè¦†è“‹ç‡ > 80%

### Phase 7: æ•´åˆæ¸¬è©¦

- [ ] **Task 17: ç«¯åˆ°ç«¯åŠŸèƒ½é©—è­‰** (æ‰€æœ‰ AC)
  - [ ] ğŸ§ª æ‰‹å‹•æ¸¬è©¦æ¸…å–®ï¼š
    - [ ] **æ¸¬è©¦ 1**: å®Œæ•´è®Šæ›´å¯†ç¢¼æµç¨‹
      - ç™»å…¥å¸³è™Ÿ
      - è¨ªå• http://localhost:8080/account/settings
      - è¼¸å…¥èˆŠå¯†ç¢¼ã€æ–°å¯†ç¢¼ã€ç¢ºèªå¯†ç¢¼
      - é»æ“Šã€Œè®Šæ›´å¯†ç¢¼ã€
      - é©—è­‰ï¼šé¡¯ç¤ºæˆåŠŸè¨Šæ¯
      - é©—è­‰ï¼šè‡ªå‹•ç™»å‡ºä¸¦è·³è½‰è‡³ç™»å…¥é 
      - ä½¿ç”¨æ–°å¯†ç¢¼é‡æ–°ç™»å…¥
      - é©—è­‰ï¼šç™»å…¥æˆåŠŸ
    - [ ] **æ¸¬è©¦ 2**: èˆŠå¯†ç¢¼éŒ¯èª¤
      - è¼¸å…¥éŒ¯èª¤çš„èˆŠå¯†ç¢¼
      - é©—è­‰ï¼šé¡¯ç¤ºã€ŒèˆŠå¯†ç¢¼éŒ¯èª¤ã€
    - [ ] **æ¸¬è©¦ 3**: æ–°å¯†ç¢¼æ ¼å¼éŒ¯èª¤
      - è¼¸å…¥å¼±å¯†ç¢¼ï¼ˆä¾‹å¦‚ "123"ï¼‰
      - é©—è­‰ï¼šé¡¯ç¤ºå¯†ç¢¼è¦æ±‚éŒ¯èª¤è¨Šæ¯
    - [ ] **æ¸¬è©¦ 4**: ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´
      - æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸åŒ
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œå…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´ã€
    - [ ] **æ¸¬è©¦ 5**: å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨
      - è¼¸å…¥ä¸åŒå¼·åº¦çš„å¯†ç¢¼
      - é©—è­‰ï¼šå¼·åº¦æŒ‡ç¤ºå™¨æ­£ç¢ºé¡¯ç¤º
    - [ ] **æ¸¬è©¦ 6**: å®Œæ•´åˆªé™¤å¸³è™Ÿæµç¨‹
      - è¨ªå•å¸³è™Ÿè¨­å®šé 
      - é»æ“Šã€Œåˆªé™¤å¸³è™Ÿã€
      - é©—è­‰ï¼šé¡¯ç¤ºç¢ºèªå°è©±æ¡†
      - é©—è­‰ï¼šå°è©±æ¡†åŒ…å«è­¦å‘Šè¨Šæ¯
      - è¼¸å…¥å¯†ç¢¼
      - é»æ“Šã€Œç¢ºèªåˆªé™¤ã€
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œæ‚¨çš„å¸³è™Ÿå·²æˆåŠŸåˆªé™¤ã€
      - é©—è­‰ï¼šè·³è½‰è‡³é¦–é 
      - é©—è­‰ï¼šç„¡æ³•ä½¿ç”¨å·²åˆªé™¤çš„å¸³è™Ÿç™»å…¥
    - [ ] **æ¸¬è©¦ 7**: åˆªé™¤å¸³è™Ÿå¯†ç¢¼éŒ¯èª¤
      - é»æ“Šã€Œåˆªé™¤å¸³è™Ÿã€
      - è¼¸å…¥éŒ¯èª¤å¯†ç¢¼
      - é©—è­‰ï¼šé¡¯ç¤ºã€Œå¯†ç¢¼éŒ¯èª¤ã€
      - é©—è­‰ï¼šå¸³è™Ÿæœªè¢«åˆªé™¤
    - [ ] **æ¸¬è©¦ 8**: åˆªé™¤å¸³è™Ÿå–æ¶ˆæ“ä½œ
      - é»æ“Šã€Œåˆªé™¤å¸³è™Ÿã€
      - é»æ“Šã€Œå–æ¶ˆã€
      - é©—è­‰ï¼šå°è©±æ¡†é—œé–‰
      - é©—è­‰ï¼šå¸³è™Ÿæœªè¢«åˆªé™¤
    - [ ] **æ¸¬è©¦ 9**: æœªç™»å…¥å­˜å–ä¿è­·
      - ç™»å‡ºç‹€æ…‹è¨ªå• /account/settings
      - é©—è­‰ï¼šè·³è½‰è‡³ç™»å…¥é 
    - [ ] **æ¸¬è©¦ 10**: å°èˆªé€£çµæ¸¬è©¦
      - å¾ä½¿ç”¨è€…ä¸‹æ‹‰é¸å–®è¨ªå•å¸³è™Ÿè¨­å®š
      - å¾å€‹äººè³‡æ–™é è¨ªå•å¸³è™Ÿè¨­å®š
      - é©—è­‰ï¼šæ­£ç¢ºè·³è½‰
    - [ ] **æ¸¬è©¦ 11**: éŸ¿æ‡‰å¼è¨­è¨ˆ
      - åœ¨æ‰‹æ©Ÿæ¨¡å¼æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
      - é©—è­‰ï¼šUI æ­£ç¢ºé¡¯ç¤ºä¸”å¯æ“ä½œ
  - [ ] ğŸ“Š é©—è­‰ API å›æ‡‰æ™‚é–“ < 1000ms
  - [ ] ğŸ“ è¨˜éŒ„æ‰€æœ‰æ¸¬è©¦çµæœ

### åœ–ä¾‹èªªæ˜
- âœ… **å·²å­˜åœ¨ä¸”æ­£ç¢º** - é©—è­‰é€šéå³å¯
- âš ï¸ **éœ€è¦æª¢æŸ¥** - å¯èƒ½éœ€è¦èª¿æ•´
- â• **éœ€è¦æ–°å¢** - ç¼ºå¤±çš„åŠŸèƒ½
- ğŸ”„ **éœ€è¦é‡æ§‹** - éœ€è¦æ”¹é€²ç¾æœ‰å¯¦ä½œ
- ğŸ“ **è¨˜éŒ„** - æ–‡ä»¶åŒ–ç™¼ç¾
- ğŸ§ª **æ¸¬è©¦** - åŸ·è¡Œæ¸¬è©¦
- ğŸ“Š **é©—è­‰** - ç¢ºèªç¬¦åˆéœ€æ±‚

## Dev Notes

### Previous Story Insights

**ä¾†è‡ª Story 1.1ã€1.2ã€1.3 å’Œ 1.4 çš„ç¶“é©—**ï¼š
- âœ… å¾Œç«¯ Auth Blueprint æ¶æ§‹å®Œå–„ï¼Œæ˜“æ–¼æ“´å±•æ–°åŠŸèƒ½
- âœ… JWT èªè­‰æ©Ÿåˆ¶é‹ä½œè‰¯å¥½ (`@jwt_required()` è£é£¾å™¨)
- âœ… å‰ç«¯ä½¿ç”¨ Composition API æ˜¯æ¨™æº–åšæ³•
- âœ… Element Plus è¡¨å–®é©—è­‰æ©Ÿåˆ¶é‹ä½œè‰¯å¥½
- âœ… Pinia Auth Store å·²å»ºç«‹ï¼Œç”¨æ–¼ç®¡ç†èªè­‰ç‹€æ…‹
- âœ… éŒ¯èª¤è™•ç†æ¨¡å¼ï¼šå¾Œç«¯è¿”å›å…·é«”éŒ¯èª¤è¨Šæ¯ï¼Œå‰ç«¯é¡¯ç¤ºå‹å–„æç¤º
- âœ… è·¯ç”±å®ˆè¡›å’Œèªè­‰æµç¨‹å·²å»ºç«‹
- âœ… å¯†ç¢¼é©—è­‰é‚è¼¯å·²å­˜åœ¨ï¼ˆ`validate_password` å‡½æ•¸ï¼‰
- âœ… UI è¨­è¨ˆé¢¨æ ¼å·²ç¢ºç«‹

**Brownfield å°ˆæ¡ˆèƒŒæ™¯**ï¼š
- è®Šæ›´å¯†ç¢¼å’Œåˆªé™¤å¸³è™Ÿ API å·²å®Œæ•´å¯¦ä½œ
- ä¸»è¦å·¥ä½œæ˜¯**å»ºç«‹å‰ç«¯é é¢**å’Œ**æ•´åˆç¾æœ‰ API**
- éœ€è¦å¯¦ä½œå¼·å¤§çš„å®‰å…¨ç¢ºèªæ©Ÿåˆ¶ï¼ˆç‰¹åˆ¥æ˜¯åˆªé™¤å¸³è™Ÿï¼‰

### Data Models

**User Model** [Source: backend/models/user.py]
- **Table**: `users`
- **Primary Key**: `user_id` (Integer, Auto-increment)
- **å¸³è™Ÿç®¡ç†ç›¸é—œæ¬„ä½**:
  - `email` (String(120), UNIQUE, NOT NULL) - ä½¿ç”¨è€…å¸³è™Ÿ
  - `password_hash` (String(255), NOT NULL) - åŠ å¯†å¾Œçš„å¯†ç¢¼
  - `created_at` (DateTime) - å¸³è™Ÿå»ºç«‹æ™‚é–“
  - `last_login` (DateTime) - æœ€å¾Œç™»å…¥æ™‚é–“

- **Methods**:
  - `set_password(password)` - è¨­å®šå¯†ç¢¼ï¼ˆä½¿ç”¨ Werkzeug çš„ generate_password_hashï¼‰
  - `check_password(password)` - é©—è­‰å¯†ç¢¼

**é—œè¯è³‡æ–™ï¼ˆåˆªé™¤å¸³è™Ÿæ™‚éœ€ç´šè¯åˆªé™¤ï¼‰**:
- **ActivityParticipant**: åƒèˆ‡çš„æ´»å‹•è¨˜éŒ„
- **Match**: åª’åˆè¨˜éŒ„ï¼ˆuser_a æˆ– user_bï¼‰
- **Activity**: å‰µå»ºçš„æ´»å‹•
- **ChatMessage**: èŠå¤©è¨Šæ¯ï¼ˆæœªä¾†å¯èƒ½éœ€è¦ï¼‰
- **ActivityReview**: æ´»å‹•è©•åƒ¹ï¼ˆæœªä¾†å¯èƒ½éœ€è¦ï¼‰
- **Expense**: è²»ç”¨è¨˜éŒ„ï¼ˆæœªä¾†å¯èƒ½éœ€è¦ï¼‰

### API Specifications

**Endpoint 1**: `POST /api/auth/change-password` [Source: backend/blueprints/auth.py:196-228]

**Authentication**: Required (JWT Token)

**Request Headers**:
```
Content-Type: application/json
Authorization: Bearer <JWT_TOKEN>
```

**Request Body**:
```json
{
  "old_password": "oldpass123",
  "new_password": "newpass456"
}
```

**Response (Success - 200)**:
```json
{
  "message": "å¯†ç¢¼ä¿®æ”¹æˆåŠŸ"
}
```

**Response (Error - 400)**:
```json
{
  "error": "è«‹æä¾›èˆŠå¯†ç¢¼å’Œæ–°å¯†ç¢¼"
}
// æˆ–
{
  "error": "èˆŠå¯†ç¢¼éŒ¯èª¤"
}
// æˆ–
{
  "error": "å¯†ç¢¼é•·åº¦å¿…é ˆè‡³å°‘ 6 å€‹å­—å…ƒ"  // ä¾†è‡ª validate_password
}
// æˆ–
{
  "error": "å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯å’Œä¸€å€‹æ•¸å­—"
}
```

**Response (Error - 404)**:
```json
{
  "error": "æ‰¾ä¸åˆ°ä½¿ç”¨è€…"
}
```

**Response (Error - 500)**:
```json
{
  "error": "å¯†ç¢¼ä¿®æ”¹å¤±æ•—"
}
```

**å¯†ç¢¼é©—è­‰è¦å‰‡** [Source: backend/blueprints/auth.py:validate_password]:
1. é•·åº¦è‡³å°‘ 6 å€‹å­—å…ƒ
2. å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯
3. å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—

**æµç¨‹èªªæ˜**:
1. é©—è­‰ JWT Tokenï¼ˆç²å–ç•¶å‰ç”¨æˆ¶ IDï¼‰
2. æª¢æŸ¥å¿…å¡«æ¬„ä½ï¼ˆold_password, new_passwordï¼‰
3. é©—è­‰èˆŠå¯†ç¢¼æ­£ç¢ºæ€§
4. é©—è­‰æ–°å¯†ç¢¼å¼·åº¦
5. æ›´æ–°ç”¨æˆ¶å¯†ç¢¼
6. æäº¤è³‡æ–™åº«è®Šæ›´

---

**Endpoint 2**: `DELETE /api/users/account` [Source: backend/blueprints/users.py:258-297]

**Authentication**: Required (JWT Token)

**Request Headers**:
```
Content-Type: application/json
Authorization: Bearer <JWT_TOKEN>
```

**Request Body**:
```json
{
  "password": "userpassword123"
}
```

**Response (Success - 200)**:
```json
{
  "message": "å¸³è™Ÿå·²åˆªé™¤"
}
```

**Response (Error - 400)**:
```json
{
  "error": "è«‹æä¾›å¯†ç¢¼ä»¥ç¢ºèªåˆªé™¤"
}
// æˆ–
{
  "error": "å¯†ç¢¼éŒ¯èª¤"
}
```

**Response (Error - 404)**:
```json
{
  "error": "æ‰¾ä¸åˆ°ä½¿ç”¨è€…"
}
```

**Response (Error - 500)**:
```json
{
  "error": "åˆªé™¤å¸³è™Ÿå¤±æ•—: <è©³ç´°éŒ¯èª¤è¨Šæ¯>"
}
```

**åˆªé™¤æµç¨‹èˆ‡ç´šè¯é‚è¼¯**:
1. é©—è­‰ JWT Tokenï¼ˆç²å–ç•¶å‰ç”¨æˆ¶ IDï¼‰
2. æª¢æŸ¥å¯†ç¢¼æ¬„ä½
3. é©—è­‰å¯†ç¢¼æ­£ç¢ºæ€§
4. **ç´šè¯åˆªé™¤ç›¸é—œè³‡æ–™**ï¼š
   - åˆªé™¤ ActivityParticipant è¨˜éŒ„ï¼ˆåƒèˆ‡çš„æ´»å‹•ï¼‰
   - åˆªé™¤ Match è¨˜éŒ„ï¼ˆæ‰€æœ‰åª’åˆï¼ŒåŒ…æ‹¬ user_a å’Œ user_bï¼‰
   - åˆªé™¤ Activity è¨˜éŒ„ï¼ˆå‰µå»ºçš„æ´»å‹•ï¼‰
   - åˆªé™¤ User è¨˜éŒ„ï¼ˆæœ€å¾Œåˆªé™¤ï¼‰
5. æäº¤è³‡æ–™åº«è®Šæ›´

**å®‰å…¨æ€§è€ƒé‡**:
- éœ€è¦å¯†ç¢¼ç¢ºèªï¼ˆé˜²æ­¢èª¤æ“ä½œï¼‰
- ä½¿ç”¨ `synchronize_session=False` å„ªåŒ–åˆªé™¤æ•ˆèƒ½
- ä½¿ç”¨è³‡æ–™åº«äº‹å‹™ï¼ˆå¤±æ•—æ™‚è‡ªå‹•å›æ»¾ï¼‰

### Component Specifications

**AccountSettings.vue Component** [æ–°å»ºç«‹]

- **Location**: `frontend/src/views/AccountSettings.vue`
- **Type**: Page Component (Vue 3 SFC with Composition API)
- **Design Reference**: æ‡‰éµå¾ªæ—¢æœ‰çš„ UI è¨­è¨ˆé¢¨æ ¼

**å»ºè­°çµæ§‹**:
```vue
<template>
  <div class="account-settings-page">
    <div class="account-settings-container">
      <h1>å¸³è™Ÿè¨­å®š</h1>
      
      <!-- è®Šæ›´å¯†ç¢¼å€å¡Š -->
      <el-card class="settings-card">
        <template #header>
          <h2>è®Šæ›´å¯†ç¢¼</h2>
        </template>
        
        <el-form 
          ref="passwordFormRef" 
          :model="passwordForm" 
          :rules="passwordRules" 
          label-position="top"
        >
          <el-form-item label="èˆŠå¯†ç¢¼" prop="oldPassword">
            <el-input 
              v-model="passwordForm.oldPassword" 
              type="password" 
              placeholder="è«‹è¼¸å…¥èˆŠå¯†ç¢¼"
              show-password
              clearable
              :disabled="loading"
            />
          </el-form-item>
          
          <el-form-item label="æ–°å¯†ç¢¼" prop="newPassword">
            <el-input 
              v-model="passwordForm.newPassword" 
              type="password" 
              placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼"
              show-password
              clearable
              :disabled="loading"
            />
            <!-- å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨ -->
            <div class="password-strength">
              <div class="strength-bar" :class="passwordStrength"></div>
              <span class="strength-text">{{ passwordStrengthText }}</span>
            </div>
            <div class="password-requirements">
              <p>å¯†ç¢¼è¦æ±‚ï¼š</p>
              <ul>
                <li :class="{ valid: hasMinLength }">âœ“ è‡³å°‘ 6 å€‹å­—å…ƒ</li>
                <li :class="{ valid: hasLetter }">âœ“ åŒ…å«è‹±æ–‡å­—æ¯</li>
                <li :class="{ valid: hasNumber }">âœ“ åŒ…å«æ•¸å­—</li>
              </ul>
            </div>
          </el-form-item>
          
          <el-form-item label="ç¢ºèªæ–°å¯†ç¢¼" prop="confirmPassword">
            <el-input 
              v-model="passwordForm.confirmPassword" 
              type="password" 
              placeholder="è«‹å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼"
              show-password
              clearable
              :disabled="loading"
              @keyup.enter="handleChangePassword"
            />
          </el-form-item>
          
          <el-button 
            type="primary" 
            size="large" 
            @click="handleChangePassword" 
            :loading="loading"
            class="submit-button"
          >
            è®Šæ›´å¯†ç¢¼
          </el-button>
        </el-form>
      </el-card>
      
      <!-- å±éšªå€åŸŸï¼šåˆªé™¤å¸³è™Ÿ -->
      <el-card class="settings-card danger-zone">
        <template #header>
          <h2>å±éšªå€åŸŸ</h2>
        </template>
        
        <el-alert
          title="è­¦å‘Š"
          type="warning"
          description="åˆªé™¤å¸³è™Ÿå¾Œï¼Œæ‚¨çš„æ‰€æœ‰è³‡æ–™å°‡è¢«æ°¸ä¹…åˆªé™¤ï¼Œä¸”ç„¡æ³•æ¢å¾©ã€‚"
          :closable="false"
          show-icon
        />
        
        <div class="delete-account-section">
          <p>åˆªé™¤å¸³è™Ÿå°‡æœƒç§»é™¤ï¼š</p>
          <ul>
            <li>æ‚¨çš„å€‹äººè³‡æ–™</li>
            <li>æ‰€æœ‰æ´»å‹•è¨˜éŒ„ï¼ˆå‰µå»ºçš„èˆ‡åƒèˆ‡çš„ï¼‰</li>
            <li>æ‰€æœ‰åª’åˆè¨˜éŒ„</li>
            <li>æ‰€æœ‰èŠå¤©è¨Šæ¯</li>
          </ul>
          
          <el-button 
            type="danger" 
            size="large" 
            @click="handleDeleteAccountClick" 
            :loading="deleteLoading"
            class="delete-button"
          >
            åˆªé™¤å¸³è™Ÿ
          </el-button>
        </div>
      </el-card>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'
import { changePassword } from '@/api/auth'
import { deleteAccount } from '@/api/users'
import { ElMessage, ElMessageBox } from 'element-plus'

const router = useRouter()
const authStore = useAuthStore()
const passwordFormRef = ref(null)
const loading = ref(false)
const deleteLoading = ref(false)

// è®Šæ›´å¯†ç¢¼è¡¨å–®
const passwordForm = reactive({
  oldPassword: '',
  newPassword: '',
  confirmPassword: ''
})

// å¯†ç¢¼ç¢ºèªé©—è­‰å™¨
const validateConfirmPassword = (rule, value, callback) => {
  if (value !== passwordForm.newPassword) {
    callback(new Error('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´'))
  } else {
    callback()
  }
}

// è¡¨å–®é©—è­‰è¦å‰‡
const passwordRules = {
  oldPassword: [
    { required: true, message: 'è«‹è¼¸å…¥èˆŠå¯†ç¢¼', trigger: 'blur' }
  ],
  newPassword: [
    { required: true, message: 'è«‹è¼¸å…¥æ–°å¯†ç¢¼', trigger: 'blur' },
    { min: 6, message: 'å¯†ç¢¼é•·åº¦å¿…é ˆè‡³å°‘ 6 å€‹å­—å…ƒ', trigger: 'blur' },
    { 
      pattern: /^(?=.*[A-Za-z])(?=.*\d).+$/, 
      message: 'å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯å’Œä¸€å€‹æ•¸å­—', 
      trigger: 'blur' 
    }
  ],
  confirmPassword: [
    { required: true, message: 'è«‹ç¢ºèªæ–°å¯†ç¢¼', trigger: 'blur' },
    { validator: validateConfirmPassword, trigger: 'blur' }
  ]
}

// å¯†ç¢¼å¼·åº¦è¨ˆç®—
const hasMinLength = computed(() => passwordForm.newPassword.length >= 6)
const hasLetter = computed(() => /[A-Za-z]/.test(passwordForm.newPassword))
const hasNumber = computed(() => /\d/.test(passwordForm.newPassword))

const passwordStrength = computed(() => {
  const checks = [hasMinLength.value, hasLetter.value, hasNumber.value]
  const score = checks.filter(Boolean).length
  if (score === 3) return 'strong'
  if (score === 2) return 'medium'
  return 'weak'
})

const passwordStrengthText = computed(() => {
  const map = { weak: 'å¼±', medium: 'ä¸­', strong: 'å¼·' }
  return passwordForm.newPassword ? map[passwordStrength.value] : ''
})

// è®Šæ›´å¯†ç¢¼è™•ç†
const handleChangePassword = async () => {
  const valid = await passwordFormRef.value.validate()
  if (!valid) return

  try {
    loading.value = true
    
    await changePassword(
      passwordForm.oldPassword,
      passwordForm.newPassword
    )
    
    ElMessage.success('å¯†ç¢¼è®Šæ›´æˆåŠŸï¼Œè«‹é‡æ–°ç™»å…¥')
    
    // æ¸…é™¤è¡¨å–®
    passwordForm.oldPassword = ''
    passwordForm.newPassword = ''
    passwordForm.confirmPassword = ''
    passwordFormRef.value.resetFields()
    
    // ç™»å‡ºä¸¦è·³è½‰è‡³ç™»å…¥é 
    await authStore.logout()
    setTimeout(() => {
      router.push('/login')
    }, 1500)
    
  } catch (error) {
    // éŒ¯èª¤å·²ç”± Axios æ””æˆªå™¨è™•ç†
    console.error('è®Šæ›´å¯†ç¢¼å¤±æ•—:', error)
  } finally {
    loading.value = false
  }
}

// åˆªé™¤å¸³è™Ÿè™•ç†
const handleDeleteAccountClick = () => {
  ElMessageBox.prompt(
    'æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼è«‹è¼¸å…¥æ‚¨çš„å¯†ç¢¼ä»¥ç¢ºèªåˆªé™¤å¸³è™Ÿã€‚',
    'ç¢ºèªåˆªé™¤å¸³è™Ÿï¼Ÿ',
    {
      confirmButtonText: 'ç¢ºèªåˆªé™¤',
      cancelButtonText: 'å–æ¶ˆ',
      inputType: 'password',
      inputPlaceholder: 'è«‹è¼¸å…¥å¯†ç¢¼',
      inputValidator: (value) => {
        if (!value) {
          return 'è«‹è¼¸å…¥å¯†ç¢¼'
        }
        return true
      },
      type: 'error',
      dangerouslyUseHTMLString: false,
      beforeClose: async (action, instance, done) => {
        if (action === 'confirm') {
          instance.confirmButtonLoading = true
          
          try {
            await deleteAccount(instance.inputValue)
            
            ElMessage.success('æ‚¨çš„å¸³è™Ÿå·²æˆåŠŸåˆªé™¤')
            
            // æ¸…é™¤èªè­‰ç‹€æ…‹
            await authStore.logout()
            
            done()
            
            // è·³è½‰è‡³é¦–é 
            setTimeout(() => {
              router.push('/')
            }, 1500)
            
          } catch (error) {
            instance.confirmButtonLoading = false
            ElMessage.error(error.response?.data?.error || 'åˆªé™¤å¸³è™Ÿå¤±æ•—')
          }
        } else {
          done()
        }
      }
    }
  ).catch(() => {
    // ç”¨æˆ¶å–æ¶ˆæ“ä½œ
  })
}
</script>

<style lang="scss" scoped>
.account-settings-page {
  min-height: 100vh;
  background: var(--color-background);
  padding: var(--spacing-xl);
}

.account-settings-container {
  max-width: 800px;
  margin: 0 auto;
  
  h1 {
    font-size: var(--font-size-h1);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-xl);
  }
}

.settings-card {
  margin-bottom: var(--spacing-xl);
  
  :deep(.el-card__header) {
    h2 {
      font-size: var(--font-size-h2);
      font-weight: var(--font-weight-medium);
      color: var(--color-text-primary);
      margin: 0;
    }
  }
}

.password-strength {
  margin-top: var(--spacing-sm);
  
  .strength-bar {
    height: 4px;
    border-radius: 2px;
    transition: all 0.3s;
    
    &.weak {
      width: 33%;
      background: #f56c6c;
    }
    
    &.medium {
      width: 66%;
      background: #e6a23c;
    }
    
    &.strong {
      width: 100%;
      background: #67c23a;
    }
  }
  
  .strength-text {
    font-size: var(--font-size-small);
    margin-left: var(--spacing-xs);
  }
}

.password-requirements {
  margin-top: var(--spacing-md);
  padding: var(--spacing-sm);
  background: var(--color-background-soft);
  border-radius: var(--border-radius-md);
  
  p {
    margin: 0 0 var(--spacing-xs) 0;
    font-size: var(--font-size-small);
    font-weight: var(--font-weight-medium);
  }
  
  ul {
    margin: 0;
    padding-left: var(--spacing-lg);
    
    li {
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
      
      &.valid {
        color: var(--color-success);
      }
    }
  }
}

.submit-button {
  width: 100%;
  margin-top: var(--spacing-md);
}

.danger-zone {
  border: 2px solid var(--color-danger);
  
  :deep(.el-card__header) {
    background: var(--color-danger-light);
    
    h2 {
      color: var(--color-danger);
    }
  }
}

.delete-account-section {
  margin-top: var(--spacing-lg);
  
  p {
    font-weight: var(--font-weight-medium);
    margin-bottom: var(--spacing-sm);
  }
  
  ul {
    margin-bottom: var(--spacing-lg);
    padding-left: var(--spacing-xl);
    
    li {
      color: var(--color-text-secondary);
      margin-bottom: var(--spacing-xs);
    }
  }
}

.delete-button {
  width: 100%;
}

@media (max-width: 640px) {
  .account-settings-page {
    padding: var(--spacing-md);
  }
}
</style>
```

### File Locations

Based on [Source: architecture/3-å°ˆæ¡ˆçµæ§‹-project-structure.md]:

**Frontend**:
- å¸³è™Ÿè¨­å®šé é¢: `frontend/src/views/AccountSettings.vue` (æ–°å»º)
- Auth API æœå‹™: `frontend/src/api/auth.js` (æ“´å±• - æ·»åŠ  changePassword)
- Users API æœå‹™: `frontend/src/api/users.js` (æ“´å±• - æ·»åŠ  deleteAccount)
- è·¯ç”±é…ç½®: `frontend/src/router/index.js` (æ“´å±•)
- å‰ç«¯æ¸¬è©¦: `frontend/tests/unit/views/AccountSettings.spec.js` (æ–°å»º)

**Backend**:
- è®Šæ›´å¯†ç¢¼ç«¯é»: `backend/blueprints/auth.py` (å·²å­˜åœ¨ change_password)
- åˆªé™¤å¸³è™Ÿç«¯é»: `backend/blueprints/users.py` (å·²å­˜åœ¨ delete_account)
- User Model: `backend/models/user.py`
- å¾Œç«¯æ¸¬è©¦: `backend/tests/test_auth.py` (æ“´å±•)
- å¾Œç«¯æ¸¬è©¦: `backend/tests/test_users.py` (å»ºç«‹æˆ–æ“´å±•)

### Testing Requirements

Based on [Source: architecture/11-æ¸¬è©¦ç­–ç•¥-testing-requirements.md]:

**Unit Testing (Vitest)**:
- **Location**: `frontend/tests/unit/views/AccountSettings.spec.js`
- **Framework**: Vitest + @vue/test-utils + Element Plus
- **Coverage Target**: 80%+
- **Test Cases**:
  1. é é¢æ­£ç¢ºæ¸²æŸ“
  2. è®Šæ›´å¯†ç¢¼è¡¨å–®æ¸²æŸ“
  3. å¯†ç¢¼å¼·åº¦é©—è­‰è¦å‰‡ç”Ÿæ•ˆ
  4. å¯†ç¢¼ç¢ºèªé‚è¼¯
  5. è®Šæ›´å¯†ç¢¼åŠŸèƒ½èª¿ç”¨æ­£ç¢ºçš„ API
  6. è®Šæ›´å¯†ç¢¼æˆåŠŸå¾Œç™»å‡ºä¸¦è·³è½‰
  7. èˆŠå¯†ç¢¼éŒ¯èª¤é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
  8. åˆªé™¤å¸³è™ŸæŒ‰éˆ•å­˜åœ¨
  9. åˆªé™¤å¸³è™Ÿç¢ºèªå°è©±æ¡†
  10. åˆªé™¤å¸³è™ŸåŠŸèƒ½èª¿ç”¨æ­£ç¢ºçš„ API
  11. åˆªé™¤æˆåŠŸå¾Œæ¸…é™¤ç‹€æ…‹ä¸¦è·³è½‰
  12. å¯†ç¢¼éŒ¯èª¤æ™‚é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯

**Backend Testing (pytest)**:
- **Location**: `backend/tests/test_auth.py` + `backend/tests/test_users.py`
- **Framework**: pytest + pytest-flask
- **Test Cases**:
  - **è®Šæ›´å¯†ç¢¼æ¸¬è©¦**:
    1. æœ‰æ•ˆçš„å¯†ç¢¼è®Šæ›´æˆåŠŸ
    2. èˆŠå¯†ç¢¼éŒ¯èª¤è¿”å› 400
    3. æ–°å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚è¿”å› 400
    4. æœªèªè­‰è«‹æ±‚è¿”å› 401
  - **åˆªé™¤å¸³è™Ÿæ¸¬è©¦**:
    1. æœ‰æ•ˆçš„å¸³è™Ÿåˆªé™¤æˆåŠŸ
    2. å¯†ç¢¼éŒ¯èª¤è¿”å› 400
    3. ç´šè¯åˆªé™¤é©—è­‰ï¼ˆActivityParticipant, Match, Activityï¼‰
    4. æœªèªè­‰è«‹æ±‚è¿”å› 401

**Running Tests**:
```bash
# Frontend
npm run test:unit

# Backend
pytest backend/tests/test_auth.py backend/tests/test_users.py -v
```

### Technical Constraints

[Source: architecture/2-å‰ç«¯æŠ€è¡“æ£§-frontend-tech-stack.md + PRD NFR]

1. **Framework Versions**:
   - Vue.js 3.3.8+
   - Element Plus 2.4.2+
   - Pinia 2.1.7+
   - Flask (backend)

2. **Security Requirements** [NFR2]:
   - å¯†ç¢¼ä½¿ç”¨ scrypt åŠ å¯†ï¼ˆWerkzeug çš„ generate_password_hashï¼‰
   - è®Šæ›´å¯†ç¢¼å¾Œéœ€é‡æ–°èªè­‰ï¼ˆJWT Token å¤±æ•ˆï¼‰
   - åˆªé™¤å¸³è™Ÿéœ€å¯†ç¢¼ç¢ºèªï¼ˆé˜²æ­¢èª¤æ“ä½œï¼‰
   - æ‰€æœ‰æ•æ„Ÿæ“ä½œéœ€ JWT èªè­‰

3. **Password Requirements**:
   - é•·åº¦è‡³å°‘ 6 å€‹å­—å…ƒ
   - å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è‹±æ–‡å­—æ¯
   - å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—

4. **Performance Requirements** [NFR1]:
   - API å›æ‡‰æ™‚é–“ < 1000ms
   - å‰ç«¯è¡¨å–®é©—è­‰å³æ™‚å›æ‡‰

5. **Browser Support** [NFR3]:
   - Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

6. **Data Integrity**:
   - åˆªé™¤å¸³è™Ÿæ™‚éœ€ç´šè¯åˆªé™¤æ‰€æœ‰é—œè¯è³‡æ–™
   - ä½¿ç”¨è³‡æ–™åº«äº‹å‹™ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§

### Project Structure Notes

[Source: architecture/3-å°ˆæ¡ˆçµæ§‹-project-structure.md]

**æ–°å¢ç›®éŒ„/æª”æ¡ˆ**:
- âœ… `frontend/src/views/AccountSettings.vue` - å¸³è™Ÿè¨­å®šé é¢
- âœ… `frontend/tests/unit/views/AccountSettings.spec.js` - å–®å…ƒæ¸¬è©¦

**ä¿®æ”¹æª”æ¡ˆ**:
- âœ… `frontend/src/api/auth.js` - æ·»åŠ  changePassword å‡½æ•¸
- âœ… `frontend/src/api/users.js` - æ·»åŠ  deleteAccount å‡½æ•¸
- âœ… `frontend/src/router/index.js` - æ·»åŠ å¸³è™Ÿè¨­å®šè·¯ç”±
- âœ… `backend/tests/test_auth.py` - æ·»åŠ è®Šæ›´å¯†ç¢¼æ¸¬è©¦
- âœ… `backend/tests/test_users.py` - æ·»åŠ æˆ–æ“´å±•åˆªé™¤å¸³è™Ÿæ¸¬è©¦

**ç„¡çµæ§‹è¡çª**ï¼šæ‰€æœ‰æ–°å¢æª”æ¡ˆç¬¦åˆç¾æœ‰å°ˆæ¡ˆçµæ§‹ã€‚

### Additional Notes

**å¯†ç¢¼è®Šæ›´å¾Œçš„èªè­‰è™•ç†**:
- è®Šæ›´å¯†ç¢¼æˆåŠŸå¾Œï¼Œå‰ç«¯æ‡‰æ¸…é™¤æœ¬åœ° JWT Token
- ä½¿ç”¨ Auth Store çš„ logout æ–¹æ³•
- è·³è½‰è‡³ç™»å…¥é è¦æ±‚ç”¨æˆ¶é‡æ–°ç™»å…¥
- é€™ç¢ºä¿äº†å®‰å…¨æ€§ï¼ˆé¿å…èˆŠ Token ä»å¯ä½¿ç”¨ï¼‰

**åˆªé™¤å¸³è™Ÿçš„ç´šè¯é‚è¼¯** [Source: backend/blueprints/users.py]:
```python
# 1. åˆªé™¤åƒèˆ‡çš„æ´»å‹•è¨˜éŒ„
ActivityParticipant.query.filter_by(user_id=current_user_id).delete()

# 2. åˆªé™¤åª’åˆè¨˜éŒ„ï¼ˆé›™å‘ï¼‰
Match.query.filter(
    or_(Match.user_a == current_user_id, Match.user_b == current_user_id)
).delete(synchronize_session=False)

# 3. åˆªé™¤å‰µå»ºçš„æ´»å‹•
Activity.query.filter_by(creator_id=current_user_id).delete()

# 4. æœ€å¾Œåˆªé™¤ç”¨æˆ¶
db.session.delete(user)
db.session.commit()
```

**UI/UX æœ€ä½³å¯¦è¸**:
1. **è®Šæ›´å¯†ç¢¼**:
   - ä½¿ç”¨å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨æä¾›å³æ™‚åé¥‹
   - æˆåŠŸå¾Œè‡ªå‹•ç™»å‡ºï¼ˆå¼·åˆ¶é‡æ–°èªè­‰ï¼‰
   - æ¸…é™¤è¡¨å–®é¿å…æ®˜ç•™æ•æ„Ÿè³‡æ–™

2. **åˆªé™¤å¸³è™Ÿ**:
   - ä½¿ç”¨ã€Œå±éšªå€åŸŸã€è¦–è¦ºè­¦ç¤º
   - å¤šé‡ç¢ºèªæ©Ÿåˆ¶ï¼ˆç¢ºèªå°è©±æ¡† + å¯†ç¢¼é©—è­‰ï¼‰
   - æ˜ç¢ºåˆ—å‡ºå°‡è¢«åˆªé™¤çš„è³‡æ–™
   - ä½¿ç”¨ç´…è‰²ä¸»é¡Œå¼·èª¿å±éšªæ€§

**æœªä¾†å¯èƒ½éœ€è¦çš„å¢å¼·**:
1. **å¯†ç¢¼è®Šæ›´**:
   - ç™¼é€ Email é€šçŸ¥ç”¨æˆ¶å¯†ç¢¼å·²è®Šæ›´
   - å¯†ç¢¼è®Šæ›´æ­·å²è¨˜éŒ„
   - é˜²æ­¢é‡è¤‡ä½¿ç”¨æœ€è¿‘çš„å¯†ç¢¼

2. **åˆªé™¤å¸³è™Ÿ**:
   - è»Ÿåˆªé™¤ï¼ˆæ¨™è¨˜ç‚ºå·²åˆªé™¤ï¼Œè€Œéå¯¦éš›åˆªé™¤ï¼‰
   - ä¿ç•™æœŸï¼ˆä¾‹å¦‚ 30 å¤©å…§å¯æ¢å¾©ï¼‰
   - ç™¼é€ Email ç¢ºèªåˆªé™¤
   - åŒ¯å‡ºç”¨æˆ¶è³‡æ–™é¸é …ï¼ˆGDPR åˆè¦ï¼‰

**å®‰å…¨æ€§è€ƒé‡**:
- Rate Limiting: è€ƒæ…®å°è®Šæ›´å¯†ç¢¼å’Œåˆªé™¤å¸³è™Ÿæ·»åŠ é »ç‡é™åˆ¶
- å¯©è¨ˆæ—¥èªŒ: è¨˜éŒ„æ‰€æœ‰æ•æ„Ÿæ“ä½œï¼ˆå¯†ç¢¼è®Šæ›´ã€å¸³è™Ÿåˆªé™¤ï¼‰
- äºŒæ¬¡é©—è­‰: æœªä¾†å¯æ•´åˆ 2FA ä½œç‚ºé¡å¤–å®‰å…¨å±¤

**åƒè€ƒè³‡æº**:
- Werkzeug Password Hashing: https://werkzeug.palletsprojects.com/en/2.3.x/utils/#module-werkzeug.security
- OWASP å¯†ç¢¼å»ºè­°: https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html
- Element Plus MessageBox: https://element-plus.org/en-US/component/message-box.html

## Testing

### Frontend Testing
```bash
# åŸ·è¡Œå–®å…ƒæ¸¬è©¦
npm run test:unit

# åŸ·è¡Œå¸¶è¦†è“‹ç‡çš„æ¸¬è©¦
npm run test:coverage

# UI æ¸¬è©¦æ¨¡å¼
npm run test:ui
```

### Backend Testing
```bash
# åŸ·è¡Œè®Šæ›´å¯†ç¢¼æ¸¬è©¦
pytest backend/tests/test_auth.py::test_change_password -v

# åŸ·è¡Œåˆªé™¤å¸³è™Ÿæ¸¬è©¦
pytest backend/tests/test_users.py::test_delete_account -v

# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pytest backend/tests/test_auth.py backend/tests/test_users.py -v

# å¸¶è¦†è“‹ç‡å ±å‘Š
pytest backend/tests/ --cov=backend/blueprints --cov-report=html
```

### Manual Testing Checklist

- [ ] å®Œæ•´è®Šæ›´å¯†ç¢¼æµç¨‹ï¼ˆæˆåŠŸæƒ…å¢ƒï¼‰
- [ ] èˆŠå¯†ç¢¼éŒ¯èª¤è™•ç†
- [ ] æ–°å¯†ç¢¼æ ¼å¼é©—è­‰
- [ ] å¯†ç¢¼ç¢ºèªé‚è¼¯
- [ ] å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨
- [ ] è®Šæ›´å¾Œè‡ªå‹•ç™»å‡ºä¸¦è·³è½‰
- [ ] å®Œæ•´åˆªé™¤å¸³è™Ÿæµç¨‹ï¼ˆæˆåŠŸæƒ…å¢ƒï¼‰
- [ ] åˆªé™¤ç¢ºèªå°è©±æ¡†
- [ ] å¯†ç¢¼é©—è­‰ï¼ˆåˆªé™¤æ™‚ï¼‰
- [ ] åˆªé™¤å¾Œè³‡æ–™æ¸…é™¤é©—è­‰
- [ ] åˆªé™¤å¾Œç„¡æ³•ç™»å…¥
- [ ] å°èˆªé€£çµæ¸¬è©¦
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆæ¸¬è©¦
- [ ] æœªç™»å…¥å­˜å–ä¿è­·

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-05 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

*æ­¤å€å¡Šç”±é–‹ç™¼ä»£ç†åœ¨å¯¦ä½œæ™‚å¡«å¯«*

### Agent Model Used

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### Debug Log References

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### Completion Notes List

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

### File List

(å¾…é–‹ç™¼ä»£ç†å¡«å¯«)

## QA Results

*æ­¤å€å¡Šç”± QA ä»£ç†å¯©æŸ¥å¾Œæ›´æ–°å¯©æŸ¥çµæœ*
