# EdgeSurvivor 軟體需求分析文件 (SRS)

**Software Requirements Specification**

**版本：** 1.0  
**日期：** 2025-11-03  
**狀態：** Approved  
**作者：** Business Analyst Team

---

## 文件修訂歷史

| 版本 | 日期 | 修訂內容 | 作者 |
|------|------|----------|------|
| 1.0 | 2025-11-03 | 初始版本，基於 MVP 完成狀態與 PRD v1.0 | BA Team |

---

## 目錄

1. [簡介](#1-簡介)
2. [系統概述](#2-系統概述)
3. [功能性需求](#3-功能性需求)
4. [非功能性需求](#4-非功能性需求)
5. [使用案例 (Use Cases)](#5-使用案例-use-cases)
6. [資料需求](#6-資料需求)
7. [外部介面需求](#7-外部介面需求)
8. [系統特性](#8-系統特性)
9. [約束條件](#9-約束條件)
10. [附錄](#10-附錄)

---

## 1. 簡介

### 1.1 目的

本文件定義 **EdgeSurvivor（邊緣人神器）** 旅伴媒合與活動管理平台的軟體需求規格。本文件旨在：

- 明確定義系統的功能性與非功能性需求
- 提供開發團隊實作的依據
- 作為測試與驗收的標準
- 確保利害關係人對系統需求的共識

**目標讀者：**
- 專案經理
- 系統架構師
- 開發工程師
- 測試工程師
- 產品擁有者

### 1.2 專案範圍

**EdgeSurvivor** 是一個專注於「旅伴與活動媒合」的社交平台，解決獨自旅行者尋找志同道合旅伴的痛點。

**系統邊界：**
- **包含：** 使用者註冊/登入、個人資料管理、活動管理、媒合系統、即時聊天、費用分攤、評價系統
- **不包含：** 支付處理、地圖導航、旅行社服務、旅遊保險

**核心功能流程：**
```
使用者註冊 → 建立活動 → 搜尋活動 → 申請參與 → 媒合成功 → 
即時聊天 → 活動執行 → 費用分攤 → 互相評價
```

### 1.3 參考文件

- [專案簡報 (Project Brief)](./project-brief.md)
- [產品需求文件 (PRD)](./prd.md)
- [軟體架構文件 (Architecture)](./architecture.md)
- [任務說明文件 (task.md)](../task.md)

### 1.4 術語與縮寫

| 術語 | 定義 |
|------|------|
| **使用者 (User)** | 在平台註冊的會員 |
| **活動 (Activity)** | 使用者創建的旅行活動 |
| **媒合 (Match)** | 使用者間的配對申請 |
| **創建者 (Creator)** | 發起活動的使用者 |
| **參與者 (Participant)** | 加入活動的使用者 |
| **種子用戶 (Seed User)** | Beta 測試階段的早期用戶 |
| **JWT** | JSON Web Token，用於 API 認證 |
| **OAuth2** | 開放授權協定，用於第三方登入 |
| **2FA** | Two-Factor Authentication（雙因素認證） |
| **Socket.IO** | 即時通訊協定 |

---

## 2. 系統概述

### 2.1 系統背景

**問題陳述：**  
許多人想旅行卻找不到合適的同行者，導致計畫擱置或被迫獨自前往。現有解決方案（Facebook 社團、PTT）缺乏結構化媒合機制、行程協調工具、費用分攤功能及安全保護。

**解決方案：**  
EdgeSurvivor 提供一個安全、專業的旅伴媒合平台，整合「發現 → 媒合 → 聯繫 → 執行 → 記錄」完整旅程。

### 2.2 系統目標

**業務目標：**
- 6 個月內達到 10,000 註冊用戶
- 每月新增 500+ 活動
- 媒合成功率達 60%
- 30 天留存率達 40%
- 活動評價平均 4.2 星以上

**使用者目標：**
- 平均 3 天內找到旅伴
- 85% 的活動順利執行
- 費用分攤清楚透明
- 安全可靠的社交環境

### 2.3 系統架構概述

**架構模式：** MVC (Model-View-Controller)  
**部署模式：** Monolith Backend + SPA Frontend

```
┌─────────────────────────────────────────┐
│           使用者 (Browser)                │
└────────────────┬────────────────────────┘
                 │ HTTPS
┌────────────────▼────────────────────────┐
│      Frontend (Vue 3 SPA)               │
│  - Element Plus UI                      │
│  - Pinia State Management               │
│  - Vue Router                           │
│  - Socket.IO Client                     │
└────────────────┬────────────────────────┘
                 │ REST API + WebSocket
┌────────────────▼────────────────────────┐
│      Backend (Flask)                    │
│  - RESTful API (Blueprint)              │
│  - JWT Authentication                   │
│  - Flask-SocketIO                       │
│  - SQLAlchemy ORM                       │
└────────────────┬────────────────────────┘
                 │ SQL
┌────────────────▼────────────────────────┐
│      Database (MariaDB)                 │
│  - 9 個主要資料表                        │
└─────────────────────────────────────────┘
```

### 2.4 使用者角色

| 角色 | 描述 | 權限 |
|------|------|------|
| **訪客 (Guest)** | 未註冊使用者 | 瀏覽首頁、註冊、登入 |
| **註冊使用者 (User)** | 已註冊會員 | 建立活動、申請參與、媒合、聊天、費用管理 |
| **活動創建者 (Creator)** | 發起活動的使用者 | 審核參與申請、管理參與者、編輯活動 |
| **系統管理員 (Admin)** | 平台管理者（Phase 2） | 使用者管理、內容審核、平台設定 |

---

## 3. 功能性需求

### 3.1 使用者認證與管理 (FR1)

#### FR1.1 使用者註冊

**需求描述：**  
系統應提供 Email/密碼註冊功能，並發送驗證信以確認 Email 有效性。

**輸入：**
- Email（必填，格式驗證）
- 密碼（必填，最少 8 字元）
- 姓名（必填）

**處理：**
1. 驗證 Email 格式與唯一性
2. 驗證密碼強度（至少 8 字元）
3. 使用 scrypt 加密密碼
4. 建立使用者記錄
5. 發送 Email 驗證信

**輸出：**
- 註冊成功訊息
- 自動導向登入頁面

**例外處理：**
- Email 已被註冊 → 顯示錯誤訊息
- 密碼過短 → 提示密碼要求
- Email 格式錯誤 → 提示正確格式

**驗收標準：**
- [x] 使用者可成功註冊並收到驗證信
- [x] 密碼經過加密儲存
- [x] Email 重複時顯示錯誤訊息

---

#### FR1.2 使用者登入

**需求描述：**  
系統應提供 Email/密碼登入功能，並返回 JWT Token 供後續 API 使用。

**輸入：**
- Email
- 密碼

**處理：**
1. 驗證 Email 是否存在
2. 驗證密碼是否正確
3. 檢查 Email 是否已驗證
4. 檢查 2FA 是否啟用
5. 產生 JWT Access Token 與 Refresh Token
6. 更新最後上線時間

**輸出：**
- Access Token（有效期 15 分鐘）
- Refresh Token（有效期 30 天）
- 使用者基本資料

**例外處理：**
- Email 不存在 → "帳號或密碼錯誤"
- 密碼錯誤 → "帳號或密碼錯誤"
- Email 未驗證 → "請先驗證 Email"
- 帳號被停用 → "帳號已被停用"

**驗收標準：**
- [x] 正確帳密可成功登入
- [x] 錯誤密碼顯示錯誤訊息
- [x] 返回有效的 JWT Token

---

#### FR1.3 Google OAuth2 登入

**需求描述：**  
系統應支援使用 Google 帳號快速登入或註冊。

**輸入：**
- Google OAuth2 Authorization Code

**處理：**
1. 向 Google 驗證授權碼
2. 取得使用者 Google 資料（Email、姓名、頭像）
3. 檢查 Email 是否已註冊
   - 若已註冊：直接登入
   - 若未註冊：自動建立帳號
4. 產生 JWT Token

**輸出：**
- JWT Access Token
- JWT Refresh Token
- 使用者資料

**驗收標準：**
- [x] 可使用 Google 帳號登入
- [x] 首次登入自動建立帳號
- [x] Google 頭像同步至平台

---

#### FR1.4 兩步驟驗證 (2FA)

**需求描述：**  
使用者可選擇啟用兩步驟驗證，提升帳號安全性。

**功能：**
- 啟用 2FA（產生 QR Code）
- 驗證 2FA Code（登入時）
- 停用 2FA

**驗收標準：**
- [x] 使用者可啟用 2FA
- [x] 登入時需輸入 6 位數驗證碼
- [x] 可隨時停用 2FA

---

#### FR1.5 密碼管理

**需求描述：**  
使用者應能在忘記密碼時透過 Email 重設，並能隨時變更密碼。

**功能：**
1. **忘記密碼**
   - 輸入 Email → 發送重設信 → 點擊連結 → 設定新密碼
2. **變更密碼（登入後）**
   - 輸入舊密碼 → 輸入新密碼 → 確認

**驗收標準：**
- [x] 忘記密碼流程正常運作
- [x] 可在登入後變更密碼
- [x] 舊密碼錯誤時無法變更

---

#### FR1.6 刪除帳號

**需求描述：**  
使用者應能隨時刪除自己的帳號及相關資料。

**處理：**
1. 確認刪除意願（二次確認）
2. 刪除使用者資料
3. 刪除相關活動、媒合、訊息
4. 登出並清除 Token

**驗收標準：**
- [x] 使用者可刪除帳號
- [x] 刪除後無法再登入
- [x] 相關資料一併刪除

---

### 3.2 個人資料管理 (FR2)

#### FR2.1 編輯個人資料

**需求描述：**  
使用者應能編輯基本資料，包含姓名、Bio、性別、年齡、地區、興趣等。

**可編輯欄位：**
- 姓名（必填）
- Bio（個人簡介）
- 性別（男/女/不透露）
- 年齡
- 地區
- 興趣標籤（多選）

**驗收標準：**
- [x] 使用者可成功更新資料
- [x] 必填欄位驗證
- [x] 即時顯示更新結果

---

#### FR2.2 頭像上傳

**需求描述：**  
使用者應能上傳個人頭像圖片。

**限制：**
- 檔案格式：JPG, PNG, GIF
- 檔案大小：< 5MB
- 建議尺寸：300x300 像素

**處理：**
1. 驗證檔案類型與大小
2. 儲存至 `/uploads` 目錄
3. 更新 `profile_picture` 欄位

**驗收標準：**
- [x] 可成功上傳頭像
- [x] 檔案大小超過限制時顯示錯誤
- [x] 頭像即時更新

---

#### FR2.3 社群帳號連結

**需求描述：**  
使用者可設定社群帳號連結（Instagram、Facebook、Line、Twitter）並控制隱私設定。

**隱私選項：**
- **公開 (Public)**：所有人可見
- **僅好友 (Friends Only)**：已媒合成功的使用者可見
- **不公開 (Hidden)**：不顯示

**驗收標準：**
- [x] 可設定社群連結
- [x] 隱私設定生效
- [x] 非好友無法看到「僅好友」的社群連結

---

#### FR2.4 個人統計儀表板

**需求描述：**  
使用者可查看個人活動統計資訊。

**顯示資訊：**
- 建立的活動數量
- 參與的活動數量
- 媒合成功數量
- 評價數量
- 平均評價分數（未來）

**驗收標準：**
- [x] Dashboard 正確顯示統計數字
- [x] 數字即時更新

---

### 3.3 活動管理 (FR3)

#### FR3.1 建立活動

**需求描述：**  
使用者應能填寫活動資訊並發布活動。

**必填欄位：**
- 活動標題
- 活動日期（開始日期、結束日期）
- 活動地點
- 活動類別（冒險、文化、休閒、美食、運動）
- 活動描述
- 人數上限

**選填欄位：**
- 集合地點
- 預計費用
- 活動時長（小時）
- 難度等級（簡單、中等、困難）
- 性別偏好（不限、男性、女性）
- 年齡限制（最小年齡、最大年齡）
- 特別注意事項
- 封面圖片

**處理：**
1. 驗證必填欄位
2. 驗證日期邏輯（結束日期 >= 開始日期）
3. 建立活動記錄
4. 自動將創建者加入為參與者（role: creator, status: joined）

**輸出：**
- 活動 ID
- 導向活動詳情頁面

**驗收標準：**
- [x] 可成功建立活動
- [x] 必填欄位驗證
- [x] 封面圖片上傳功能正常
- [x] 創建者自動成為參與者

---

#### FR3.2 搜尋與篩選活動

**需求描述：**  
使用者應能透過關鍵字搜尋及條件篩選找到感興趣的活動。

**搜尋功能：**
- 關鍵字搜尋（標題、地點、描述）

**篩選條件：**
- 活動地點（下拉選單）
- 活動日期（日期範圍）
- 活動類別（多選）
- 性別偏好
- 活動狀態（進行中、已完成）

**排序選項：**
- 最新建立
- 活動日期（由近到遠）
- 人氣（參與人數）

**驗收標準：**
- [x] 搜尋功能正常運作
- [x] 篩選條件可組合使用
- [x] 搜尋結果 < 2 秒顯示

---

#### FR3.3 查看活動詳情

**需求描述：**  
使用者點擊活動後，應能查看完整的活動資訊。

**顯示內容：**
- 活動基本資訊（標題、日期、地點、描述、類別）
- 創建者資訊（姓名、頭像、評價數）
- 參與者列表（頭像、姓名）
- 當前人數 / 人數上限
- 活動狀態（開放報名、進行中、已完成、已取消）
- 活動討論串
- 費用明細（若有）
- 活動相簿（若有）

**操作按鈕：**
- 申請加入（非創建者且未參與）
- 編輯活動（僅創建者）
- 取消活動（僅創建者）
- 離開活動（已參與者）

**驗收標準：**
- [x] 活動詳情正確顯示
- [x] 按鈕權限控制正確
- [x] 參與者資訊即時更新

---

#### FR3.4 管理活動狀態

**需求描述：**  
活動創建者應能管理活動狀態。

**活動狀態：**
- **active（活動中）** - 開放報名
- **ongoing（進行中）** - 活動進行中
- **completed（已完成）** - 活動結束
- **cancelled（已取消）** - 活動取消

**狀態轉換規則：**
```
active → ongoing → completed
active → cancelled
```

**驗收標準：**
- [x] 創建者可變更活動狀態
- [x] 狀態變更即時顯示
- [x] 已完成的活動可進行評價

---

### 3.4 參與者管理 (FR4)

#### FR4.1 申請加入活動

**需求描述：**  
使用者應能申請加入感興趣的活動，並附帶自我介紹訊息。

**輸入：**
- 活動 ID
- 申請訊息（選填）

**處理：**
1. 檢查是否已申請過
2. 檢查活動是否已滿
3. 檢查性別/年齡限制
4. 建立參與者記錄（status: pending）
5. 通知創建者（未來功能）

**驗收標準：**
- [x] 可成功申請加入
- [x] 重複申請顯示錯誤
- [x] 性別/年齡不符時無法申請
- [x] 活動已滿時無法申請

---

#### FR4.2 審核參與申請

**需求描述：**  
活動創建者應能審核參與申請（批准或拒絕）。

**操作：**
- **批准 (Approve)**：status 變更為 `approved`
- **拒絕 (Reject)**：status 變更為 `rejected`，可填寫拒絕原因

**處理：**
1. 驗證操作權限（僅創建者）
2. 更新參與者狀態
3. 若批准，檢查是否達到人數上限
4. 通知申請者（未來功能）

**驗收標準：**
- [x] 創建者可批准/拒絕申請
- [x] 非創建者無法操作
- [x] 狀態即時更新

---

#### FR4.3 查看參與者列表

**需求描述：**  
所有參與者應能查看活動的參與者列表。

**顯示資訊：**
- 參與者頭像
- 參與者姓名
- 參與狀態（已批准、待審核）
- 加入時間

**驗收標準：**
- [x] 參與者列表正確顯示
- [x] 僅顯示已批准的參與者（創建者可看待審核）

---

#### FR4.4 移除參與者

**需求描述：**  
活動創建者應能移除已加入的參與者。

**處理：**
1. 驗證操作權限（僅創建者）
2. 更新參與者狀態為 `removed`
3. 通知被移除者（未來功能）

**驗收標準：**
- [x] 創建者可移除參與者
- [x] 被移除者無法再查看活動詳情

---

### 3.5 互動與媒合 (FR5)

#### FR5.1 活動討論串

**需求描述：**  
活動參與者應能在活動頁面的討論串中即時交流。

**功能：**
- 發送文字訊息
- 查看討論訊息（時間排序）
- 刪除自己的訊息

**權限：**
- 僅參與者（已批准）可發送訊息
- 所有人可查看訊息
- 僅訊息發送者可刪除

**驗收標準：**
- [x] 參與者可發送訊息
- [x] 訊息即時顯示（需手動重新整理，Socket.IO 未完全整合）
- [x] 可刪除自己的訊息

---

#### FR5.2 建立媒合申請

**需求描述：**  
使用者應能對其他使用者發出媒合申請（交友邀請）。

**輸入：**
- 對方 User ID
- 申請訊息（選填）
- 活動 ID（選填，若是從活動認識）

**處理：**
1. 檢查是否已有媒合記錄
2. 建立媒合記錄（status: pending）
3. 通知對方（未來功能）

**驗收標準：**
- [x] 可成功發送媒合申請
- [x] 重複申請顯示錯誤
- [x] 可附帶訊息

---

#### FR5.3 管理媒合狀態

**需求描述：**  
使用者應能管理收到的媒合申請。

**操作：**
- **接受 (Accept)**：status 變更為 `confirmed`
- **拒絕 (Reject)**：status 變更為 `rejected`
- **取消 (Cancel)**：撤銷申請

**媒合狀態：**
- `pending` - 待確認
- `confirmed` - 已確認（開啟聊天室）
- `rejected` - 已拒絕
- `cancelled` - 已取消

**驗收標準：**
- [x] 可接受/拒絕媒合申請
- [x] 媒合成功後開啟聊天室
- [x] 可查看媒合列表

---

#### FR5.4 私人聊天室

**需求描述：**  
媒合成功的雙方應能開啟私人聊天室，進行即時通訊。

**功能：**
- 發送文字訊息
- 查看訊息歷史
- 未讀訊息計數
- 訊息狀態（已發送、已送達、已讀）

**技術：**
- 使用 Socket.IO 實現即時通訊
- WebSocket 連線

**驗收標準：**
- [x] 媒合成功後可開啟聊天室
- [x] 訊息即時送達（< 1 秒）
- [x] 訊息歷史正確顯示
- [x] 未讀訊息計數（基本功能已實現）

---

### 3.6 活動後續功能 (FR6)

#### FR6.1 費用記錄

**需求描述：**  
活動參與者應能新增費用記錄，記錄活動中的開銷。

**輸入：**
- 費用金額（必填）
- 費用類別（交通、住宿、餐飲、門票、其他）
- 付款者（從參與者中選擇）
- 費用描述（選填）
- 費用日期

**處理：**
1. 驗證操作權限（僅參與者）
2. 建立費用記錄
3. 儲存參與者 ID（自動包含所有已批准參與者）

**驗收標準：**
- [x] 參與者可新增費用
- [x] 費用類別可選擇
- [x] 付款者可指定

---

#### FR6.2 費用分攤計算

**需求描述：**  
系統應自動計算最佳費用分攤方案，減少轉帳次數。

**演算法：**
1. 計算每人應分攤金額 = 總費用 / 參與人數
2. 計算每人淨餘額（已付 - 應付）
3. 使用貪婪演算法找出最少轉帳次數的結算方案

**輸出格式：**
```
A 付給 B：300 元
C 付給 B：150 元
```

**驗收標準：**
- [x] 系統可自動計算分攤方案
- [x] 結算金額正確
- [x] 轉帳次數最小化

---

#### FR6.3 費用結算報告

**需求描述：**  
系統應清楚顯示費用結算結果，讓參與者知道誰應付誰多少錢。

**顯示內容：**
- 總費用
- 每人應分攤金額
- 詳細費用明細
- 結算方案（誰付給誰多少錢）

**驗收標準：**
- [x] 結算報告清楚易懂
- [x] 可匯出（未來功能）

---

#### FR6.4 活動互評

**需求描述：**  
活動完成後，參與者應能互相留下評價與評語。

**輸入：**
- 評價對象（從參與者中選擇，不含自己）
- 評語（文字）

**處理：**
1. 檢查活動是否已完成（status: completed）
2. 檢查是否已評價過同一對象
3. 建立評價記錄
4. 更新被評價者的評價數量

**驗收標準：**
- [x] 活動完成後可進行評價
- [x] 不能重複評價同一對象
- [x] 評價計數正確更新

---

### 3.7 檔案上傳服務 (FR7)

#### FR7.1 圖片上傳

**需求描述：**  
系統應提供圖片上傳功能，支援頭像、活動封面、活動相簿。

**支援類型：**
- 頭像（profile_picture）
- 活動封面（cover_image）
- 活動相簿（album）

**限制：**
- 檔案格式：JPG, PNG, GIF
- 單檔大小：< 16MB
- 相簿圖片數量：< 20 張

**處理：**
1. 驗證檔案類型
2. 驗證檔案大小
3. 產生唯一檔名（UUID + 副檔名）
4. 儲存至 `/uploads` 目錄
5. 返回檔案 URL

**驗收標準：**
- [x] 可成功上傳圖片
- [x] 檔案大小驗證
- [x] 檔案類型驗證
- [x] 返回可存取的 URL

---

## 4. 非功能性需求

### 4.1 效能需求 (NFR1)

| 需求 ID | 描述 | 指標 | 測試方法 |
|---------|------|------|---------|
| **NFR1.1** | API 回應時間 | < 500ms (95 百分位數) | 壓力測試 |
| **NFR1.2** | 首頁載入時間 | < 3 秒 | Lighthouse |
| **NFR1.3** | 搜尋結果顯示 | < 2 秒 | 使用者測試 |
| **NFR1.4** | 聊天訊息延遲 | < 1 秒 | Socket.IO 測試 |
| **NFR1.5** | 並發使用者支援 | ≥ 1,000 人同時在線 | 負載測試 |
| **NFR1.6** | 資料庫查詢時間 | < 100ms | 慢查詢日誌 |

**驗收標準：**
- [ ] 通過 k6 壓力測試（1000 並發）
- [x] API 平均回應時間 < 500ms（開發環境）
- [ ] Lighthouse Performance Score > 90

---

### 4.2 安全性需求 (NFR2)

| 需求 ID | 描述 | 實作方式 | 狀態 |
|---------|------|---------|------|
| **NFR2.1** | 密碼加密儲存 | scrypt 雜湊演算法 | ✅ |
| **NFR2.2** | API 認證機制 | JWT (Access + Refresh Token) | ✅ |
| **NFR2.3** | HTTPS 加密傳輸 | SSL/TLS 憑證（生產環境） | 📋 |
| **NFR2.4** | SQL 注入防護 | SQLAlchemy 參數化查詢 | ✅ |
| **NFR2.5** | XSS 防護 | 輸入驗證、輸出編碼 | ✅ |
| **NFR2.6** | CSRF 防護 | SameSite Cookie、CORS 設定 | ✅ |
| **NFR2.7** | 檔案上傳驗證 | 類型、大小、MIME 驗證 | ✅ |
| **NFR2.8** | 敏感資料保護 | 環境變數、不提交至 Git | ✅ |
| **NFR2.9** | 兩步驟驗證 | TOTP (Time-based OTP) | ✅ |

**驗收標準：**
- [x] 通過 OWASP Top 10 安全檢查清單
- [x] 密碼強度驗證
- [ ] 第三方安全審計（Phase 2）

---

### 4.3 可用性需求 (NFR3)

| 需求 ID | 描述 | 目標 |
|---------|------|------|
| **NFR3.1** | 系統可用性 | ≥ 99% (MVP) / ≥ 99.9% (正式) |
| **NFR3.2** | 系統復原時間 | < 1 小時 |
| **NFR3.3** | 資料備份頻率 | 每日自動備份 |
| **NFR3.4** | 錯誤訊息友善度 | 使用者可理解的錯誤訊息 |

---

### 4.4 相容性需求 (NFR4)

**瀏覽器支援：**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**裝置支援：**
- 桌面（1920x1080, 1366x768）
- 平板（768x1024）
- 手機（375x667, 414x896）

**作業系統：**
- Windows 10+
- macOS 11+
- iOS 14+
- Android 10+

**驗收標準：**
- [x] 在主流瀏覽器正常運作
- [x] 響應式設計（RWD）

---

### 4.5 可維護性需求 (NFR5)

| 需求 ID | 描述 | 實作 |
|---------|------|------|
| **NFR5.1** | 程式碼規範 | PEP 8 (Python), ESLint (Vue) |
| **NFR5.2** | 程式碼註解 | 重要邏輯需有註解 |
| **NFR5.3** | API 文件 | Swagger / Postman Collection |
| **NFR5.4** | 資料庫遷移 | Alembic (SQLAlchemy Migrations) |
| **NFR5.5** | 版本控制 | Git + GitHub |
| **NFR5.6** | 日誌記錄 | Flask Logging + File Handler |

---

### 4.6 可擴展性需求 (NFR6)

| 需求 ID | 描述 | 實作計畫 |
|---------|------|---------|
| **NFR6.1** | 水平擴展支援 | Docker + Load Balancer (Phase 2) |
| **NFR6.2** | 資料庫擴展 | 讀寫分離、Sharding (Phase 2) |
| **NFR6.3** | 靜態資源 CDN | Cloudflare / AWS CloudFront (Phase 2) |
| **NFR6.4** | 快取機制 | Redis (Phase 2) |

---

## 5. 使用案例 (Use Cases)

### 5.1 UC1: 使用者註冊

**參與者：** 訪客  
**前置條件：** 無  
**主要流程：**
1. 訪客點擊「註冊」按鈕
2. 系統顯示註冊表單
3. 訪客輸入 Email、密碼、姓名
4. 訪客點擊「送出」
5. 系統驗證輸入資料
6. 系統建立使用者帳號
7. 系統發送驗證 Email
8. 系統顯示「請至 Email 信箱驗證」訊息
9. 使用者點擊驗證連結
10. 系統標記帳號為已驗證

**替代流程：**
- 3a. Email 已被註冊 → 顯示錯誤訊息
- 3b. 密碼過短 → 顯示密碼要求提示

**後置條件：** 使用者帳號已建立並驗證

---

### 5.2 UC2: 建立活動

**參與者：** 註冊使用者  
**前置條件：** 使用者已登入  
**主要流程：**
1. 使用者點擊「建立活動」
2. 系統顯示活動表單
3. 使用者填寫活動資訊（標題、日期、地點、描述等）
4. 使用者上傳封面圖片（選填）
5. 使用者點擊「發布」
6. 系統驗證輸入資料
7. 系統建立活動記錄
8. 系統將創建者加入為參與者
9. 系統導向活動詳情頁面

**替代流程：**
- 3a. 必填欄位遺漏 → 顯示錯誤提示
- 3b. 日期邏輯錯誤 → 顯示錯誤訊息

**後置條件：** 活動已建立並顯示在活動列表

---

### 5.3 UC3: 申請加入活動

**參與者：** 註冊使用者  
**前置條件：** 使用者已登入、活動存在且未滿  
**主要流程：**
1. 使用者瀏覽活動列表
2. 使用者點擊活動查看詳情
3. 使用者點擊「申請加入」
4. 系統顯示申請對話框
5. 使用者填寫申請訊息（選填）
6. 使用者點擊「送出申請」
7. 系統檢查性別/年齡限制
8. 系統建立參與者記錄（status: pending）
9. 系統顯示「申請已送出，等待創建者審核」

**替代流程：**
- 7a. 不符合性別限制 → 顯示錯誤訊息
- 7b. 不符合年齡限制 → 顯示錯誤訊息
- 8a. 活動已滿 → 顯示「活動已滿」訊息

**後置條件：** 參與申請已提交，等待審核

---

### 5.4 UC4: 審核參與申請

**參與者：** 活動創建者  
**前置條件：** 使用者為活動創建者、有待審核申請  
**主要流程：**
1. 創建者進入活動詳情頁面
2. 系統顯示「待審核申請」列表
3. 創建者點擊申請查看詳情（申請者資料、申請訊息）
4. 創建者點擊「批准」或「拒絕」
5. 若拒絕，填寫拒絕原因（選填）
6. 系統更新參與者狀態
7. 系統顯示操作成功訊息
8. （未來）系統通知申請者審核結果

**替代流程：**
- 4a. 活動已滿 → 無法再批准新申請

**後置條件：** 申請已被批准或拒絕

---

### 5.5 UC5: 媒合與開啟聊天室

**參與者：** 註冊使用者  
**前置條件：** 雙方使用者已註冊  
**主要流程：**
1. 使用者 A 在活動中看到使用者 B 的資料
2. 使用者 A 點擊「發送媒合申請」
3. 系統顯示媒合申請對話框
4. 使用者 A 填寫申請訊息
5. 使用者 A 點擊「送出」
6. 系統建立媒合記錄（status: pending）
7. （未來）系統通知使用者 B
8. 使用者 B 查看媒合申請
9. 使用者 B 點擊「接受」
10. 系統更新媒合狀態為 `confirmed`
11. 系統自動開啟聊天室
12. 雙方可開始即時聊天

**替代流程：**
- 9a. 使用者 B 點擊「拒絕」→ 媒合結束

**後置條件：** 媒合成功，聊天室已開啟

---

### 5.6 UC6: 費用分攤與結算

**參與者：** 活動參與者  
**前置條件：** 活動已完成、使用者為參與者  
**主要流程：**
1. 參與者進入活動詳情頁面
2. 參與者點擊「費用管理」分頁
3. 參與者點擊「新增費用」
4. 參與者填寫費用資訊（金額、類別、付款者、描述）
5. 參與者點擊「儲存」
6. 系統建立費用記錄
7. （重複步驟 3-6 記錄所有費用）
8. 參與者點擊「查看結算」
9. 系統計算最佳分攤方案
10. 系統顯示結算報告（誰付給誰多少錢）
11. 參與者可匯出結算報告（未來功能）

**替代流程：**
- 4a. 金額格式錯誤 → 顯示錯誤提示

**後置條件：** 費用已記錄，結算方案已顯示

---

### 5.7 UC7: 活動互評

**參與者：** 活動參與者  
**前置條件：** 活動狀態為 `completed`  
**主要流程：**
1. 參與者進入已完成的活動詳情頁面
2. 系統顯示「評價活動夥伴」按鈕
3. 參與者點擊按鈕
4. 系統顯示其他參與者列表（不含自己）
5. 參與者選擇要評價的對象
6. 參與者撰寫評語
7. 參與者點擊「送出評價」
8. 系統檢查是否已評價過該對象
9. 系統建立評價記錄
10. 系統更新被評價者的評價數量
11. 系統顯示「評價成功」訊息

**替代流程：**
- 8a. 已評價過 → 顯示「已評價過此使用者」

**後置條件：** 評價已提交，對方評價數量 +1

---

## 6. 資料需求

### 6.1 資料實體

系統包含以下 9 個主要資料表：

1. **users** - 使用者資料
2. **activities** - 活動資料
3. **activity_participants** - 活動參與者
4. **activity_discussions** - 活動討論串
5. **matches** - 媒合記錄
6. **chat_messages** - 聊天訊息
7. **expenses** - 費用記錄
8. **activity_reviews** - 活動評價
9. **alembic_version** - 資料庫版本（Alembic）

### 6.2 資料表關聯

```
users (使用者)
  ├──< activities (建立的活動, creator_id)
  ├──< activity_participants (參與的活動, user_id)
  ├──< activity_discussions (發送的討論, user_id)
  ├──< matches (媒合, user_a / user_b)
  ├──< chat_messages (發送的訊息, sender_id)
  ├──< expenses (付款的費用, payer_id)
  └──< activity_reviews (評價, reviewer_id / reviewee_id)

activities (活動)
  ├──< activity_participants (參與者)
  ├──< activity_discussions (討論串)
  ├──< matches (媒合)
  ├──< expenses (費用)
  └──< activity_reviews (評價)

matches (媒合)
  └──< chat_messages (聊天訊息)
```

### 6.3 資料字典（範例：users 表）

| 欄位名稱 | 資料型別 | 長度 | 約束 | 預設值 | 說明 |
|---------|---------|------|------|--------|------|
| user_id | INT | - | PK, AUTO_INCREMENT | - | 使用者唯一識別碼 |
| name | VARCHAR | 100 | NOT NULL | - | 使用者姓名 |
| email | VARCHAR | 120 | UNIQUE, NOT NULL | - | Email（唯一） |
| password_hash | VARCHAR | 255 | NOT NULL | - | 密碼雜湊值 |
| privacy_setting | VARCHAR | 20 | - | 'public' | 隱私設定 |
| social_privacy | VARCHAR | 20 | - | 'public' | 社群隱私設定 |
| location | VARCHAR | 100 | - | NULL | 使用者地區 |
| profile_picture | VARCHAR | 255 | - | NULL | 頭像 URL |
| bio | TEXT | - | - | NULL | 個人簡介 |
| gender | VARCHAR | 10 | - | NULL | 性別 |
| age | INT | - | - | NULL | 年齡 |
| interests | TEXT | - | - | NULL | 興趣（JSON） |
| join_date | DATETIME | - | - | CURRENT_TIMESTAMP | 註冊日期 |
| is_verified | BOOLEAN | - | - | FALSE | Email 是否已驗證 |
| is_active | BOOLEAN | - | - | TRUE | 帳號是否啟用 |
| last_seen | DATETIME | - | - | CURRENT_TIMESTAMP | 最後上線時間 |
| instagram_url | VARCHAR | 255 | - | NULL | Instagram 連結 |
| facebook_url | VARCHAR | 255 | - | NULL | Facebook 連結 |
| line_id | VARCHAR | 100 | - | NULL | Line ID |
| twitter_url | VARCHAR | 255 | - | NULL | Twitter 連結 |
| two_factor_enabled | BOOLEAN | - | - | FALSE | 是否啟用 2FA |
| two_factor_secret | VARCHAR | 32 | - | NULL | 2FA 密鑰 |
| rating_count | INT | - | - | 0 | 評價數量 |

**完整資料字典請參考：** [資料庫設計文件](./03-軟體設計文件.md#資料庫設計)

---

## 7. 外部介面需求

### 7.1 使用者介面需求

**UI 框架：** Element Plus  
**設計風格：** 簡潔、現代、友善  
**色彩主題：** 藍色系（主色）+ 灰色（輔助）

**主要頁面：**
1. 首頁 / 登入頁
2. 註冊頁
3. Dashboard（個人儀表板）
4. 活動列表頁
5. 活動詳情頁
6. 建立活動頁
7. 媒合列表頁
8. 聊天室頁
9. 個人資料頁

**UI 規範：**
- 響應式設計（RWD）
- 一致的導航結構
- 清楚的錯誤訊息
- 載入動畫（Spinner）
- 空狀態提示（Empty State）

---

### 7.2 硬體介面需求

**無特殊硬體需求**  
系統為 Web 應用程式，僅需標準的個人電腦或行動裝置。

---

### 7.3 軟體介面需求

#### 7.3.1 後端框架
- **Python Flask 3.x**
- **SQLAlchemy 2.x** (ORM)
- **Flask-JWT-Extended** (JWT 認證)
- **Flask-SocketIO** (即時通訊)
- **Flask-Mail** (Email 服務)

#### 7.3.2 前端框架
- **Vue 3** (Composition API)
- **Element Plus** (UI 組件庫)
- **Vite** (建構工具)
- **Axios** (HTTP 客戶端)
- **Socket.IO Client** (WebSocket)

#### 7.3.3 資料庫
- **MariaDB 10.11** / **MySQL 8.x**
- **PyMySQL** (Python 驅動)

#### 7.3.4 第三方服務
- **Google OAuth2** (第三方登入)
- **Gmail SMTP** (Email 發送)
- **Let's Encrypt** (SSL 憑證)

---

### 7.4 通訊介面需求

#### 7.4.1 RESTful API

**通訊協定：** HTTP/HTTPS  
**資料格式：** JSON  
**認證方式：** JWT Bearer Token

**API 端點範例：**
```
POST   /api/auth/register         # 註冊
POST   /api/auth/login            # 登入
GET    /api/activities            # 取得活動列表
POST   /api/activities            # 建立活動
GET    /api/activities/{id}       # 取得活動詳情
POST   /api/matches               # 建立媒合
GET    /api/chat/matches/{id}/messages  # 取得聊天訊息
```

**錯誤回應格式：**
```json
{
  "error": "錯誤訊息",
  "code": "ERROR_CODE",
  "status": 400
}
```

#### 7.4.2 WebSocket (Socket.IO)

**用途：** 即時聊天、討論串更新  
**事件範例：**
- `connect` - 連線建立
- `message` - 訊息發送/接收
- `disconnect` - 連線中斷

---

## 8. 系統特性

### 8.1 可靠性

- 系統可用性 ≥ 99% (MVP 階段)
- 自動錯誤記錄與通知
- 資料庫每日自動備份
- 故障復原時間 < 1 小時

### 8.2 可用性

- 直覺的使用者介面
- 清楚的操作提示
- 友善的錯誤訊息
- 一致的操作邏輯

### 8.3 可維護性

- 模組化程式碼設計
- 完整的程式碼註解
- API 文件齊全
- 版本控制（Git）

### 8.4 可移植性

- Docker 容器化部署
- 跨平台支援（Windows, macOS, Linux）
- 資料庫遷移工具（Alembic）

---

## 9. 約束條件

### 9.1 技術約束

- **後端框架：** 必須使用 Python Flask
- **前端框架：** 必須使用 Vue 3
- **資料庫：** 必須使用 MariaDB / MySQL
- **部署方式：** 必須支援 Docker

### 9.2 法規約束

- 遵守個人資料保護法（PDPA）
- 遵守消費者保護法
- 使用者協議與隱私權政策（待補）

### 9.3 業務約束

- 初期不提供付款功能
- 免費服務，無廣告
- 僅支援台灣地區（繁體中文）

### 9.4 設計約束

- 響應式設計（RWD）
- 瀏覽器相容性要求
- 無障礙設計（WCAG 2.1 Level AA）

---

## 10. 附錄

### 10.1 需求追溯矩陣

| 需求 ID | 需求描述 | 優先級 | 狀態 | 對應 Use Case | 測試案例 |
|---------|---------|--------|------|--------------|---------|
| FR1.1 | 使用者註冊 | 高 | ✅ 已實作 | UC1 | TC1.1 |
| FR1.2 | 使用者登入 | 高 | ✅ 已實作 | - | TC1.2 |
| FR3.1 | 建立活動 | 高 | ✅ 已實作 | UC2 | TC3.1 |
| FR4.1 | 申請加入活動 | 高 | ✅ 已實作 | UC3 | TC4.1 |
| FR5.3 | 私人聊天室 | 中 | ✅ 已實作 | UC5 | TC5.3 |
| FR6.2 | 費用分攤計算 | 中 | ✅ 已實作 | UC6 | TC6.2 |

### 10.2 需求優先級定義

| 優先級 | 定義 | 說明 |
|-------|------|------|
| **高 (High)** | 必須有 (Must Have) | MVP 核心功能，缺一不可 |
| **中 (Medium)** | 應該有 (Should Have) | 重要功能，但可延後 |
| **低 (Low)** | 可以有 (Could Have) | 加分功能，Phase 2 考慮 |

### 10.3 名詞解釋

- **MVP (Minimum Viable Product)**：最小可行產品，包含核心功能的初始版本
- **Sprint**：敏捷開發中的迭代週期，通常為 2 週
- **User Story**：描述使用者需求的簡短陳述
- **API (Application Programming Interface)**：應用程式介面
- **ORM (Object-Relational Mapping)**：物件關聯對映，將資料表映射為物件
- **JWT (JSON Web Token)**：一種基於 JSON 的開放標準認證令牌
- **Socket.IO**：即時雙向事件驅動通訊協定

### 10.4 參考文獻

1. IEEE Std 830-1998 - IEEE Recommended Practice for Software Requirements Specifications
2. ISO/IEC 25010 - Systems and software Quality Requirements and Evaluation (SQuaRE)
3. OWASP Top 10 - Web Application Security Risks
4. WCAG 2.1 - Web Content Accessibility Guidelines

---

**文件核准：**

| 角色 | 姓名 | 簽名 | 日期 |
|------|------|------|------|
| 產品擁有者 (PO) | - | - | - |
| 專案經理 (PM) | - | - | - |
| 技術架構師 | - | - | - |
| 業務分析師 (BA) | - | - | - |

---

**文件結束**
