@startuml UC4: 審核參與申請活動圖
!theme plain

skinparam activity {
    FontSize 12
}

skinparam swimlane {
    TitleFontSize 14
    TitleFontStyle bold
}

title UC4: 審核參與申請流程活動圖

|創建者|
start

:進入活動詳情頁面;

|前端 SPA\nviews/ActivityDetail.vue\napi/activities.js|
:發送 GET /api/activities/{id}/participants\nAuthorization: Bearer {token};

|後端 API\nblueprints/activities.py|
:查詢待審核申請\n(SELECT * FROM activity_participants\nWHERE status = 'pending');

|資料庫\nMariaDB|
:返回待審核申請列表;

|後端 API\nblueprints/activities.py|
:返回待審核申請列表;

|前端 SPA\nviews/ActivityDetail.vue\napi/activities.js|
:顯示「待審核申請」列表;

|創建者|
:點擊申請查看詳情;

:前端顯示申請者資料和申請訊息;

:點擊「批准」或「拒絕」;

if (選擇批准?) then (是)
    |前端 SPA\nviews/ActivityDetail.vue\napi/activities.js|
    :發送 POST /api/activities/{id}/participants/{participant_id}/approve;
    
    |後端 API\nblueprints/activities.py|
    :驗證操作權限\n(是否為創建者);
    
    :查詢活動資料\n(SELECT * FROM activities);
    
    |資料庫\nMariaDB|
    :返回活動資料;
    
    |後端 API\nblueprints/activities.py|
    :計算當前參與者數量;
    
    if (活動未滿?) then (是)
        |資料庫\nMariaDB|
        :更新參與者狀態\n(UPDATE activity_participants\nSET status = 'approved'\nWHERE participant_id = {participant_id});
        
        |後端 API\nblueprints/activities.py|
        :返回 HTTP 200\n成功訊息;
        
        |前端 SPA\nviews/ActivityDetail.vue\napi/activities.js|
        :顯示操作成功訊息;
        stop
    else (否)
        |後端 API\nblueprints/activities.py|
        :返回 HTTP 400\n錯誤：活動人數已滿;
        
        |前端 SPA\nviews/ActivityDetail.vue\napi/activities.js|
        :顯示錯誤訊息;
        stop
    endif
else (否)
    |創建者|
    :填寫拒絕原因（選填）;
    
    |前端 SPA\nviews/ActivityDetail.vue\napi/activities.js|
    :發送 POST /api/activities/{id}/participants/{participant_id}/reject\n{reason: "..."};
    
    |後端 API\nblueprints/activities.py|
    :驗證操作權限;
    
    |資料庫\nMariaDB|
    :更新參與者狀態\n(UPDATE activity_participants\nSET status = 'rejected'\nWHERE participant_id = {participant_id});
    
    |後端 API\nblueprints/activities.py|
    :返回 HTTP 200\n成功訊息;
    
    |前端 SPA\nviews/ActivityDetail.vue\napi/activities.js|
    :顯示操作成功訊息;
    stop
endif

@enduml
