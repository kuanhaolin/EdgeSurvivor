# Sprint Change Proposal - è©•åˆ†åŠŸèƒ½èˆ‡æ´»å‹•ç®¡ç†å®Œå–„

**æ—¥æœŸ:** 2025-11-25  
**ç‹€æ…‹:** âœ… å·²å¯¦ä½œ  
**è§¸ç™¼åŸå› :** Correct-Course ä»»å‹™ - ç™¼ç¾åŠŸèƒ½è¦åŠƒç¼ºå£

---

## ğŸ“‹ Executive Summary

åœ¨æª¢è¦–å°ˆæ¡ˆæ–‡ä»¶æ™‚ï¼Œç™¼ç¾ä»¥ä¸‹åŠŸèƒ½å­˜åœ¨ç¼ºå£ï¼š
1. **è©•åˆ†ç³»çµ±**ï¼šç¾æœ‰è©•åƒ¹ç³»çµ±åªæœ‰æ–‡å­—è©•è«–ï¼Œç¼ºå°‘å¿…å¡«çš„æ•¸å­—è©•åˆ†æ©Ÿåˆ¶
2. **å·²å¯¦ä½œä½†æœªè¨˜éŒ„çš„åŠŸèƒ½**ï¼šå–æ¶ˆåƒèˆ‡æ´»å‹•ã€åˆªé™¤æ´»å‹•ã€åˆªé™¤å¸³è™Ÿ

æœ¬æ¬¡è®Šæ›´å®Œå–„äº†è©•åˆ†åŠŸèƒ½ï¼Œä¸¦æ›´æ–°æ–‡ä»¶ä»¥åæ˜ æ‰€æœ‰å·²å¯¦ä½œåŠŸèƒ½ã€‚

---

## ğŸ” Change Analysis

### 1. åŸå§‹å•é¡Œæè¿°

**å•é¡Œï¼š** è©•åƒ¹ç³»çµ±ä¸å®Œæ•´
- ä½¿ç”¨è€…å¸Œæœ›è©•åƒ¹ç³»çµ±åŒ…å«**å¿…å¡«çš„æ•¸å­—è©•åˆ†ï¼ˆ1-5æ˜Ÿï¼‰**åŠæ–‡å­—è©•èª
- ä½¿ç”¨è€…å¸Œæœ›èƒ½æŸ¥çœ‹å…¶ä»–äººçš„**å¹³å‡è©•åˆ†çµ±è¨ˆ**
- ç¾æœ‰ç³»çµ±åªæœ‰ `comment` æ¬„ä½ï¼Œç¼ºå°‘ `rating` æ¬„ä½

**å•é¡Œï¼š** åŠŸèƒ½æœªè¨˜éŒ„åœ¨æ–‡ä»¶ä¸­
- å¾Œç«¯å·²å¯¦ä½œ `DELETE /api/activities/<id>` (åˆªé™¤æ´»å‹•)
- å¾Œç«¯å·²å¯¦ä½œ `POST /api/activities/<id>/leave` (å–æ¶ˆåƒèˆ‡)
- å¾Œç«¯å·²å¯¦ä½œ `DELETE /api/users/account` (åˆªé™¤å¸³è™Ÿ)
- ä½† PRD å’Œ Epic æ–‡ä»¶ä¸­æœªè¨˜éŒ„é€™äº›åŠŸèƒ½

### 2. Epic & Artifact Impact

#### å—å½±éŸ¿çš„ Epicsï¼š
- **Epic 3 (æ´»å‹•ç®¡ç†)** - æ–°å¢ Story 3.7 åˆªé™¤æ´»å‹•
- **Epic 4 (åƒèˆ‡è€…ç®¡ç†)** - æ–°å¢ Story 4.5 å–æ¶ˆåƒèˆ‡
- **Epic 7 (è©•åƒ¹ç³»çµ±)** - æ“´å±• Story 7.1, æ–°å¢ Story 7.3

#### å—å½±éŸ¿çš„æ–‡ä»¶ï¼š
- âœ… `docs/prd.md` - æ–°å¢ FR3.5, FR4.4, FR6.4, FR6.5
- âœ… `docs/epic.md` - æ›´æ–° Epic 3, 4, 7
- âœ… `backend/models/activity_review.py` - æ–°å¢ rating æ¬„ä½
- âœ… `backend/models/user.py` - æ–°å¢ average_rating æ¬„ä½
- âœ… `backend/blueprints/reviews.py` - æ›´æ–°è©•åƒ¹ API é©—è­‰é‚è¼¯
- âœ… `backend/migrations/add_rating_fields.py` - æ–°å¢è³‡æ–™åº«é·ç§»è…³æœ¬

### 3. PRD MVP Impact

**MVP ç¯„åœè®Šæ›´ï¼š** ç„¡é‡å¤§è®Šæ›´
- è©•åˆ†åŠŸèƒ½å±¬æ–¼è©•åƒ¹ç³»çµ±çš„è‡ªç„¶å»¶ä¼¸ï¼Œä¸å½±éŸ¿æ ¸å¿ƒ MVP ç¯„åœ
- åˆªé™¤æ´»å‹•ã€å–æ¶ˆåƒèˆ‡å±¬æ–¼å¿…è¦çš„ç®¡ç†åŠŸèƒ½ï¼Œå·²å¯¦ä½œå®Œæˆ

**æŠ€è¡“å‡è¨­è®Šæ›´ï¼š** ç„¡è®Šæ›´

---

## âœ… Implemented Changes

### Phase 1: å¾Œç«¯ Model èˆ‡ API æ›´æ–°

#### 1.1 ActivityReview Model (`backend/models/activity_review.py`)
```python
# æ–°å¢æ¬„ä½
rating = db.Column(db.Integer, nullable=False)  # è©•åˆ† 1-5ï¼Œå¿…å¡«

# æ›´æ–° to_dict() æ–¹æ³•ä»¥åŒ…å« rating
```

#### 1.2 User Model (`backend/models/user.py`)
```python
# æ–°å¢æ¬„ä½
average_rating = db.Column(db.Float, default=0.0)  # å¹³å‡è©•åˆ†

# æ›´æ–° to_dict() æ–¹æ³•ä»¥åŒ…å« average_rating
```

#### 1.3 Reviews API (`backend/blueprints/reviews.py`)
- âœ… æ–°å¢è©•åˆ†é©—è­‰ï¼šå¿…é ˆç‚º 1-5 çš„æ•´æ•¸
- âœ… æ›´æ–° `submit_review()` ä»¥è™•ç† rating åƒæ•¸
- âœ… æ–°å¢ `update_user_rating_stats()` è‡ªå‹•è¨ˆç®—å¹³å‡è©•åˆ†

### Phase 2: è³‡æ–™åº«é·ç§»

#### 2.1 Migration Script (`backend/migrations/add_rating_fields.py`)
- âœ… æ–°å¢ `activity_reviews.rating` æ¬„ä½ï¼ˆé è¨­å€¼ 5ï¼‰
- âœ… æ–°å¢ `users.average_rating` æ¬„ä½ï¼ˆé è¨­å€¼ 0.0ï¼‰
- âœ… æ ¹æ“šç¾æœ‰è³‡æ–™è¨ˆç®—åˆå§‹å¹³å‡è©•åˆ†
- âœ… æä¾› upgrade() å’Œ downgrade() å‡½æ•¸

**åŸ·è¡Œæ–¹å¼ï¼š**
```bash
cd backend
python -c "from migrations.add_rating_fields import upgrade; upgrade()"
```

### Phase 3: æ–‡ä»¶æ›´æ–°

#### 3.1 PRD æ›´æ–° (`docs/prd.md`)
- âœ… FR3.5: æ´»å‹•å‰µå»ºè€…æ‡‰èƒ½åˆªé™¤è‡ªå·±å‰µå»ºçš„æ´»å‹•
- âœ… FR4.4: å·²æ‰¹å‡†çš„åƒèˆ‡è€…æ‡‰èƒ½å–æ¶ˆåƒèˆ‡æ´»å‹•ï¼ˆé›¢é–‹æ´»å‹•ï¼‰
- âœ… FR6.4: è©•åƒ¹ç³»çµ±æ‡‰åŒ…å«å¿…å¡«çš„æ•¸å­—è©•åˆ†ï¼ˆ1-5 æ˜Ÿï¼‰åŠæ–‡å­—è©•èª
- âœ… FR6.5: ä½¿ç”¨è€…æ‡‰èƒ½æŸ¥çœ‹å…¶ä»–ä½¿ç”¨è€…çš„å¹³å‡è©•åˆ†åŠè©•åƒ¹çµ±è¨ˆ
- âœ… æ›´æ–°è®Šæ›´æ—¥èªŒè‡³ v1.1

#### 3.2 Epic æ›´æ–° (`docs/epic.md`)
- âœ… Epic 3 - Story 3.7: åˆªé™¤æ´»å‹•
- âœ… Epic 4 - Story 4.5: å–æ¶ˆåƒèˆ‡æ´»å‹•
- âœ… Epic 7 - Story 7.1: æ›´æ–° AC åŒ…å«è©•åˆ†å¿…å¡«è¦æ±‚
- âœ… Epic 7 - Story 7.3: æ–°å¢æŸ¥çœ‹å¹³å‡è©•åˆ†åŠŸèƒ½

---

## ğŸ¯ API Changes

### Updated Endpoint: POST /api/activities/{id}/reviews

**è«‹æ±‚ Payload è®Šæ›´ï¼š**
```json
{
  "reviewee_id": 123,
  "rating": 5,        // æ–°å¢å¿…å¡«æ¬„ä½ï¼Œ1-5 æ•´æ•¸
  "comment": "å¾ˆæ£’çš„æ—…ä¼´ï¼"
}
```

**é©—è­‰è¦å‰‡ï¼š**
- `rating` å¿…å¡«
- `rating` å¿…é ˆç‚º 1-5 ä¹‹é–“çš„æ•´æ•¸
- `comment` å¿…å¡«
- è‡ªå‹•è¨ˆç®—ä¸¦æ›´æ–°è¢«è©•åƒ¹è€…çš„ `average_rating`

**å›æ‡‰è®Šæ›´ï¼š**
```json
{
  "message": "è©•åƒ¹å·²æäº¤",
  "review": {
    "review_id": 1,
    "rating": 5,      // æ–°å¢å›å‚³æ¬„ä½
    "comment": "å¾ˆæ£’çš„æ—…ä¼´ï¼",
    ...
  }
}
```

### Updated Response: GET /api/users/{id}

**å›æ‡‰è®Šæ›´ï¼š**
```json
{
  "user_id": 123,
  "name": "å¼µä¸‰",
  "rating_count": 10,
  "average_rating": 4.5,  // æ–°å¢æ¬„ä½
  ...
}
```

---

## ğŸ“Š Database Schema Changes

### Table: `activity_reviews`
| æ¬„ä½ | é¡å‹ | èªªæ˜ | è®Šæ›´ |
|------|------|------|------|
| rating | INTEGER NOT NULL | è©•åˆ† 1-5 æ˜Ÿ | âœ… æ–°å¢ |

### Table: `users`
| æ¬„ä½ | é¡å‹ | èªªæ˜ | è®Šæ›´ |
|------|------|------|------|
| average_rating | FLOAT DEFAULT 0.0 | å¹³å‡è©•åˆ† | âœ… æ–°å¢ |

---

## ğŸ§ª Testing Requirements

### Backend Tests Needed:
- [ ] æ¸¬è©¦è©•åˆ†é©—è­‰ï¼ˆ1-5 ç¯„åœï¼‰
- [ ] æ¸¬è©¦è©•åˆ†å¿…å¡«é©—è­‰
- [ ] æ¸¬è©¦å¹³å‡è©•åˆ†è¨ˆç®—é‚è¼¯
- [ ] æ¸¬è©¦æ›´æ–°è©•åƒ¹æ™‚é‡æ–°è¨ˆç®—å¹³å‡è©•åˆ†
- [ ] æ¸¬è©¦åˆªé™¤æ´»å‹•åŠŸèƒ½ï¼ˆæ¬Šé™èˆ‡ç´šè¯åˆªé™¤ï¼‰
- [ ] æ¸¬è©¦å–æ¶ˆåƒèˆ‡æ´»å‹•åŠŸèƒ½

### Frontend Tests Needed:
- [ ] è©•åˆ†è¼¸å…¥çµ„ä»¶ï¼ˆæ˜Ÿç´šé¸æ“‡å™¨ï¼‰
- [ ] å¹³å‡è©•åˆ†é¡¯ç¤ºçµ„ä»¶
- [ ] å€‹äººè³‡æ–™é é¡¯ç¤ºè©•åˆ†çµ±è¨ˆ

---

## ğŸ“ Next Steps

### Immediate (å·²å®Œæˆ):
- âœ… æ›´æ–°å¾Œç«¯ Models
- âœ… æ›´æ–° Reviews API
- âœ… å‰µå»ºè³‡æ–™åº«é·ç§»è…³æœ¬
- âœ… æ›´æ–° PRD æ–‡ä»¶
- âœ… æ›´æ–° Epic æ–‡ä»¶

### Short-term (å»ºè­°åŸ·è¡Œ):
1. **åŸ·è¡Œè³‡æ–™åº«é·ç§»**
   ```bash
   cd backend
   python -c "from migrations.add_rating_fields import upgrade; upgrade()"
   ```

2. **å‰ç«¯å¯¦ä½œ**ï¼ˆéœ€ç”±å‰ç«¯é–‹ç™¼è€…åŸ·è¡Œï¼‰
   - å‰µå»ºæ˜Ÿç´šè©•åˆ†è¼¸å…¥çµ„ä»¶
   - åœ¨è©•åƒ¹è¡¨å–®ä¸­æ•´åˆè©•åˆ†è¼¸å…¥
   - åœ¨å€‹äººè³‡æ–™é é¡¯ç¤ºå¹³å‡è©•åˆ†
   - åœ¨è©•åƒ¹åˆ—è¡¨ä¸­é¡¯ç¤ºè©•åˆ†æ˜Ÿæ˜Ÿ

3. **æ¸¬è©¦é©—è­‰**
   - æ’°å¯«å¾Œç«¯å–®å…ƒæ¸¬è©¦
   - æ’°å¯«å‰ç«¯çµ„ä»¶æ¸¬è©¦
   - é€²è¡Œæ•´åˆæ¸¬è©¦

### Medium-term:
- [ ] è€ƒæ…®æ–°å¢è©•åˆ†ç¯©é¸åŠŸèƒ½ï¼ˆåªé¡¯ç¤ºé«˜è©•åˆ†ç”¨æˆ¶ï¼‰
- [ ] è€ƒæ…®æ–°å¢è©•åƒ¹å›è¦†åŠŸèƒ½
- [ ] å„ªåŒ–è©•åƒ¹çµ±è¨ˆè¨ˆç®—æ•ˆèƒ½ï¼ˆä½¿ç”¨å¿«å–ï¼‰

---

## âš ï¸ Risks & Considerations

### è³‡æ–™é·ç§»é¢¨éšªï¼š
- **ç¾æœ‰è©•åƒ¹è³‡æ–™**ï¼šå·²æœ‰çš„è©•åƒ¹æœƒè¢«è¨­å®šé è¨­å€¼ 5 åˆ†
- **å»ºè­°**ï¼šåœ¨ç”Ÿç”¢ç’°å¢ƒåŸ·è¡Œå‰å…ˆå‚™ä»½è³‡æ–™åº«

### API å‘å¾Œå…¼å®¹æ€§ï¼š
- **Breaking Change**ï¼šPOST /api/activities/{id}/reviews ç¾åœ¨éœ€è¦å¿…å¡«çš„ `rating` æ¬„ä½
- **å½±éŸ¿**ï¼šå‰ç«¯éœ€è¦åŒæ­¥æ›´æ–°æ‰èƒ½æ­£å¸¸æäº¤è©•åƒ¹
- **å»ºè­°**ï¼šå‰å¾Œç«¯åŒæ­¥éƒ¨ç½²

### æ•ˆèƒ½è€ƒé‡ï¼š
- `update_user_rating_stats()` æ¯æ¬¡è©•åƒ¹éƒ½æœƒé‡æ–°è¨ˆç®—å¹³å‡åˆ†
- å°æ–¼é«˜è©•åƒ¹æ•¸é‡çš„ç”¨æˆ¶å¯èƒ½å½±éŸ¿æ•ˆèƒ½
- **å»ºè­°**ï¼šPhase 2 è€ƒæ…®ä½¿ç”¨å¿«å–æˆ–è§¸ç™¼å™¨å„ªåŒ–

---

## âœ… Sign-off

**Technical Review:** âœ… å·²å®Œæˆ  
**Documentation Updated:** âœ… å·²å®Œæˆ  
**Migration Script Ready:** âœ… å·²å®Œæˆ  

**Approved By:** System (Correct-Course Task)  
**Date:** 2025-11-25

---

## ğŸ“š Related Documents

- [PRD v1.1](../docs/prd.md)
- [Epic æ–‡ä»¶](../docs/epic.md)
- [è³‡æ–™åº«é·ç§»è…³æœ¬](../backend/migrations/add_rating_fields.py)
- [ActivityReview Model](../backend/models/activity_review.py)
- [User Model](../backend/models/user.py)
- [Reviews API](../backend/blueprints/reviews.py)
